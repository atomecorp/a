var SquirrelApp=function(){"use strict";class Module{static modules=new Map;static connections=new Map;static draggedModule=null;static connectionInProgress=null;static selectedConnector=null;constructor(t={}){this.config={id:t.id||`module_${Date.now()}`,name:t.name||"Untitled Module",attach:t.attach||"body",x:t.x||100,y:t.y||100,width:t.width||200,height:t.height||120,inputs:t.inputs||[],outputs:t.outputs||[],style:{backgroundColor:"#2c3e50",borderRadius:"8px",border:"2px solid #34495e",color:"white",fontSize:"14px",fontFamily:"Roboto, sans-serif",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",...t.style},connectors:{input:{backgroundColor:"#e74c3c",size:12,position:"left",...t.connectors?.input},output:{backgroundColor:"#27ae60",size:12,position:"right",...t.connectors?.output}},connectorTypes:{audio:{color:"#e74c3c",shape:"circle"},control:{color:"#3498db",shape:"square"},data:{color:"#f39c12",shape:"triangle"},...t.connectorTypes},draggable:!1!==t.draggable,grid:t.grid||{enabled:!1,size:20},callbacks:{onMove:t.callbacks?.onMove||(()=>{}),onConnect:t.callbacks?.onConnect||(()=>{}),onDisconnect:t.callbacks?.onDisconnect||(()=>{}),onClick:t.callbacks?.onClick||(()=>{}),onSelect:t.callbacks?.onSelect||(()=>{})}},this.id=this.config.id,this.name=this.config.name,this.inputs=[...this.config.inputs],this.outputs=[...this.config.outputs],this.connections=new Set,this.selected=!1,this._createModule(),this._setupEventHandlers(),Module.modules.set(this.id,this)}_createModule(){const t="string"==typeof this.config.attach?document.querySelector(this.config.attach):this.config.attach;if(!t)throw new Error(`Container not found: ${this.config.attach}`);this.element=document.createElement("div"),this.element.className="squirrel-module",this.element.id=this.id,Object.assign(this.element.style,{position:"absolute",left:`${this.config.x}px`,top:`${this.config.y}px`,width:`${this.config.width}px`,height:`${this.config.height}px`,cursor:this.config.draggable?"move":"default",zIndex:"1000",...this.config.style}),this._createHeader(),this._createConnectors(),this._createContent(),t.appendChild(this.element)}_createHeader(){this.header=document.createElement("div"),this.header.className="module-header",this.header.textContent=this.name,Object.assign(this.header.style,{padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,0.1)",fontWeight:"bold",fontSize:"12px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"6px 6px 0 0"}),this.header.addEventListener("dblclick",(t=>{t.preventDefault(),t.stopPropagation(),this._enableRename()})),this.element.appendChild(this.header)}_createConnectors(){this.inputElements=new Map,this.inputs.forEach(((t,e)=>{const i=this._createConnector(t,"input",e);this.inputElements.set(t.id,i)})),this.outputElements=new Map,this.outputs.forEach(((t,e)=>{const i=this._createConnector(t,"output",e);this.outputElements.set(t.id,i)}))}_createConnector(t,e,i){const s=document.createElement("div");s.className=`module-connector module-${e}`,s.dataset.connectorId=t.id,s.dataset.connectorType=e,s.dataset.dataType=t.type||"data";const n=this.config.connectors[e],o=this.config.connectorTypes[t.type]||this.config.connectorTypes.data,r=30+i*((this.config.height-40)/Math.max(1,this[`${e}s`].length-1)),a="input"===e?-n.size/2:this.config.width-n.size/2;Object.assign(s.style,{position:"absolute",left:`${a}px`,top:`${r}px`,width:`${n.size}px`,height:`${n.size}px`,backgroundColor:o.color,borderRadius:"circle"===o.shape?"50%":"square"===o.shape?"0%":"0",border:"2px solid white",cursor:"pointer",zIndex:"1001",transition:"transform 0.2s ease-out"});const l=document.createElement("span");return l.textContent=t.name,l.style.cssText=`\n            position: absolute;\n            ${"input"===e?"left: 20px":"right: 20px"};\n            top: 50%;\n            transform: translateY(-50%);\n            font-size: 10px;\n            white-space: nowrap;\n            pointer-events: none;\n        `,s.appendChild(l),s.addEventListener("mouseenter",(()=>{s.style.transform="scale(1.2)"})),s.addEventListener("mouseleave",(()=>{s.classList.contains("dragging")||(s.style.transform="scale(1)")})),this._setupConnectorDragDrop(s),this.element.appendChild(s),s}_setupConnectorDragDrop(t){t.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();const i=t.dataset.connectorId,s=t.dataset.connectorType,n={element:t,module:this,id:i,type:s};if(Module.selectedConnector){const t=Module.selectedConnector,e=n;if(t.element.style.border="2px solid white",t.element.style.boxShadow="",t.type!==e.type&&t.module!==e.module){const i=this._getConnectionKey(t,e),s=Module.connections.get(i);s?(s.line.remove(),Module.connections.delete(i),t.module.connections.delete(i),e.module.connections.delete(i),t.module.config.callbacks.onDisconnect&&t.module.config.callbacks.onDisconnect(s),e.module.config.callbacks.onDisconnect&&e.module.config.callbacks.onDisconnect(s)):this._createDragConnection(t,e)}Module.selectedConnector=null}else Module.selectedConnector=n,t.style.border="3px solid #00ff00",t.style.boxShadow="0 0 10px #00ff00"}));let e=!1,i=null,s=null;t.addEventListener("mousedown",(n=>{if(0!==n.button)return;n.preventDefault(),n.stopPropagation();const o=setTimeout((()=>{e=!0,s={element:t,module:this,id:t.dataset.connectorId,type:t.dataset.connectorType},i=this._createDragLine(t),t.classList.add("dragging"),t.style.transform="scale(1.3)",t.style.border="3px solid #00ff00",this._highlightDropTargets(s,n),Module.connectionInProgress={startConnector:s,dragLine:i}}),150),r=n=>{e&&i&&(this._updateDragLine(i,t,{x:n.clientX,y:n.clientY}),this._highlightDropTargets(s,n))},a=n=>{if(clearTimeout(o),e){const o=this._findDropTarget(n);o&&this._isValidConnection(s,o)&&this._createDragConnection(s,o),i&&(i.remove(),i=null),t.classList.remove("dragging"),t.style.transform="scale(1)",t.style.border="2px solid white",this._clearDropTargetHighlights(),Module.connectionInProgress=null,e=!1,s=null}document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)})),document.addEventListener("click",(t=>{!t.target.closest(".module-connector")&&Module.selectedConnector&&(Module.selectedConnector.element.style.border="2px solid white",Module.selectedConnector.element.style.boxShadow="",Module.selectedConnector=null)}))}_createDragLine(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line"),i=this._getOrCreateSVG();return e.setAttribute("stroke","#00ff00"),e.setAttribute("stroke-width","3"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-dasharray","5,5"),e.style.pointerEvents="none",i.appendChild(e),e}_updateDragLine(t,e,i){const s=e.getBoundingClientRect(),n=s.left+s.width/2,o=s.top+s.height/2;t.setAttribute("x1",n),t.setAttribute("y1",o),t.setAttribute("x2",i.x),t.setAttribute("y2",i.y)}_highlightDropTargets(t,e){this._clearDropTargetHighlights();document.querySelectorAll(".module-connector").forEach((e=>{const i=Module.modules.get(e.closest(".squirrel-module").id);if(!i||i===t.module)return;const s={element:e,module:i,id:e.dataset.connectorId,type:e.dataset.connectorType};this._isValidConnection(t,s)&&(e.style.backgroundColor="#00ff00",e.style.transform="scale(1.4)",e.style.boxShadow="0 0 10px #00ff00")}))}_clearDropTargetHighlights(){document.querySelectorAll(".module-connector").forEach((t=>{if(!t.classList.contains("dragging")){const e=t.dataset.dataType;t.dataset.connectorType;const i=Module.modules.get(t.closest(".squirrel-module").id);if(i){const s=i.config.connectorTypes[e]||i.config.connectorTypes.data;t.style.backgroundColor=s.color,t.style.transform="scale(1)",t.style.boxShadow=""}}}))}_findDropTarget(t){const e=document.elementFromPoint(t.clientX,t.clientY);if(!e)return null;const i=e.closest(".module-connector");if(!i)return null;const s=Module.modules.get(i.closest(".squirrel-module").id);return s?{element:i,module:s,id:i.dataset.connectorId,type:i.dataset.connectorType}:null}_isValidConnection(t,e){if(t.module===e.module)return!1;if(t.type===e.type)return!1;const i=this._getConnectionKey(t,e);return!Module.connections.has(i)}_createDragConnection(t,e){const i=this._getConnectionKey(t,e),s={id:i,from:{module:t.module,connector:t.id,element:t.element},to:{module:e.module,connector:e.id,element:e.element},line:this._createConnectionLine(t.element,e.element)};return Module.connections.set(i,s),t.module.connections.add(i),e.module.connections.add(i),t.module.config.callbacks.onConnect(s),e.module.config.callbacks.onConnect(s),s}_createConnectionLine(t,e){const i=document.createElementNS("http://www.w3.org/2000/svg","line"),s=this._getOrCreateSVG();return i.setAttribute("stroke","#3498db"),i.setAttribute("stroke-width","2"),i.setAttribute("stroke-linecap","round"),i.style.pointerEvents="none",this._updateConnectionLine(i,t,e),s.appendChild(i),i}_updateConnectionLine(t,e,i){const s=e.getBoundingClientRect(),n=i.getBoundingClientRect(),o=s.left+s.width/2,r=s.top+s.height/2,a=n.left+n.width/2,l=n.top+n.height/2;t.setAttribute("x1",o),t.setAttribute("y1",r),t.setAttribute("x2",a),t.setAttribute("y2",l)}_getConnectionKey(t,e){const i=`${t.module.id}.${t.id}`,s=`${e.module.id}.${e.id}`;return i<s?`${i}→${s}`:`${s}→${i}`}_getConnectorConnections(t,e){const i=[];return Module.connections.forEach(((e,s)=>{(e.from.connector===t&&e.from.module===this||e.to.connector===t&&e.to.module===this)&&i.push(e)})),i}_getOrCreateSVG(){let t=document.querySelector("#squirrel-connections-svg");return t||(t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.id="squirrel-connections-svg",t.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                pointer-events: none;\n                z-index: 999;\n            ",document.body.appendChild(t)),t}_createContent(){this.content=document.createElement("div"),this.content.className="module-content",Object.assign(this.content.style,{padding:"12px",height:"calc(100% - 32px)",overflow:"hidden"}),this.element.appendChild(this.content)}_setupEventHandlers(){this.config.draggable&&this._setupModuleDrag(),this.element.addEventListener("click",(t=>{t.target.closest(".module-connector")||(this.select(),t.stopPropagation())})),this.element.addEventListener("contextmenu",(t=>{t.preventDefault(),this._showContextMenu(t)}))}_setupModuleDrag(){let t=!1,e={x:0,y:0},i={x:0,y:0};this.header.addEventListener("mousedown",(s=>{0===s.button&&(s.preventDefault(),s.stopPropagation(),t=!0,e={x:this.config.x,y:this.config.y},i={x:s.clientX,y:s.clientY},this.element.style.zIndex="1001",this.element.style.cursor="grabbing",Module.draggedModule=this)})),document.addEventListener("mousemove",(s=>{if(!t)return;const n=s.clientX-i.x,o=s.clientY-i.y;this.config.x=e.x+n,this.config.y=e.y+o,this.config.grid.enabled&&(this.config.x=Math.round(this.config.x/this.config.grid.size)*this.config.grid.size,this.config.y=Math.round(this.config.y/this.config.grid.size)*this.config.grid.size),this.element.style.left=`${this.config.x}px`,this.element.style.top=`${this.config.y}px`,this._updateConnectionLines(),this.config.callbacks.onMove(this)})),document.addEventListener("mouseup",(()=>{t&&(t=!1,this.element.style.zIndex="1000",this.element.style.cursor=this.config.draggable?"move":"default",Module.draggedModule=null)}))}_updateConnectionLines(){this.connections.forEach((t=>{const e=Module.connections.get(t);e&&e.line&&this._updateConnectionLine(e.line,e.from.element,e.to.element)}))}_showContextMenu(t){const e=document.createElement("div");e.className="module-context-menu",e.style.cssText=`\n            position: fixed;\n            left: ${t.clientX}px;\n            top: ${t.clientY}px;\n            background: #2c3e50;\n            border: 1px solid #34495e;\n            border-radius: 4px;\n            padding: 8px 0;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n            z-index: 10000;\n            min-width: 120px;\n        `;[{text:"Duplicate",action:()=>this.duplicate()},{text:"Disconnect All",action:()=>this.disconnectAll()},{text:"Delete",action:()=>this.delete()},{text:"Properties",action:()=>this.showProperties()}].forEach((t=>{const i=document.createElement("div");i.textContent=t.text,i.style.cssText="\n                padding: 8px 16px;\n                color: white;\n                cursor: pointer;\n                font-size: 12px;\n            ",i.addEventListener("mouseenter",(()=>{i.style.backgroundColor="#34495e"})),i.addEventListener("mouseleave",(()=>{i.style.backgroundColor="transparent"})),i.addEventListener("click",(()=>{t.action(),e.remove()})),e.appendChild(i)}));const i=t=>{e.contains(t.target)||(e.remove(),document.removeEventListener("click",i))};document.addEventListener("click",i),document.body.appendChild(e)}_enableRename(){const t=document.createElement("input");t.type="text",t.value=this.name,Object.assign(t.style,{background:"transparent",border:"1px solid #3498db",color:"white",padding:"4px 8px",fontSize:"12px",fontWeight:"bold",width:"calc(100% - 16px)",borderRadius:"3px"}),this.header.innerHTML="",this.header.appendChild(t),t.focus(),t.select();const e=()=>{const e=t.value.trim();e&&e!==this.name&&(this.name=e,this.config.name=e),this.header.innerHTML="",this.header.textContent=this.name};t.addEventListener("blur",e),t.addEventListener("keydown",(t=>{"Enter"===t.key&&e(),"Escape"===t.key&&(this.header.innerHTML="",this.header.textContent=this.name)}))}select(){Module.modules.forEach((t=>{t!==this&&t.deselect()})),this.selected=!0,this.element.style.border="2px solid #3498db",this.element.style.boxShadow="0 0 0 2px rgba(52, 152, 219, 0.3)",this.config.callbacks.onSelect(this)}deselect(){this.selected=!1,this.element.style.border=this.config.style.border||"2px solid #34495e",this.element.style.boxShadow=this.config.style.boxShadow||"0 4px 12px rgba(0,0,0,0.2)"}moveTo(t,e){this.config.x=t,this.config.y=e,this.element.style.left=`${t}px`,this.element.style.top=`${e}px`,this._updateConnectionLines(),this.config.callbacks.onMove(this)}duplicate(){const t=JSON.parse(JSON.stringify(this.config));return t.id=`module_${Date.now()}`,t.x+=20,t.y+=20,t.name+=" (Copy)",new Module(t)}delete(){[...this.connections].forEach((t=>{const e=Module.connections.get(t);e&&(e.line.remove(),Module.connections.delete(t))})),Module.modules.delete(this.id),this.element.remove()}showProperties(){}disconnectAll(){[...this.connections].forEach((t=>{const e=Module.connections.get(t);e&&(e.line.remove(),Module.connections.delete(t),e.from.module!==this&&e.from.module.connections.delete(t),e.to.module!==this&&e.to.module.connections.delete(t))})),this.connections.clear()}static getModule(t){return Module.modules.get(t)}static getAllModules(){return Array.from(Module.modules.values())}static getConnection(t){return Module.connections.get(t)}static getAllConnections(){return Array.from(Module.connections.values())}static clearAll(){Module.connections.forEach((t=>{t.line&&t.line.remove()})),Module.connections.clear(),Module.modules.forEach((t=>{t.element.remove()})),Module.modules.clear();const t=document.querySelector("#squirrel-connections-svg");t&&t.remove()}}class Slider{constructor(t){this.originalConfig=t||{},this.config={attach:"body",id:"slider_"+Math.random().toString(36).substr(2,9),x:20,y:20,width:300,height:60,trackWidth:300,trackHeight:8,thumbSize:24,min:0,max:100,step:1,value:50,type:"horizontal",grip:{width:null,height:null,backgroundColor:"#2196f3",border:"3px solid #ffffff",borderRadius:"50%",boxShadow:"0 4px 12px rgba(33, 150, 243, 0.4)",cursor:"pointer",transition:"transform 0.2s ease-out, box-shadow 0.2s ease-out"},support:{backgroundColor:"#ffffff",border:"1px solid rgba(0,0,0,0.04)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08)",padding:"15px"},rail:{backgroundColor:"#e0e0e0",borderRadius:"3px",height:null,width:null},progress:{backgroundColor:"#2196f3",borderRadius:"3px",boxShadow:"0 2px 4px rgba(33, 150, 243, 0.3)",transition:"width 0.2s ease-out, height 0.2s ease-out"},colors:{container:"#ffffff",track:"#e0e0e0",progress:"#2196f3",thumb:"#2196f3"},animations:{enabled:!0,duration:.2,easing:"ease-out"},callbacks:{onChange:null,onStart:null,onEnd:null,onDrag:null},theme:"material",variation:null,circular:{radius:80,strokeWidth:8,startAngle:0,endAngle:270},...t},this.currentValue=this.config.value,this.isDragging=!1,this.elements={},this._mergeStyleAPIs(),this._init()}_mergeStyleAPIs(){if(this.config.colors&&(this.config.colors.container&&!this.originalConfig.support?.backgroundColor&&(this.config.support.backgroundColor=this.config.colors.container),this.config.colors.track&&!this.originalConfig.rail?.backgroundColor&&(this.config.rail.backgroundColor=this.config.colors.track),this.config.colors.progress&&!this.originalConfig.progress?.backgroundColor&&(this.config.progress.backgroundColor=this.config.colors.progress),this.config.colors.thumb&&!this.originalConfig.grip?.backgroundColor&&(this.config.grip.backgroundColor=this.config.colors.thumb,!this.originalConfig.grip?.boxShadow))){const t=this.config.colors.thumb;this.config.grip.boxShadow=`0 4px 12px ${this._addAlphaToColor(t,.4)}`}null===this.config.grip.width&&(this.config.grip.width=this.config.thumbSize),null===this.config.grip.height&&(this.config.grip.height=this.config.thumbSize),null===this.config.rail.height&&(this.config.rail.height=this.config.trackHeight),null===this.config.rail.width&&(this.config.rail.width=this.config.trackWidth)}_init(){"circular"===this.config.type?(this._createCircularSlider(),this._attachCircularEvents()):(this._createLinearSlider(),this._attachEvents()),this._applyStyles(),this.setValue(this.config.value)}_createLinearSlider(){"vertical"===this.config.type?(this.originalConfig.hasOwnProperty("trackWidth")||(this.config.trackWidth=8),this.originalConfig.hasOwnProperty("trackHeight")||(this.config.trackHeight=Math.max(100,this.config.height-40))):(this.originalConfig.hasOwnProperty("trackWidth")||(this.config.trackWidth=Math.max(100,this.config.width-40)),this.originalConfig.hasOwnProperty("trackHeight")||(this.config.trackHeight=8)),this._createContainer(),this._createTrack(),this._createProgress(),this._createThumb()}_createCircularSlider(){this._createCircularContainer(),this._createCircularTrack(),this._createCircularProgress(),this._createCircularThumb()}_createContainer(){this.config.type,this.elements.container=new A({attach:this.config.attach,id:this.config.id+"_container",markup:"div",role:"slider-container",x:this.config.x,y:this.config.y,width:this.config.width,height:this.config.height,backgroundColor:"#ffffff",border:this.config.support.border,smooth:this.config.support.borderRadius?parseInt(this.config.support.borderRadius):12,padding:this.config.support.padding?parseInt(this.config.support.padding):15,boxShadow:this.config.support.boxShadow,overflow:"visible"});const t=()=>{this.elements.container&&this.elements.container.html_object?(this.elements.container.html_object.style.background=this.config.support.backgroundColor,this.elements.container.html_object.style.backgroundImage=this.config.support.backgroundColor.includes("gradient")?this.config.support.backgroundColor:""):setTimeout(t,10)};setTimeout(t,50)}_createTrack(){this.config.type;const t=2*(this.config.support.padding?parseInt(this.config.support.padding):15),e=this.config.width-t,i=this.config.height-t;this.elements.track=new A({attach:`#${this.config.id}_container`,id:this.config.id+"_track",markup:"div",x:(e-this.config.trackWidth)/2,y:(i-this.config.trackHeight)/2,width:this.config.trackWidth,height:this.config.trackHeight,backgroundColor:this.config.rail.backgroundColor,smooth:this.config.rail.borderRadius?parseInt(this.config.rail.borderRadius):3,position:"relative",cursor:"pointer"})}_createProgress(){const t="vertical"===this.config.type,e=this.currentValue/(this.config.max-this.config.min)*(t?this.config.trackHeight:this.config.trackWidth);this.elements.progress=new A({attach:`#${this.config.id}_track`,id:this.config.id+"_progress",markup:"div",x:0,y:t?this.config.trackHeight-e:0,width:t?this.config.trackWidth:e,height:t?e:this.config.trackHeight,backgroundColor:"#ffffff",smooth:this.config.progress.borderRadius?parseInt(this.config.progress.borderRadius):3,position:"absolute",transition:this.config.animations.enabled?this.config.progress.transition||`${t?"height":"width"} ${this.config.animations.duration}s ${this.config.animations.easing}`:"none",boxShadow:this.config.progress.boxShadow});const i=()=>{this.elements.progress&&this.elements.progress.html_object?(this.elements.progress.html_object.style.background=this.config.progress.backgroundColor,this.elements.progress.html_object.style.backgroundImage=this.config.progress.backgroundColor.includes("gradient")?this.config.progress.backgroundColor:""):setTimeout(i,10)};setTimeout(i,50)}_createThumb(){const t="vertical"===this.config.type,e=t?this.config.trackHeight:this.config.trackWidth,i=this.currentValue/(this.config.max-this.config.min)*e;this.elements.thumb=new A({attach:`#${this.config.id}_track`,id:this.config.id+"_thumb",markup:"div",x:t?(this.config.trackWidth-this.config.grip.width)/2:i-this.config.grip.width/2,y:t?this.config.trackHeight-i-this.config.grip.height/2:(this.config.trackHeight-this.config.grip.height)/2,width:this.config.grip.width,height:this.config.grip.height,backgroundColor:this.config.grip.backgroundColor,smooth:this.config.grip.borderRadius||"50%",position:"absolute",cursor:this.config.grip.cursor,transition:this.config.animations.enabled?this.config.grip.transition||`transform ${this.config.animations.duration}s ${this.config.animations.easing}, box-shadow ${this.config.animations.duration}s ${this.config.animations.easing}`:"none",boxShadow:this.config.grip.boxShadow,border:this.config.grip.border})}_applyStyles(){if(this._applyTheme(),this._applySupportStyles(),this._applyRailStyles(),this._applyProgressStyles(),this._applyGripStyles(),!document.getElementById("slider-animations")){const t=document.createElement("style");t.id="slider-animations",t.textContent="\n                @keyframes ripple {\n                    to {\n                        transform: translate(-50%, -50%) scale(4);\n                        opacity: 0;\n                    }\n                }\n                \n                .slider-thumb:focus {\n                    outline: 2px solid #2196f3;\n                    outline-offset: 2px;\n                }\n            ",document.head.appendChild(t)}}_updateVariationColors(t){if(!this.config.variation||!Array.isArray(this.config.variation)){const e=120*t,i=`hsl(${e}, 70%, 50%)`;return this.elements.progress.html_object.style.backgroundColor=i,this.elements.thumb.html_object.style.backgroundColor=i,void(this.elements.thumb.html_object.style.boxShadow=`0 4px 12px hsla(${e}, 70%, 50%, 0.4)`)}const e=this.config.variation;if(0===e.length)return;if(1===e.length){const t=e[0].color;return this.elements.progress.html_object.style.backgroundColor=t,void(this.elements.thumb.html_object.style.backgroundColor=t)}let i=e[0],s=e[e.length-1];for(let n=0;n<e.length-1;n++){const o=this._parsePosition(e[n].position)/100,r=this._parsePosition(e[n+1].position)/100;if(t>=o&&t<=r){i=e[n],s=e[n+1];break}}const n=this._parsePosition(i.position)/100,o=this._parsePosition(s.position)/100,r=n===o?0:(t-n)/(o-n),a=this._interpolateColors(i.color,s.color,r);this.elements.progress.html_object.style.backgroundColor=a,this.elements.thumb.html_object.style.backgroundColor=a;const l=this._addAlphaToColor(a,.4);this.elements.thumb.html_object.style.boxShadow=`0 4px 12px ${l}`}_parsePosition(t){return"string"==typeof t?parseFloat(t.replace("%","")):"object"==typeof t&&t.x?parseFloat(t.x.replace("%","")):0}_interpolateColors(t,e,i){const s=this._hexToRgb(t),n=this._hexToRgb(e);if(!s||!n)return t;return`rgb(${Math.round(s.r+i*(n.r-s.r))}, ${Math.round(s.g+i*(n.g-s.g))}, ${Math.round(s.b+i*(n.b-s.b))})`}_hexToRgb(t){if(t.startsWith("#")){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const e=document.createElement("div");e.style.color=t,document.body.appendChild(e);const i=window.getComputedStyle(e).color;document.body.removeChild(e);const s=i.match(/\d+/g);return s?{r:parseInt(s[0]),g:parseInt(s[1]),b:parseInt(s[2])}:null}_addAlphaToColor(t,e){return t.startsWith("rgb(")?t.replace("rgb(","rgba(").replace(")",`, ${e})`):t}_applyTheme(){const t={material:{containerShadow:"0 8px 32px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08)",thumbShadow:"0 4px 12px rgba(33, 150, 243, 0.4)",borderRadius:"12px"},flat:{containerShadow:"none",thumbShadow:"none",borderRadius:"0px"},custom:{}},e=t[this.config.theme]||t.material;e.containerShadow&&(this.elements.container.html_object.style.boxShadow=e.containerShadow),e.thumbShadow&&this.elements.thumb&&(this.elements.thumb.html_object.style.boxShadow=e.thumbShadow),e.borderRadius&&(this.elements.container.html_object.style.borderRadius=e.borderRadius)}_attachEvents(){this._attachHoverEvents(),this._attachClickEvents(),this._attachDragEvents(),this._attachKeyboardEvents()}_attachCircularEvents(){this._attachCircularHoverEvents(),this._attachCircularKeyboardEvents()}_attachCircularHoverEvents(){this.elements.thumb&&(this.elements.thumb.html_object.addEventListener("mouseenter",(()=>{this.isDragging||(this.elements.thumb.html_object.style.transform="scale(1.2)")})),this.elements.thumb.html_object.addEventListener("mouseleave",(()=>{this.isDragging||(this.elements.thumb.html_object.style.transform="scale(1)")})))}_attachCircularKeyboardEvents(){this.elements.thumb&&(this.elements.thumb.html_object.setAttribute("tabindex","0"),this.elements.thumb.html_object.classList.add("slider-thumb"),this.elements.thumb.html_object.addEventListener("keydown",(t=>{let e=this.currentValue;switch(t.key){case"ArrowLeft":case"ArrowDown":e-=this.config.step;break;case"ArrowRight":case"ArrowUp":e+=this.config.step;break;case"Home":e=this.config.min;break;case"End":e=this.config.max;break;default:return}this.setValue(e),this._triggerCallback("onChange",e),t.preventDefault()})))}_attachHoverEvents(){this.elements.thumb.html_object.addEventListener("mouseenter",(()=>{this.isDragging||(this.elements.thumb.html_object.style.transform="scale(1.2)")})),this.elements.thumb.html_object.addEventListener("mouseleave",(()=>{this.isDragging||(this.elements.thumb.html_object.style.transform="scale(1)")}))}_attachClickEvents(){"circular"!==this.config.type&&this.elements.track.html_object.addEventListener("click",(t=>{if(!this.isDragging){const e=this._getValueFromEvent(t);this.setValue(e),this._createRipple(t),this._triggerCallback("onChange",e)}}))}_attachDragEvents(){this.elements.thumb.html_object.addEventListener("mousedown",(t=>{this._startDrag(t)}))}_attachKeyboardEvents(){this.elements.thumb.html_object.setAttribute("tabindex","0"),this.elements.thumb.html_object.classList.add("slider-thumb"),this.elements.thumb.html_object.addEventListener("keydown",(t=>{let e=this.currentValue;switch(t.key){case"ArrowLeft":case"ArrowDown":e-=this.config.step;break;case"ArrowRight":case"ArrowUp":e+=this.config.step;break;case"Home":e=this.config.min;break;case"End":e=this.config.max;break;default:return}this.setValue(e),this._triggerCallback("onChange",e),t.preventDefault()}))}_startDrag(t){this.isDragging=!0,this.elements.thumb.html_object.style.transform="scale(1.3)",this.elements.thumb.html_object.style.zIndex="1000",document.body.style.userSelect="none",this.elements.progress.html_object.style.transition="none",this._triggerCallback("onStart",this.currentValue);const e=t=>{if(this.isDragging){const e=this._getValueFromEvent(t);this.setValue(e),this._triggerCallback("onChange",e)}},i=()=>{if(this.isDragging=!1,this.elements.thumb.html_object.style.transform="scale(1)",this.elements.thumb.html_object.style.zIndex="",document.body.style.userSelect="",this.config.animations.enabled){const t="vertical"===this.config.type;this.elements.progress.html_object.style.transition=`${t?"height":"width"} ${this.config.animations.duration}s ${this.config.animations.easing}`}this._triggerCallback("onEnd",this.currentValue),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",i),t.preventDefault()}_getValueFromEvent(t){const e="vertical"===this.config.type;if("circular"===this.config.type)return this._getValueFromCircularEvent(t);const i=this.elements.track.html_object.getBoundingClientRect();let s;if(e){const e=i.height;s=(i.bottom-t.clientY)/e}else s=(t.clientX-i.left)/i.width;const n=this.config.min+s*(this.config.max-this.config.min);return Math.max(this.config.min,Math.min(this.config.max,n))}_createRipple(t){const e=document.createElement("div");e.style.cssText="\n            position: absolute;\n            width: 20px;\n            height: 20px;\n            background: rgba(33, 150, 243, 0.3);\n            border-radius: 50%;\n            pointer-events: none;\n            transform: translate(-50%, -50%) scale(0);\n            animation: ripple 0.6s ease-out;\n        ";const i=this.elements.track.html_object.getBoundingClientRect();"vertical"===this.config.type?(e.style.left="50%",e.style.top=t.clientY-i.top+"px"):(e.style.left=t.clientX-i.left+"px",e.style.top="50%"),this.elements.track.html_object.appendChild(e),setTimeout((()=>e.remove()),600)}_triggerCallback(t,e){const i=this.config.callbacks[t];"function"==typeof i&&i(e,this)}setValue(t){if(this.currentValue,this.currentValue=Math.max(this.config.min,Math.min(this.config.max,t)),"circular"===this.config.type)return this._setCircularValue(this.currentValue),this;const e="vertical"===this.config.type,i=e?this.config.trackHeight:this.config.trackWidth,s=(this.currentValue-this.config.min)/(this.config.max-this.config.min),n=s*i,o=n;return e?(this.elements.progress.height(n),this.elements.progress.y(i-n),this.elements.thumb.y(i-o-this.config.grip.height/2)):(this.elements.progress.width(n),this.elements.thumb.x(o-this.config.grip.width/2)),this._updateVariationColors(s),this}getValue(){return this.currentValue}getCurrentValue(){return this.currentValue}setConfig(t){this.config={...this.config,...t},this._mergeStyleAPIs(),this._applyStyles()}setGripStyle(t){this.config.grip={...this.config.grip,...t},this._applyGripStyles()}setSupportStyle(t){this.config.support={...this.config.support,...t},this._applySupportStyles()}setRailStyle(t){this.config.rail={...this.config.rail,...t},this._applyRailStyles()}setProgressStyle(t){this.config.progress={...this.config.progress,...t},this._applyProgressStyles()}_applyGripStyles(){if(!this.elements.thumb)return;const t=this.elements.thumb.html_object;this.config.grip.backgroundColor&&(t.style.backgroundColor=this.config.grip.backgroundColor),this.config.grip.border&&(t.style.border=this.config.grip.border),this.config.grip.borderRadius&&(t.style.borderRadius=this.config.grip.borderRadius),this.config.grip.boxShadow&&(t.style.boxShadow=this.config.grip.boxShadow),this.config.grip.cursor&&(t.style.cursor=this.config.grip.cursor),this.config.grip.transition&&(t.style.transition=this.config.grip.transition)}_applySupportStyles(){if(!this.elements.container)return;const t=this.elements.container.html_object;this.config.support.backgroundColor&&(t.style.backgroundColor=this.config.support.backgroundColor),this.config.support.border&&(t.style.border=this.config.support.border),this.config.support.borderRadius&&(t.style.borderRadius=this.config.support.borderRadius),this.config.support.boxShadow&&(t.style.boxShadow=this.config.support.boxShadow),this.config.support.padding&&(t.style.padding=this.config.support.padding)}_applyRailStyles(){if(!this.elements.track)return;const t=this.elements.track.html_object;"circular"!==this.config.type&&this.config.rail.backgroundColor&&(t.style.backgroundColor=this.config.rail.backgroundColor),this.config.rail.borderRadius&&(t.style.borderRadius=this.config.rail.borderRadius)}_applyProgressStyles(){if(!this.elements.progress)return;const t=this.elements.progress.html_object;this.config.progress.backgroundColor&&(t.style.backgroundColor=this.config.progress.backgroundColor),this.config.progress.borderRadius&&(t.style.borderRadius=this.config.progress.borderRadius),this.config.progress.boxShadow&&(t.style.boxShadow=this.config.progress.boxShadow),this.config.progress.transition&&(t.style.transition=this.config.progress.transition)}destroy(){this.elements.container&&this.elements.container.html_object.remove()}_createCircularContainer(){const t=2*this.config.circular.radius+this.config.thumbSize+20;this.elements.container=new A({attach:this.config.attach,id:this.config.id+"_container",markup:"div",role:"circular-slider-container",x:this.config.x-200,y:this.config.y,width:t,height:t,backgroundColor:this.config.colors.container,smooth:12,padding:10,boxShadow:"0 8px 32px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08)",border:"1px solid rgba(0,0,0,0.04)",overflow:"visible",position:"relative"})}_createCircularTrack(){const{radius:t,strokeWidth:e,startAngle:i,endAngle:s}=this.config.circular,n=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=2*t+e+20;n.setAttribute("width",o),n.setAttribute("height",o),n.style.position="absolute";const r=(2*this.config.circular.radius+this.config.thumbSize+20-o)/2;n.style.left=r+"px",n.style.top=r+"px",n.style.pointerEvents="auto",n.style.cursor="pointer",n.style.zIndex="5",n.style.display="block",n.style.visibility="visible",n.style.opacity="1",n.style.backgroundColor="transparent",n.style.setProperty("border-radius","0","important");const a=t+e/2+10,l=t+e/2+10,h=document.createElementNS("http://www.w3.org/2000/svg","path"),c=(i-90)*Math.PI/180,d=(s-90)*Math.PI/180,u=a+t*Math.cos(c),p=l+t*Math.sin(c),g=a+t*Math.cos(d),m=l+t*Math.sin(d),f=`M ${u} ${p} A ${t} ${t} 0 ${Math.abs(s-i)>180?1:0} 1 ${g} ${m}`;h.setAttribute("d",f),h.setAttribute("fill","none"),h.setAttribute("stroke",this.config.colors.track),h.setAttribute("stroke-width",e),h.setAttribute("stroke-linecap","round"),h.style.display="block",h.style.visibility="visible",h.style.opacity="1",h.addEventListener("click",(t=>{if(t.preventDefault(),t.stopPropagation(),!this.isDragging){const e=this._getValueFromCircularEvent(t);e!==this.currentValue&&(this.setValue(e),this._triggerCallback("onChange",e))}})),n.addEventListener("click",(t=>{if(t.preventDefault(),t.stopPropagation(),!this.isDragging&&t.target!==this.elements.thumb?.html_object){const e=this._getValueFromCircularEvent(t);e!==this.currentValue&&(this.setValue(e),this._triggerCallback("onChange",e))}})),h.addEventListener("mouseenter",(()=>{h.style.opacity="0.8"})),h.addEventListener("mouseleave",(()=>{h.style.opacity="1"})),n.appendChild(h),this.elements.container.html_object.appendChild(n),this.elements.track={html_object:n,arc:h,radius:t}}_createCircularProgress(){const{radius:t,strokeWidth:e}=this.config.circular,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("fill","none"),i.setAttribute("stroke",this.config.colors.progress),i.setAttribute("stroke-width",e),i.setAttribute("stroke-linecap","round"),this.elements.track.html_object.appendChild(i),this.elements.progress={html_object:i}}_createCircularThumb(){const{radius:t,strokeWidth:e,startAngle:i,endAngle:s}=this.config.circular,n=i+(this.currentValue-this.config.min)/(this.config.max-this.config.min)*(s-i),o=2*t+e+20,r=(2*t+this.config.thumbSize+20-o)/2,a=t+e/2+10,l=t+e/2+10,h=(n-90)*Math.PI/180,c=r+a+t*Math.cos(h)-this.config.thumbSize/2,d=r+l+t*Math.sin(h)-this.config.thumbSize/2;this.elements.thumb=new A({attach:`#${this.config.id}_container`,id:this.config.id+"_thumb",markup:"div",x:c,y:d,width:this.config.thumbSize,height:this.config.thumbSize,backgroundColor:this.config.colors.thumb,smooth:this.config.thumbSize/2,position:"absolute",cursor:"grab",boxShadow:"0 4px 12px rgba(33, 150, 243, 0.4), 0 2px 4px rgba(0,0,0,0.1)",border:"3px solid white",transition:this.config.animations.enabled?`transform ${this.config.animations.duration}s ${this.config.animations.easing}`:"none",zIndex:25,display:"block",visibility:"visible",pointerEvents:"auto"}),this.elements.thumb.html_object.style.display="block",this.elements.thumb.html_object.style.visibility="visible",this.elements.thumb.html_object.style.position="absolute",this.elements.thumb.html_object.style.zIndex="25",this.elements.thumb.html_object.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation()})),this.elements.thumb.html_object.addEventListener("pointerdown",(t=>{t.preventDefault(),t.stopPropagation(),this.isDragging=!0,this.elements.thumb.html_object.style.cursor="grabbing";const e=this.elements.thumb.html_object.style.transition;this.elements.thumb.html_object.style.transition="none",this._triggerCallback("onStart",this.currentValue);const i=t=>{if(!this.isDragging)return;t.preventDefault(),t.stopPropagation();const e=this._getValueFromCircularEvent(t);e!==this.currentValue&&(this.setValue(e),this._triggerCallback("onDrag",e))},s=t=>{this.isDragging&&(this.isDragging=!1,this.elements.thumb.html_object.style.cursor="grab",this.elements.thumb.html_object.style.transition=e,this._triggerCallback("onEnd",this.currentValue),this._triggerCallback("onChange",this.currentValue)),document.removeEventListener("pointermove",i),document.removeEventListener("pointerup",s),document.removeEventListener("pointercancel",s)};document.addEventListener("pointermove",i,{passive:!1}),document.addEventListener("pointerup",s),document.addEventListener("pointercancel",s)}))}_getValueFromCircularEvent(t){const{radius:e,strokeWidth:i,startAngle:s,endAngle:n}=this.config.circular,o=this.elements.container.html_object.getBoundingClientRect(),r=o.left+o.width/2,a=o.top+o.height/2,l=t.clientX-r,h=t.clientY-a;let c=180*Math.atan2(h,l)/Math.PI+90;for(;c<0;)c+=360;for(;c>=360;)c-=360;let d=this._getRelativePositionOnArc(c,s,n);const u=this.config.min+d*(this.config.max-this.config.min),p=Math.round(u/this.config.step)*this.config.step;return Math.max(this.config.min,Math.min(this.config.max,p))}_getRelativePositionOnArc(t,e,i){let s,n=e%360,o=i%360;if(n<0&&(n+=360),o<0&&(o+=360),n<=o){const e=o-n;if(t>=n&&t<=o)s=(t-n)/e;else{this.getCurrentValue();this.config.min,this.config.max,this.config.min;const i=this._getAngularDistance(t,n),r=this._getAngularDistance(t,o);s=i<r||i===r&&t<n+e/2?0:1}}else{const e=360-n+o;if(t>=n||t<=o)s=t>=n?(t-n)/e:(360-n+t)/e;else{s=t<=(o+n)/2?1:0}}return Math.max(0,Math.min(1,s))}_getAngularDistance(t,e){const i=Math.abs(t-e);return Math.min(i,360-i)}_setCircularValue(t){this.currentValue=Math.max(this.config.min,Math.min(this.config.max,t));const e=(this.currentValue-this.config.min)/(this.config.max-this.config.min),{radius:i,strokeWidth:s,startAngle:n,endAngle:o}=this.config.circular,r=n+e*(o-n),a=2*this.config.circular.radius+this.config.thumbSize+20,l=a/2,h=a/2,c=(r-90)*Math.PI/180,d=l+i*Math.cos(c)-this.config.thumbSize/2,u=h+i*Math.sin(c)-this.config.thumbSize/2;if(this.elements.thumb&&this.elements.thumb.html_object){this.elements.thumb.html_object.style.left=d+"px",this.elements.thumb.html_object.style.top=u+"px",this.elements.thumb.html_object.style.display="block",this.elements.thumb.html_object.style.position="absolute",this.elements.thumb.html_object.style.zIndex="20";try{this.elements.thumb.x(d),this.elements.thumb.y(u)}catch(t){}}this._updateCircularProgress(e),this._updateCircularVariationColors(e)}_updateCircularProgress(t){if(!this.elements.progress||!this.elements.progress.html_object)return;const{radius:e,strokeWidth:i,startAngle:s,endAngle:n}=this.config.circular,o=e+i/2+10,r=e+i/2+10,a=s+t*(n-s),l=(s-90)*Math.PI/180,h=(a-90)*Math.PI/180,c=o+e*Math.cos(l),d=r+e*Math.sin(l),u=o+e*Math.cos(h),p=r+e*Math.sin(h),g=Math.abs(a-s);let m;m=t<=.001?`M ${c} ${d} L ${c} ${d}`:`M ${c} ${d} A ${e} ${e} 0 ${g>180?1:0} 1 ${u} ${p}`,this.elements.progress.html_object.setAttribute("d",m)}_updateCircularVariationColors(t){if(!this.config.variation||!Array.isArray(this.config.variation))return;const e=this.config.variation;if(0===e.length)return;if(1===e.length)return this.elements.progress&&this.elements.progress.html_object&&this.elements.progress.html_object.setAttribute("stroke",e[0].color),void(this.elements.thumb&&this.elements.thumb.html_object&&(this.elements.thumb.html_object.style.backgroundColor=e[0].color));let i=e[0],s=e[e.length-1];for(let n=0;n<e.length-1;n++){const o=this._parsePosition(e[n].position)/100,r=this._parsePosition(e[n+1].position)/100;if(t>=o&&t<=r){i=e[n],s=e[n+1];break}}const n=this._parsePosition(i.position)/100,o=this._parsePosition(s.position)/100,r=n===o?0:(t-n)/(o-n),a=this._interpolateColors(i.color,s.color,r);if(this.elements.progress&&this.elements.progress.html_object&&this.elements.progress.html_object.setAttribute("stroke",a),this.elements.thumb&&this.elements.thumb.html_object){this.elements.thumb.html_object.style.backgroundColor=a;const t=this._addAlphaToColor(a,.4);this.elements.thumb.html_object.style.boxShadow=`0 4px 12px ${t}`}}}window.Slider=Slider;class Matrix{static matrices=new Map;static resizeObserver=null;constructor(t={}){this.config={id:t.id||`matrix_${Date.now()}`,attach:t.attach||"body",grid:{x:t.grid?.x||3,y:t.grid?.y||3},position:{x:t.position?.x||0,y:t.position?.y||0},size:{width:t.size?.width||"300px",height:t.size?.height||"300px"},spacing:{horizontal:t.spacing?.horizontal||2,vertical:t.spacing?.vertical||2,mode:t.spacing?.mode||"gap",uniform:!1!==t.spacing?.uniform,outer:t.spacing?.outer||0,animate:!1!==t.spacing?.animate,adaptiveMin:t.spacing?.adaptiveMin||0,responsive:t.spacing?.responsive||!1,debugMode:t.spacing?.debugMode||!1,gradient:t.spacing?.gradient||!1,gradientDirection:t.spacing?.gradientDirection||"horizontal",gradientIntensity:t.spacing?.gradientIntensity||.5,animationEasing:t.spacing?.animationEasing||"ease",animationDuration:t.spacing?.animationDuration||300,animationDelay:t.spacing?.animationDelay||0,reduceMotion:!1!==t.spacing?.reduceMotion,optimizeRendering:!1!==t.spacing?.optimizeRendering,semanticLabels:t.spacing?.semanticLabels||!1},cellStyle:{backgroundColor:"#3498db",border:"2px solid #2980b9",borderRadius:"4px",cursor:"pointer",transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"white",fontWeight:"bold",...t.cellStyle},cellHoverStyle:{backgroundColor:"#2980b9",transform:"scale(1.05)",...t.cellHoverStyle},cellSelectedStyle:{backgroundColor:"#e74c3c",border:"3px solid #c0392b",...t.cellSelectedStyle},longClickDuration:t.longClickDuration||600,callbacks:{onClick:t.callbacks?.onClick||(()=>{}),onDoubleClick:t.callbacks?.onDoubleClick||(()=>{}),onLongClick:t.callbacks?.onLongClick||(()=>{}),onMouseUp:t.callbacks?.onMouseUp||(()=>{}),onMouseDown:t.callbacks?.onMouseDown||(()=>{}),onHover:t.callbacks?.onHover||(()=>{}),onResize:t.callbacks?.onResize||(()=>{})}},this.id=this.config.id,this.cells=new Map,this.selectedCells=new Set,this.isPercentageSize=this._isPercentageSize(),this._createMatrix(),this._setupEventHandlers(),this._setupResizeObserver(),Matrix.matrices.set(this.id,this)}_isPercentageSize(){return"string"==typeof this.config.size.width&&this.config.size.width.includes("%")||"string"==typeof this.config.size.height&&this.config.size.height.includes("%")}_createMatrix(){const t="string"==typeof this.config.attach?document.querySelector(this.config.attach):this.config.attach;if(!t)throw new Error(`Container not found: ${this.config.attach}`);this.element=document.createElement("div"),this.element.className="squirrel-matrix",this.element.id=this.id;const e={position:"absolute",left:`${this.config.position.x}px`,top:`${this.config.position.y}px`,width:this.config.size.width,height:this.config.size.height,display:"grid",gridTemplateColumns:`repeat(${this.config.grid.x}, 1fr)`,gridTemplateRows:`repeat(${this.config.grid.y}, 1fr)`,boxSizing:"border-box",userSelect:"none"};this._applySpacingMethod(e),Object.assign(this.element.style,e),this._createCells(),t.appendChild(this.element)}_applySpacingMethod(t){const e=this.config.spacing,i=this._calculateResponsiveSpacing(e);if(e.animate&&e.reduceMotion&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches){const i=this._getEasingFunction(e.animationEasing);t.transition=`gap ${e.animationDuration}ms ${i}, padding ${e.animationDuration}ms ${i}`,e.optimizeRendering&&(t.willChange="gap, padding")}e.debugMode&&(t.outline="2px dashed #ff6b6b",t.outlineOffset="2px"),e.gradient?this._applyGradientSpacing(t,i):this._applyUniformSpacing(t,i),e.semanticLabels&&this.element.setAttribute("aria-label",`Matrix with ${e.mode} spacing: ${i.horizontal}px horizontal, ${i.vertical}px vertical`)}_getEasingFunction(t){return{ease:"ease","ease-in":"ease-in","ease-out":"ease-out","ease-in-out":"ease-in-out",linear:"linear",bounce:"cubic-bezier(0.68, -0.55, 0.265, 1.55)",elastic:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",smooth:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",sharp:"cubic-bezier(0.4, 0.0, 0.6, 1)",gentle:"cubic-bezier(0.25, 0.1, 0.25, 1)"}[t]||t}_applyGradientSpacing(t,e){const i=this.config.spacing,{gradientDirection:s,gradientIntensity:n}=i;this.gradientInfo={direction:s,intensity:n,baseSpacing:e},t.gap="0",t.padding=`${i.outer}px`,this.spacingMode="gradient",this.effectiveSpacing=e}_applyUniformSpacing(t,e){const i=this.config.spacing;switch(i.mode){case"gap":if(i.uniform){const s=(e.horizontal+e.vertical)/2;t.gap=`${Math.max(s,i.adaptiveMin)}px`}else t.gap=`${Math.max(e.vertical,i.adaptiveMin)}px ${Math.max(e.horizontal,i.adaptiveMin)}px`;t.padding=`${i.outer}px`;break;case"margin":t.gap="0",t.padding=`${i.outer}px`,this.spacingMode="margin",this.effectiveSpacing=e;break;case"padding":t.gap="0",t.padding=`${i.outer}px`,this.spacingMode="padding",this.effectiveSpacing=e;break;case"border":t.gap="0",t.padding=`${i.outer}px`,this.spacingMode="border",this.effectiveSpacing=e;break;default:t.gap=`${Math.max(e.vertical,i.adaptiveMin)}px ${Math.max(e.horizontal,i.adaptiveMin)}px`,t.padding=`${i.outer}px`}}_calculateResponsiveSpacing(t){if(!t.responsive)return{horizontal:t.horizontal,vertical:t.vertical};const e=window.innerWidth,i=this.element?.getBoundingClientRect(),s=i?.width||300,n=Math.min(1.5,Math.max(.5,s/(.3*e)));return{horizontal:Math.round(t.horizontal*n),vertical:Math.round(t.vertical*n)}}_createCells(){for(let t=1;t<=this.config.grid.y;t++)for(let e=1;e<=this.config.grid.x;e++)this._createCell(e,t)}_createCell(t,e){const i=`${this.id}_${t}_${e}`,s=document.createElement("div");s.className="matrix-cell",s.id=i,s.dataset.x=t,s.dataset.y=e,s.dataset.matrixId=this.id,Object.assign(s.style,this.config.cellStyle),this._applyCellSpacing(s,t,e),s.textContent=`${t},${e}`;const n={id:i,x:t,y:e,element:s,selected:!1,originalStyle:{...this.config.cellStyle}};return this.cells.set(i,n),this._setupCellEventHandlers(s,n),this.element.appendChild(s),s}_applyCellSpacing(t,e,i){const s=this.config.spacing,n=this.effectiveSpacing||{horizontal:s.horizontal,vertical:s.vertical};if(s.animate&&s.reduceMotion&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches){const n=this._getEasingFunction(s.animationEasing),o=s.animationDelay*(e-1+(i-1)*this.config.grid.x),r=s.animationDuration;t.style.transition=`margin ${r}ms ${n} ${o}ms, padding ${r}ms ${n} ${o}ms, border ${r}ms ${n} ${o}ms`,s.optimizeRendering&&(t.style.willChange="margin, padding, border",setTimeout((()=>{t.style.willChange="auto"}),r+o+100))}s.debugMode&&(t.style.boxShadow="inset 0 0 0 1px rgba(255, 107, 107, 0.5)"),"gradient"===this.spacingMode?this._applyGradientCellSpacing(t,e,i,n):this._applyStandardCellSpacing(t,e,i,n),s.semanticLabels&&t.setAttribute("aria-label",`Cell at position ${e}, ${i} with ${this.spacingMode} spacing`)}_applyGradientCellSpacing(t,e,i,s){const{direction:n,intensity:o}=this.gradientInfo,r=this.config.spacing,a=this.config.grid.x,l=this.config.grid.y;let h=1;switch(n){case"horizontal":h=1+o*(e-1)/(a-1);break;case"vertical":h=1+o*(i-1)/(l-1);break;case"radial":const t=(a+1)/2,s=(l+1)/2,n=Math.sqrt(Math.pow(t,2)+Math.pow(s,2));h=1+o*Math.sqrt(Math.pow(e-t,2)+Math.pow(i-s,2))/n;break;case"inverse-radial":const r=(a+1)/2,c=(l+1)/2,d=Math.sqrt(Math.pow(r,2)+Math.pow(c,2));h=1+o*(1-Math.sqrt(Math.pow(e-r,2)+Math.pow(i-c,2))/d)}const c=s.horizontal*h,d=s.vertical*h,u=1===i?0:Math.max(d/2,r.adaptiveMin/2),p=i===l?0:Math.max(d/2,r.adaptiveMin/2),g=1===e?0:Math.max(c/2,r.adaptiveMin/2),m=e===a?0:Math.max(c/2,r.adaptiveMin/2);t.style.margin=`${u}px ${m}px ${p}px ${g}px`}_applyStandardCellSpacing(t,e,i,s){const n=this.config.spacing;if("margin"===this.spacingMode){const o=1===i?0:Math.max(s.vertical/2,n.adaptiveMin/2),r=i===this.config.grid.y?0:Math.max(s.vertical/2,n.adaptiveMin/2),a=1===e?0:Math.max(s.horizontal/2,n.adaptiveMin/2),l=e===this.config.grid.x?0:Math.max(s.horizontal/2,n.adaptiveMin/2);t.style.margin=`${o}px ${l}px ${r}px ${a}px`}else if("padding"===this.spacingMode){const e=Math.max(s.horizontal/2,n.adaptiveMin/2),i=Math.max(s.vertical/2,n.adaptiveMin/2);t.style.padding=`${i}px ${e}px`}else if("border"===this.spacingMode){const e=Math.max(Math.max(s.horizontal,s.vertical)/2,n.adaptiveMin/2);t.style.border=`${e}px solid transparent`,t.style.backgroundClip="padding-box"}}_setupCellEventHandlers(t,e){let i=null,s=null,n=!1,o=0;t.addEventListener("mousedown",(t=>{n=!1,s=setTimeout((()=>{n=!0,this.config.callbacks.onLongClick(e.id,e.x,e.y,e,t)}),this.config.longClickDuration),this.config.callbacks.onMouseDown(e.id,e.x,e.y,e,t)})),t.addEventListener("mouseup",(t=>{s&&(clearTimeout(s),s=null),this.config.callbacks.onMouseUp(e.id,e.x,e.y,e,t)})),t.addEventListener("click",(t=>{n?n=!1:(o++,1===o?i=setTimeout((()=>{this.config.callbacks.onClick(e.id,e.x,e.y,e,t),o=0}),300):2===o&&(clearTimeout(i),this.config.callbacks.onDoubleClick(e.id,e.x,e.y,e,t),o=0))})),t.addEventListener("mouseenter",(i=>{e.selected||Object.assign(t.style,this.config.cellHoverStyle),this.config.callbacks.onHover(e.id,e.x,e.y,e,i)})),t.addEventListener("mouseleave",(i=>{e.selected||Object.assign(t.style,e.originalStyle)}))}_setupEventHandlers(){this.element.addEventListener("mouseleave",(()=>{}))}_setupResizeObserver(){this.isPercentageSize&&(Matrix.resizeObserver||(Matrix.resizeObserver=new ResizeObserver((t=>{Matrix.matrices.forEach((t=>{t.isPercentageSize&&t._handleResize()}))})),Matrix.resizeObserver.observe(document.body)))}_handleResize(){const t=this.element.getBoundingClientRect();this.config.callbacks.onResize(this,t.width,t.height)}getCellById(t){return this.cells.get(t)}getCellByCoordinates(t,e){const i=`${this.id}_${t}_${e}`;return this.cells.get(i)}selectCell(t,e){const i=this.getCellByCoordinates(t,e);i&&!i.selected&&(i.selected=!0,this.selectedCells.add(i.id),Object.assign(i.element.style,this.config.cellSelectedStyle))}deselectCell(t,e){const i=this.getCellByCoordinates(t,e);i&&i.selected&&(i.selected=!1,this.selectedCells.delete(i.id),Object.assign(i.element.style,i.originalStyle))}selectAll(){this.cells.forEach((t=>{t.selected||(t.selected=!0,this.selectedCells.add(t.id),Object.assign(t.element.style,this.config.cellSelectedStyle))}))}deselectAll(){this.cells.forEach((t=>{t.selected&&(t.selected=!1,Object.assign(t.element.style,t.originalStyle))})),this.selectedCells.clear()}setCellStyle(t,e,i){const s=this.getCellByCoordinates(t,e);s&&(Object.assign(s.element.style,i),s.selected||Object.assign(s.originalStyle,i))}resetCellStyle(t,e){const i=this.getCellByCoordinates(t,e);if(i){const t={...this.config.cellStyle};Object.assign(i.element.style,t),i.originalStyle=t}}getSelectedCells(){return Array.from(this.selectedCells).map((t=>this.cells.get(t)))}getAllCells(){return Array.from(this.cells.values())}resize(t){t.width&&(this.config.size.width=t.width,this.element.style.width=t.width),t.height&&(this.config.size.height=t.height,this.element.style.height=t.height),this.isPercentageSize=this._isPercentageSize(),this._setupResizeObserver()}moveTo(t,e){this.config.position.x=t,this.config.position.y=e,this.element.style.left=`${t}px`,this.element.style.top=`${e}px`}setGridSize(t,e){this.config.grid.x=t,this.config.grid.y=e,this.cells.clear(),this.selectedCells.clear(),this.element.innerHTML="",this.element.style.gridTemplateColumns=`repeat(${t}, 1fr)`,this.element.style.gridTemplateRows=`repeat(${e}, 1fr)`,this._createCells()}destroy(){this.element.remove(),Matrix.matrices.delete(this.id);!Array.from(Matrix.matrices.values()).some((t=>t.isPercentageSize))&&Matrix.resizeObserver&&(Matrix.resizeObserver.disconnect(),Matrix.resizeObserver=null)}setSpacing(t,e={}){const{skipAnimation:i=!1,batchUpdate:s=!0,triggerResize:n=!1}=e,o={...this.config.spacing};Object.assign(this.config.spacing,t);const r=this.config.spacing.animate;i&&(this.config.spacing.animate=!1),s?this._batchSpacingUpdate(o):this._immediateSpacingUpdate(),this.config.spacing.animate=r,n&&this.config.spacing.responsive&&this._handleResize()}_batchSpacingUpdate(t){requestAnimationFrame((()=>{const t={};this._applySpacingMethod(t),Object.assign(this.element.style,t),document.createDocumentFragment();const e=[];this.cells.forEach((t=>{e.push(t)})),this._processCellsInChunks(e,0)}))}_processCellsInChunks(t,e,i=10){const s=Math.min(e+i,t.length);for(let i=e;i<s;i++){const e=t[i];this._resetAndApplyCellSpacing(e)}s<t.length&&requestAnimationFrame((()=>{this._processCellsInChunks(t,s,i)}))}_resetAndApplyCellSpacing(t){t.element.style.margin="",t.element.style.padding="",t.element.style.border="",t.element.style.backgroundClip="",t.element.style.boxShadow="",t.element.style.transition="",Object.assign(t.element.style,t.originalStyle),this._applyCellSpacing(t.element,t.x,t.y)}_immediateSpacingUpdate(){const t={};this._applySpacingMethod(t),Object.assign(this.element.style,t),this.cells.forEach((t=>{this._resetAndApplyCellSpacing(t)}))}applySpacingPreset(t,e={}){const i=Matrix.getSpacingPresets()[t];if(!i)return;const s={...i,...e};this.setSpacing(s,{batchUpdate:!0})}validateSpacing(t){const e=[];return t.horizontal<0&&e.push("Horizontal spacing cannot be negative"),t.vertical<0&&e.push("Vertical spacing cannot be negative"),t.outer<0&&e.push("Outer spacing cannot be negative"),t.adaptiveMin<0&&e.push("Adaptive minimum cannot be negative"),["gap","margin","padding","border"].includes(t.mode)||e.push("Invalid spacing mode. Must be: gap, margin, padding, or border"),"border"===t.mode&&Math.max(t.horizontal,t.vertical)>10&&e.push("Border mode is not recommended for spacing > 10px"),{valid:0===e.length,errors:e}}getSpacingMetrics(){const t=this.cells.size,e=this.config.spacing.mode,i=this.config.spacing.responsive,s=this.config.spacing.animate,n=this.config.spacing.gradient,o="ease"!==this.config.spacing.animationEasing;let r=100;return"gap"!==e&&(r-=20),i&&(r-=15),s&&(r-=10),n&&(r-=15),o&&(r-=5),t>50&&(r-=Math.min(30,.5*(t-50))),this.config.spacing.optimizeRendering&&(r+=5),this.config.spacing.reduceMotion&&(r+=3),{cellCount:t,spacingMode:e,isResponsive:i,hasAnimation:s,hasGradient:n,customEasing:o,optimizeRendering:this.config.spacing.optimizeRendering,reduceMotion:this.config.spacing.reduceMotion,performanceScore:Math.max(0,Math.min(100,r)),recommendations:this._getPerformanceRecommendations(r),memoryUsage:this._estimateMemoryUsage(),renderingComplexity:this._calculateRenderingComplexity()}}_getPerformanceRecommendations(t){const e=[],i=this.config.spacing;return t<70&&e.push('Consider using "gap" mode for better performance'),i.responsive&&this.cells.size>30&&e.push("Disable responsive spacing for large grids"),i.animate&&this.cells.size>50&&e.push("Disable animations for large cell counts"),i.gradient&&this.cells.size>25&&e.push("Gradient spacing adds complexity - consider uniform spacing"),i.optimizeRendering||!i.animate&&!i.gradient||e.push("Enable rendering optimization for better performance"),i.animationDelay>0&&this.cells.size>20&&e.push("Reduce animation delay for large matrices"),e}_estimateMemoryUsage(){const t=.5*this.cells.size;let e=0;return this.config.spacing.animate&&(e+=.2*this.cells.size),this.config.spacing.gradient&&(e+=.3*this.cells.size),this.config.spacing.responsive&&(e+=.5),Math.round(100*(t+e))/100}_calculateRenderingComplexity(){let t=1;return"gap"!==this.config.spacing.mode&&(t+=.5),this.config.spacing.animate&&(t+=.3),this.config.spacing.gradient&&(t+=.7),this.config.spacing.responsive&&(t+=.4),this.config.spacing.debugMode&&(t+=.2),Math.round(100*t)/100}analyzeSpacingPerformance(){const t=this.getSpacingMetrics(),e={...t,bottlenecks:[],optimizations:[],timestamp:Date.now()};return t.cellCount>100&&e.bottlenecks.push("Large cell count may impact performance"),t.hasGradient&&t.hasAnimation&&e.bottlenecks.push("Gradient + animation combination is computationally expensive"),this.config.spacing.animationDelay>0&&t.cellCount>30&&e.bottlenecks.push("Staggered animations with many cells cause long animation sequences"),this.config.spacing.optimizeRendering||!t.hasAnimation&&!t.hasGradient||e.optimizations.push("Enable optimizeRendering for GPU acceleration"),t.customEasing&&t.cellCount>50&&e.optimizations.push("Use simpler easing functions for better performance"),t.isResponsive&&window.innerWidth<768&&e.optimizations.push("Consider disabling responsive spacing on mobile devices"),e}autoOptimizeSpacing(){const t=[];return this.analyzeSpacingPerformance().performanceScore<60&&("gap"!==this.config.spacing.mode&&this.cells.size<30&&(this.setSpacing({mode:"gap"}),t.push("Switched to gap mode for better performance")),this.config.spacing.animate&&this.cells.size>50&&(this.setSpacing({animate:!1}),t.push("Disabled animations for large matrix")),this.config.spacing.gradient&&this.cells.size>40&&(this.setSpacing({gradient:!1}),t.push("Disabled gradient spacing for large matrix"))),this.config.spacing.optimizeRendering||(this.setSpacing({optimizeRendering:!0}),t.push("Enabled rendering optimization")),{optimizationsApplied:t,newScore:this.getSpacingMetrics().performanceScore}}}let t=null,e=null;class i extends EventTarget{static instances=new Map;constructor(t={}){super(),this.id=t.id||`wavesurfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.config={attach:t.attach||"body",x:t.x||100,y:t.y||100,width:t.width||800,height:t.height||120,url:t.url||null,peaks:t.peaks||null,waveColor:t.waveColor||"#4A90E2",progressColor:t.progressColor||"#2ECC71",cursorColor:t.cursorColor||"#E74C3C",barWidth:t.barWidth||2,barRadius:t.barRadius||1,responsive:!1!==t.responsive,interact:!1!==t.interact,dragToSeek:!1!==t.dragToSeek,hideScrollbar:!1!==t.hideScrollbar,normalize:!1!==t.normalize,backend:t.backend||"WebAudio",mediaControls:t.mediaControls||!1,style:{backgroundColor:"#FFFFFF",border:"1px solid rgba(0,0,0,0.1)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",overflow:"hidden",...t.style},controls:{enabled:!1!==t.controls?.enabled,play:!1!==t.controls?.play,pause:!1!==t.controls?.pause,stop:!1!==t.controls?.stop,mute:!1!==t.controls?.mute,volume:!1!==t.controls?.volume,download:t.controls?.download||!1,...t.controls},regions:{enabled:t.regions?.enabled||!1,dragSelection:!1!==t.regions?.dragSelection,snapToGridPercentage:t.regions?.snapToGridPercentage||null,...t.regions},plugins:t.plugins||[],enabledPlugins:t.enabledPlugins||["regions"],autoLoadPlugins:!1!==t.autoLoadPlugins,timeline:{enabled:t.timeline?.enabled||!1,height:t.timeline?.height||20,...t.timeline},minimap:{enabled:t.minimap?.enabled||!1,height:t.minimap?.height||50,...t.minimap},zoom:{enabled:t.zoom?.enabled||!1,scale:t.zoom?.scale||1,...t.zoom},hover:{enabled:t.hover?.enabled||!1,formatTimeCallback:t.hover?.formatTimeCallback||null,...t.hover},spectrogram:{enabled:t.spectrogram?.enabled||!1,height:t.spectrogram?.height||200,...t.spectrogram},record:{enabled:t.record?.enabled||!1,...t.record},envelope:{enabled:t.envelope?.enabled||!1,...t.envelope},callbacks:{onReady:t.callbacks?.onReady||(()=>{}),onPlay:t.callbacks?.onPlay||(()=>{}),onPause:t.callbacks?.onPause||(()=>{}),onFinish:t.callbacks?.onFinish||(()=>{}),onSeek:t.callbacks?.onSeek||(()=>{}),onTimeUpdate:t.callbacks?.onTimeUpdate||(()=>{}),onRegionCreate:t.callbacks?.onRegionCreate||(()=>{}),onRegionUpdate:t.callbacks?.onRegionUpdate||(()=>{}),onRegionRemove:t.callbacks?.onRegionRemove||(()=>{}),onError:t.callbacks?.onError||(t=>{}),...t.callbacks}},this.wavesurfer=null,this.isReady=!1,this.isPlaying=!1,this.currentTime=0,this.regions=new Map,this.plugins=new Map,this._init(),i.instances.set(this.id,this)}async _init(){try{await async function(){if(t)return t;try{const i=await Promise.resolve().then((function(){return f}));t=i.default;try{const t=await Promise.resolve().then((function(){return Et}));e=t.default||t.WaveSurferV7Loader,e&&"function"==typeof e&&(e=new e)}catch(t){e=null}return t}catch(t){throw new Error("WaveSurfer.js v7 could not be loaded. Ensure wavesurfer files are available in ./js/wavesurfer-v7/ directory")}}(),this._createContainer(),await this._initWaveSurfer(),this.config.controls.enabled&&this._createControls(),this._setupEventHandlers(),this.config.url&&await this.loadAudio(this.config.url)}catch(t){this.config.callbacks.onError(t)}}_createContainer(){const t="string"==typeof this.config.attach?document.querySelector(this.config.attach):this.config.attach;if(!t)throw new Error(`Container not found: ${this.config.attach}`);this.container=document.createElement("div"),this.container.className="squirrel-wavesurfer",this.container.id=this.id,Object.assign(this.container.style,{position:"absolute",left:`${this.config.x}px`,top:`${this.config.y}px`,width:`${this.config.width}px`,height:`${this.config.height}px`,zIndex:"1000",...this.config.style}),this.waveformContainer=document.createElement("div"),this.waveformContainer.className="wavesurfer-waveform",this.waveformContainer.style.cssText=`\n            width: 100%;\n            height: ${this.config.controls.enabled?"calc(100% - 50px)":"100%"};\n            position: relative;\n        `,this.container.appendChild(this.waveformContainer),t.appendChild(this.container)}async _initWaveSurfer(){if(!t)throw new Error("WaveSurfer.js library not loaded");this.config.autoLoadPlugins&&e&&await this._loadRequiredPlugins();const i=[...this.config.plugins||[]];await this._addEnabledPlugins(i);const s={container:this.waveformContainer,waveColor:this.config.waveColor,progressColor:this.config.progressColor,cursorColor:this.config.cursorColor,barWidth:this.config.barWidth,barRadius:this.config.barRadius,responsive:this.config.responsive,interact:this.config.interact,dragToSeek:this.config.dragToSeek,hideScrollbar:this.config.hideScrollbar,normalize:this.config.normalize,backend:this.config.backend,mediaControls:this.config.mediaControls,plugins:i};this.wavesurfer=t.create(s)}async _loadRequiredPlugins(){const t=new Set;this.config.regions.enabled&&t.add("regions"),this.config.timeline.enabled&&t.add("timeline"),this.config.minimap.enabled&&t.add("minimap"),this.config.zoom.enabled&&t.add("zoom"),this.config.hover.enabled&&t.add("hover"),this.config.spectrogram.enabled&&t.add("spectrogram"),this.config.record.enabled&&t.add("record"),this.config.envelope.enabled&&t.add("envelope"),this.config.enabledPlugins.forEach((e=>t.add(e)));for(const e of t)try{const t=await import(`../../js/wavesurfer-v7/plugins/${e}.esm.js`);this.plugins.set(e,t.default)}catch(t){}}async _addEnabledPlugins(t){if(this.config.regions.enabled&&this.plugins.has("regions")){const e=this.plugins.get("regions");e&&t.push(e.create({dragSelection:this.config.regions.dragSelection}))}if(this.config.timeline.enabled&&this.plugins.has("timeline")){const e=this.plugins.get("timeline");e&&t.push(e.create({height:this.config.timeline.height}))}if(this.config.minimap.enabled&&this.plugins.has("minimap")){const e=this.plugins.get("minimap");e&&t.push(e.create({height:this.config.minimap.height}))}if(this.config.zoom.enabled&&this.plugins.has("zoom")){const e=this.plugins.get("zoom");e&&t.push(e.create({scale:this.config.zoom.scale}))}if(this.config.hover.enabled&&this.plugins.has("hover")){const e=this.plugins.get("hover");e&&t.push(e.create({formatTimeCallback:this.config.hover.formatTimeCallback}))}if(this.config.spectrogram.enabled&&this.plugins.has("spectrogram")){const e=this.plugins.get("spectrogram");e&&t.push(e.create({height:this.config.spectrogram.height}))}if(this.config.record.enabled&&this.plugins.has("record")){const e=this.plugins.get("record");e&&t.push(e.create(this.config.record))}if(this.config.envelope.enabled&&this.plugins.has("envelope")){const e=this.plugins.get("envelope");e&&t.push(e.create(this.config.envelope))}}_createControls(){const t=this.config.controls;this.controlsContainer=document.createElement("div"),this.controlsContainer.className="wavesurfer-controls",this.controlsContainer.style.cssText="\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            height: 50px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border-top: 1px solid rgba(255,255,255,0.1);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 10px;\n            padding: 0 15px;\n            border-radius: 0 0 8px 8px;\n        ",(t.play||t.pause)&&(this.playPauseBtn=this._createButton("▶️","Play/Pause",(()=>{this.isPlaying?this.pause():this.play()})),this.controlsContainer.appendChild(this.playPauseBtn)),t.stop&&(this.stopBtn=this._createButton("⏹️","Stop",(()=>{this.stop()})),this.controlsContainer.appendChild(this.stopBtn)),this.timeDisplay=document.createElement("span"),this.timeDisplay.className="time-display",this.timeDisplay.style.cssText="\n            color: white;\n            font-family: 'Roboto Mono', monospace;\n            font-size: 12px;\n            margin: 0 10px;\n            min-width: 80px;\n            text-align: center;\n        ",this.timeDisplay.textContent="00:00 / 00:00",this.controlsContainer.appendChild(this.timeDisplay),t.volume&&(this.volumeContainer=document.createElement("div"),this.volumeContainer.style.cssText="\n                display: flex;\n                align-items: center;\n                gap: 5px;\n                margin-left: 15px;\n            ",t.mute&&(this.muteBtn=this._createButton("🔊","Mute",(()=>{this.toggleMute()})),this.volumeContainer.appendChild(this.muteBtn)),this.volumeSlider=document.createElement("input"),this.volumeSlider.type="range",this.volumeSlider.min="0",this.volumeSlider.max="100",this.volumeSlider.value="100",this.volumeSlider.style.cssText="\n                width: 80px;\n                height: 4px;\n                background: rgba(255,255,255,0.3);\n                outline: none;\n                border-radius: 2px;\n            ",this.volumeSlider.addEventListener("input",(t=>{this.setVolume(parseInt(t.target.value)/100)})),this.volumeContainer.appendChild(this.volumeSlider),this.controlsContainer.appendChild(this.volumeContainer)),t.download&&(this.downloadBtn=this._createButton("💾","Download",(()=>{this.downloadAudio()})),this.controlsContainer.appendChild(this.downloadBtn)),this.container.appendChild(this.controlsContainer)}_createButton(t,e,i){const s=document.createElement("button");return s.textContent=t,s.title=e,s.style.cssText="\n            background: rgba(255,255,255,0.2);\n            border: 1px solid rgba(255,255,255,0.3);\n            color: white;\n            padding: 8px 12px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            transition: all 0.2s ease;\n            backdrop-filter: blur(10px);\n        ",s.addEventListener("mouseenter",(()=>{s.style.background="rgba(255,255,255,0.3)",s.style.transform="scale(1.05)"})),s.addEventListener("mouseleave",(()=>{s.style.background="rgba(255,255,255,0.2)",s.style.transform="scale(1)"})),s.addEventListener("click",i),s}_setupEventHandlers(){this.wavesurfer&&(this.wavesurfer.on("ready",(()=>{this.isReady=!0,this._updateTimeDisplay(),this.config.callbacks.onReady(this)})),this.wavesurfer.on("play",(()=>{this.isPlaying=!0,this.playPauseBtn&&(this.playPauseBtn.textContent="⏸️"),this.config.callbacks.onPlay(this)})),this.wavesurfer.on("pause",(()=>{this.isPlaying=!1,this.playPauseBtn&&(this.playPauseBtn.textContent="▶️"),this.config.callbacks.onPause(this)})),this.wavesurfer.on("finish",(()=>{this.isPlaying=!1,this.playPauseBtn&&(this.playPauseBtn.textContent="▶️"),this.config.callbacks.onFinish(this)})),this.wavesurfer.on("seeking",(t=>{this.currentTime=t,this._updateTimeDisplay(),this.config.callbacks.onSeek(t,this)})),this.wavesurfer.on("timeupdate",(t=>{this.currentTime=t,this._updateTimeDisplay(),this.config.callbacks.onTimeUpdate(t,this)})),this.wavesurfer.on("error",(t=>{this.config.callbacks.onError(t)})),this.config.regions.enabled&&this._setupRegionEvents())}_setupRegionEvents(){this.wavesurfer.on("region-created",(t=>{this.regions.set(t.id,t),this.config.callbacks.onRegionCreate(t,this)})),this.wavesurfer.on("region-updated",(t=>{this.config.callbacks.onRegionUpdate(t,this)})),this.wavesurfer.on("region-removed",(t=>{this.regions.delete(t.id),this.config.callbacks.onRegionRemove(t,this)}))}_updateTimeDisplay(){if(!this.timeDisplay||!this.wavesurfer)return;const t=this._formatTime(this.currentTime),e=this._formatTime(this.wavesurfer.getDuration()||0);this.timeDisplay.textContent=`${t} / ${e}`}_formatTime(t){const e=Math.floor(t/60),i=Math.floor(t%60);return`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}async loadAudio(t,e=null){if(!this.wavesurfer)throw new Error("WaveSurfer not initialized");try{return e?await this.wavesurfer.load(t,e):await this.wavesurfer.load(t),this.config.url=t,this.config.peaks=e,this}catch(t){throw this.config.callbacks.onError(t),t}}play(){return this.wavesurfer&&this.isReady&&this.wavesurfer.play(),this}pause(){return this.wavesurfer&&this.isReady&&this.wavesurfer.pause(),this}stop(){return this.wavesurfer&&this.isReady&&this.wavesurfer.stop(),this}seekTo(t){return this.wavesurfer&&this.isReady&&this.wavesurfer.seekTo(t),this}setVolume(t){return this.wavesurfer&&this.isReady&&(this.wavesurfer.setVolume(t),this.volumeSlider&&(this.volumeSlider.value=100*t)),this}toggleMute(){if(this.wavesurfer&&this.isReady){const t=this.wavesurfer.getMuted();this.wavesurfer.setMuted(!t),this.muteBtn&&(this.muteBtn.textContent=t?"🔊":"🔇")}return this}getCurrentTime(){return this.wavesurfer?this.wavesurfer.getCurrentTime():0}getDuration(){return this.wavesurfer?this.wavesurfer.getDuration():0}getPlaybackRate(){return this.wavesurfer?this.wavesurfer.getPlaybackRate():1}setPlaybackRate(t){return this.wavesurfer&&this.isReady&&this.wavesurfer.setPlaybackRate(t),this}addRegion(t){if(!this.config.regions.enabled||!this.wavesurfer)return null;try{const e=(this.wavesurfer.getActivePlugins?this.wavesurfer.getActivePlugins():[]).find((t=>"RegionsPlugin"===t.constructor.name||"regions"===t.name||"function"==typeof t.addRegion));if(e&&"function"==typeof e.addRegion){return e.addRegion(t)}if(this.wavesurfer.addRegion&&"function"==typeof this.wavesurfer.addRegion){return this.wavesurfer.addRegion(t)}return null}catch(t){return null}}removeRegion(t){const e=this.regions.get(t);return e&&e.remove(),this}clearRegions(){return this.wavesurfer&&this.config.regions.enabled&&this.wavesurfer.clearRegions(),this}getRegions(){return Array.from(this.regions.values())}downloadAudio(){if(!this.config.url)return;const t=document.createElement("a");t.href=this.config.url,t.download=this.config.url.split("/").pop()||"audio.wav",document.body.appendChild(t),t.click(),document.body.removeChild(t)}exportImage(){return this.wavesurfer&&this.isReady?this.wavesurfer.exportImage():null}setPosition(t,e){return this.config.x=t,this.config.y=e,this.container&&(this.container.style.left=`${t}px`,this.container.style.top=`${e}px`),this}setSize(t,e){return this.config.width=t,this.config.height=e,this.container&&(this.container.style.width=`${t}px`,this.container.style.height=`${e}px`),this}setColors(t){return Object.assign(this.config,t),this.wavesurfer&&this.isReady&&(t.waveColor&&this.wavesurfer.setOptions({waveColor:t.waveColor}),t.progressColor&&this.wavesurfer.setOptions({progressColor:t.progressColor}),t.cursorColor&&this.wavesurfer.setOptions({cursorColor:t.cursorColor})),this}destroy(){this.wavesurfer&&(this.wavesurfer.stop(),this.wavesurfer.destroy()),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),i.instances.delete(this.id),this.wavesurfer=null,this.container=null,this.waveformContainer=null,this.controlsContainer=null,this.regions.clear()}static getInstance(t){return i.instances.get(t)}static getAllInstances(){return Array.from(i.instances.values())}static destroyAll(){i.instances.forEach((t=>t.destroy())),i.instances.clear()}}function s(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{l(s.next(t))}catch(t){o(t)}}function a(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((s=s.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;let n=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}};const o={decode:function(t,e){return s(this,void 0,void 0,(function*(){const i=new AudioContext({sampleRate:e});return i.decodeAudioData(t).finally((()=>i.close()))}))},createBuffer:function(t,e){return"number"==typeof t[0]&&(t=[t]),function(t){const e=t[0];if(e.some((t=>t>1||t<-1))){const i=e.length;let s=0;for(let t=0;t<i;t++){const i=Math.abs(e[t]);i>s&&(s=i)}for(const e of t)for(let t=0;t<i;t++)e[t]/=s}}(t),{duration:e,length:t[0].length,sampleRate:t[0].length/e,numberOfChannels:t.length,getChannelData:e=>null==t?void 0:t[e],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function r(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,s]of Object.entries(e))"string"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(r(t,s));else"style"===t?Object.assign(i.style,s):"textContent"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function a(t,e,i){const s=r(t,e||{});return null==i||i.appendChild(s),s}var l=Object.freeze({__proto__:null,createElement:a,default:a});const h={fetchBlob:function(t,e,i){return s(this,void 0,void 0,(function*(){const n=yield fetch(t,i);if(n.status>=400)throw new Error(`Failed to fetch ${t}: ${n.status} (${n.statusText})`);return function(t,e){s(this,void 0,void 0,(function*(){if(!t.body||!t.headers)return;const i=t.body.getReader(),n=Number(t.headers.get("Content-Length"))||0;let o=0;const r=t=>s(this,void 0,void 0,(function*(){o+=(null==t?void 0:t.length)||0;const i=Math.round(o/n*100);e(i)})),a=()=>s(this,void 0,void 0,(function*(){let t;try{t=yield i.read()}catch(t){return}t.done||(r(t.value),yield a())}));a()}))}(n.clone(),e),n.blob()}))}};let c=class extends n{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),null!=t.playbackRate&&this.onMediaEvent("canplay",(()=>{null!=t.playbackRate&&(this.media.playbackRate=t.playbackRate)}),{once:!0})}onMediaEvent(t,e,i){return this.media.addEventListener(t,e,i),()=>this.media.removeEventListener(t,e,i)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return""!==this.media.canPlayType(t)}setSrc(t,e){const i=this.getSrc();if(t&&i===t)return;this.revokeSrc();const s=e instanceof Blob&&(this.canPlayType(e.type)||!t)?URL.createObjectURL(e):t;i&&(this.media.src="");try{this.media.src=s}catch(e){this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(t){this.media=t}play(){return s(this,void 0,void 0,(function*(){return this.media.play()}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,e){null!=e&&(this.media.preservesPitch=e),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}},d=class t extends n{constructor(t,e){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=t;const i=this.parentFromOptionsContainer(t.container);this.parent=i;const[s,n]=this.initHtml();i.appendChild(s),this.container=s,this.scrollContainer=n.querySelector(".scroll"),this.wrapper=n.querySelector(".wrapper"),this.canvasWrapper=n.querySelector(".canvases"),this.progressWrapper=n.querySelector(".progress"),this.cursor=n.querySelector(".cursor"),e&&n.appendChild(e),this.initEvents()}parentFromOptionsContainer(t){let e;if("string"==typeof t?e=document.querySelector(t):t instanceof HTMLElement&&(e=t),!e)throw new Error("Container not found");return e}initEvents(){const t=t=>{const e=this.wrapper.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;return[i/e.width,s/e.height]};if(this.wrapper.addEventListener("click",(e=>{const[i,s]=t(e);this.emit("click",i,s)})),this.wrapper.addEventListener("dblclick",(e=>{const[i,s]=t(e);this.emit("dblclick",i,s)})),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:t,scrollWidth:e,clientWidth:i}=this.scrollContainer,s=t/e,n=(t+i)/e;this.emit("scroll",s,n,t,t+i)})),"function"==typeof ResizeObserver){const t=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{t().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const t=this.parent.clientWidth;t===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=t,this.reRender())}initDrag(){this.subscriptions.push(function(t,e,i,s,n=3,o=0,r=100){if(!t)return()=>{};const a=matchMedia("(pointer: coarse)").matches;let l=()=>{};const h=h=>{if(h.button!==o)return;h.preventDefault(),h.stopPropagation();let c=h.clientX,d=h.clientY,u=!1;const p=Date.now(),g=s=>{if(s.preventDefault(),s.stopPropagation(),a&&Date.now()-p<r)return;const o=s.clientX,l=s.clientY,h=o-c,g=l-d;if(u||Math.abs(h)>n||Math.abs(g)>n){const s=t.getBoundingClientRect(),{left:n,top:r}=s;u||(null==i||i(c-n,d-r),u=!0),e(h,g,o-n,l-r),c=o,d=l}},m=e=>{if(u){const i=e.clientX,n=e.clientY,o=t.getBoundingClientRect(),{left:r,top:a}=o;null==s||s(i-r,n-a)}l()},f=t=>{t.relatedTarget&&t.relatedTarget!==document.documentElement||m(t)},v=t=>{u&&(t.stopPropagation(),t.preventDefault())},b=t=>{u&&t.preventDefault()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",m),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",v,{capture:!0}),l=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",m),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",b),setTimeout((()=>{document.removeEventListener("click",v,{capture:!0})}),10)}};return t.addEventListener("pointerdown",h),()=>{l(),t.removeEventListener("pointerdown",h)}}(this.wrapper,((t,e,i)=>{this.emit("drag",Math.max(0,Math.min(1,i/this.wrapper.getBoundingClientRect().width)))}),(t=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))}),(t=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))})))}getHeight(t,e){var i;const s=(null===(i=this.audioData)||void 0===i?void 0:i.numberOfChannels)||1;if(null==t)return 128;if(!isNaN(Number(t)))return Number(t);if("auto"===t){const t=this.parent.clientHeight||128;return(null==e?void 0:e.every((t=>!t.overlay)))?t/s:t}return 128}initHtml(){const t=document.createElement("div"),e=t.attachShadow({mode:"open"}),i=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return e.innerHTML=`\n      <style${i?` nonce="${i}"`:""}>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    `,[t,e]}setOptions(t){if(this.options.container!==t.container){const e=this.parentFromOptionsContainer(t.container);e.appendChild(this.container),this.parent=e}!0!==t.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){const{scrollWidth:e}=this.scrollContainer,i=e*t;this.setScroll(i)}destroy(){var t,e;this.subscriptions.forEach((t=>t())),this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(e=this.unsubscribeOnScroll)||void 0===e||e.forEach((t=>t())),this.unsubscribeOnScroll=[]}createDelay(t=10){let e,i;const s=()=>{e&&clearTimeout(e),i&&i()};return this.timeouts.push(s),()=>new Promise(((n,o)=>{s(),i=o,e=setTimeout((()=>{e=void 0,i=void 0,n()}),t)}))}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";const e=document.createElement("canvas"),i=e.getContext("2d"),s=e.height*(window.devicePixelRatio||1),n=i.createLinearGradient(0,0,0,s),o=1/(t.length-1);return t.forEach(((t,e)=>{const i=e*o;n.addColorStop(i,t)})),n}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(t,e,i,s){const n=t[0],o=t[1]||t[0],r=n.length,{width:a,height:l}=i.canvas,h=l/2,c=this.getPixelRatio(),d=e.barWidth?e.barWidth*c:1,u=e.barGap?e.barGap*c:e.barWidth?d/2:0,p=e.barRadius||0,g=a/(d+u)/r,m=p&&"roundRect"in i?"roundRect":"rect";i.beginPath();let f=0,v=0,b=0;for(let t=0;t<=r;t++){const r=Math.round(t*g);if(r>f){const t=Math.round(v*h*s),n=t+Math.round(b*h*s)||1;let o=h-t;"top"===e.barAlign?o=0:"bottom"===e.barAlign&&(o=l-n),i[m](f*(d+u),o,d,n,p),f=r,v=0,b=0}const a=Math.abs(n[t]||0),c=Math.abs(o[t]||0);a>v&&(v=a),c>b&&(b=c)}i.fill(),i.closePath()}renderLineWaveform(t,e,i,s){const n=e=>{const n=t[e]||t[0],o=n.length,{height:r}=i.canvas,a=r/2,l=i.canvas.width/o;i.moveTo(0,a);let h=0,c=0;for(let t=0;t<=o;t++){const o=Math.round(t*l);if(o>h){const t=a+(Math.round(c*a*s)||1)*(0===e?-1:1);i.lineTo(h,t),h=o,c=0}const r=Math.abs(n[t]||0);r>c&&(c=r)}i.lineTo(h,a)};i.beginPath(),n(0),n(1),i.fill(),i.closePath()}renderWaveform(t,e,i){if(i.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction)return void e.renderFunction(t,i);let s=e.barHeight||1;if(e.normalize){const e=Array.from(t[0]).reduce(((t,e)=>Math.max(t,Math.abs(e))),0);s=e?1/e:1}e.barWidth||e.barGap||e.barAlign?this.renderBarWaveform(t,e,i,s):this.renderLineWaveform(t,e,i,s)}renderSingleCanvas(t,e,i,s,n,o,r){const a=this.getPixelRatio(),l=document.createElement("canvas");l.width=Math.round(i*a),l.height=Math.round(s*a),l.style.width=`${i}px`,l.style.height=`${s}px`,l.style.left=`${Math.round(n)}px`,o.appendChild(l);const h=l.getContext("2d");if(this.renderWaveform(t,e,h),l.width>0&&l.height>0){const t=l.cloneNode(),i=t.getContext("2d");i.drawImage(l,0,0),i.globalCompositeOperation="source-in",i.fillStyle=this.convertColorValues(e.progressColor),i.fillRect(0,0,l.width,l.height),r.appendChild(t)}}renderMultiCanvas(e,i,s,n,o,r){const a=this.getPixelRatio(),{clientWidth:l}=this.scrollContainer,h=s/a;let c=Math.min(t.MAX_CANVAS_WIDTH,l,h),d={};if(0===c)return;if(i.barWidth||i.barGap){const t=i.barWidth||.5,e=t+(i.barGap||t/2);c%e!=0&&(c=Math.floor(c/e)*e)}const u=t=>{if(t<0||t>=p)return;if(d[t])return;d[t]=!0;const s=t*c,a=Math.min(h-s,c);if(a<=0)return;const l=e.map((t=>{const e=Math.floor(s/h*t.length),i=Math.floor((s+a)/h*t.length);return t.slice(e,i)}));this.renderSingleCanvas(l,i,a,n,s,o,r)},p=Math.ceil(h/c);if(!this.isScrollable){for(let t=0;t<p;t++)u(t);return}const g=this.scrollContainer.scrollLeft/h,m=Math.floor(g*p);if(u(m-1),u(m),u(m+1),p>1){const e=this.on("scroll",(()=>{const{scrollLeft:e}=this.scrollContainer,i=Math.floor(e/h*p);Object.keys(d).length>t.MAX_NODES&&(o.innerHTML="",r.innerHTML="",d={}),u(i-1),u(i),u(i+1)}));this.unsubscribeOnScroll.push(e)}}renderChannel(t,e,i,s){var{overlay:n}=e,o=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(i[s[n]]=t[s[n]])}return i}(e,["overlay"]);const r=document.createElement("div"),a=this.getHeight(o.height,o.splitChannels);r.style.height=`${a}px`,n&&s>0&&(r.style.marginTop=`-${a}px`),this.canvasWrapper.style.minHeight=`${a}px`,this.canvasWrapper.appendChild(r);const l=r.cloneNode();this.progressWrapper.appendChild(l),this.renderMultiCanvas(t,o,i,a,r,l)}render(t){return s(this,void 0,void 0,(function*(){var e;this.timeouts.forEach((t=>t())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);const i=this.getPixelRatio(),s=this.scrollContainer.clientWidth,n=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrollable=n>s;const o=this.options.fillParent&&!this.isScrollable,r=(o?s:n)*i;if(this.wrapper.style.width=o?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let i=0;i<t.numberOfChannels;i++){const s=Object.assign(Object.assign({},this.options),null===(e=this.options.splitChannels)||void 0===e?void 0:e[i]);this.renderChannel([t.getChannelData(i)],s,r,i)}else{const e=[t.getChannelData(0)];t.numberOfChannels>1&&e.push(t.getChannelData(1)),this.renderChannel(e,this.options,r,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){if(this.unsubscribeOnScroll.forEach((t=>t())),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:t}=this.scrollContainer,{right:e}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){const{right:t}=this.progressWrapper.getBoundingClientRect();let i=t-e;i*=2,i=i<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,e=!1){const{scrollLeft:i,scrollWidth:s,clientWidth:n}=this.scrollContainer,o=t*s,r=i,a=i+n,l=n/2;if(this.isDragging){const t=30;o+t>a?this.scrollContainer.scrollLeft+=t:o-t<r&&(this.scrollContainer.scrollLeft-=t)}else{(o<r||o>a)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?l:0));const t=o-i-l;e&&this.options.autoCenter&&t>0&&(this.scrollContainer.scrollLeft+=Math.min(t,10))}{const t=this.scrollContainer.scrollLeft,e=t/s,i=(t+n)/s;this.emit("scroll",e,i,t,t+n)}}renderProgress(t,e){if(isNaN(t))return;const i=100*t;this.canvasWrapper.style.clipPath=`polygon(${i}% 0, 100% 0, 100% 100%, ${i}% 100%)`,this.progressWrapper.style.width=`${i}%`,this.cursor.style.left=`${i}%`,this.cursor.style.transform=`translateX(-${100===Math.round(i)?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,e)}exportImage(t,e,i){return s(this,void 0,void 0,(function*(){const s=this.canvasWrapper.querySelectorAll("canvas");if(!s.length)throw new Error("No waveform data");if("dataURL"===i){const i=Array.from(s).map((i=>i.toDataURL(t,e)));return Promise.resolve(i)}return Promise.all(Array.from(s).map((i=>new Promise(((s,n)=>{i.toBlob((t=>{t?s(t):n(new Error("Could not export image"))}),t,e)})))))}))}};d.MAX_CANVAS_WIDTH=8e3,d.MAX_NODES=10;let u=class extends n{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",(()=>{requestAnimationFrame((()=>{this.emit("tick")}))})),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}},p=class extends n{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return s(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((e=>{if(e.status>=400)throw new Error(`Failed to fetch ${t}: ${e.status} (${e.statusText})`);return e.arrayBuffer()})).then((e=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(e))).then((e=>{this.currentSrc===t&&(this.buffer=e,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}))}_play(){var t;if(!this.paused)return;this.paused=!1,null===(t=this.bufferNode)||void 0===t||t.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let e=this.playedDuration*this._playbackRate;(e>=this.duration||e<0)&&(e=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,e),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,null===(t=this.bufferNode)||void 0===t||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return s(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){const e=t-this.currentTime,i=this.bufferNode;null==i||i.stop(this.audioContext.currentTime+e),null==i||i.addEventListener("ended",(()=>{i===this.bufferNode&&(this.bufferNode=null,this.pause())}),{once:!0})}setSinkId(t){return s(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){const e=!this.paused;e&&this._pause(),this.playedDuration=t/this._playbackRate,e&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,e;return null!==(t=this._duration)&&void 0!==t?t:(null===(e=this.buffer)||void 0===e?void 0:e.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){const t=[];if(!this.buffer)return t;const e=this.buffer.numberOfChannels;for(let i=0;i<e;i++)t.push(this.buffer.getChannelData(i));return t}};const g={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};let m=class t extends c{static create(e){return new t(e)}constructor(t){const e=t.media||("WebAudio"===t.backend?new p:void 0);super({media:e,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},g,t),this.timer=new u;const i=e?void 0:this.getMediaElement();this.renderer=new d(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const s=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:t,duration:e}=this.options;(s||t&&e)&&this.load(s,t,e).catch((()=>null))}))}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),null!=this.stopAtPosition&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const t=this.updateProgress();this.emit("timeupdate",t)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("emptied",(()=>{this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("ended",(()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(()=>{var t;this.emit("error",null!==(t=this.getMediaElement().error)&&void 0!==t?t:new Error("Media error")),this.stopAtPosition=null})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((t,e)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,e))})),this.renderer.on("dblclick",((t,e)=>{this.emit("dblclick",t,e)})),this.renderer.on("scroll",((t,e,i,s)=>{const n=this.getDuration();this.emit("scroll",t*n,e*n,i,s)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(t=>{this.emit("dragstart",t)})),this.renderer.on("dragend",(t=>{this.emit("dragend",t)})));{let t;this.subscriptions.push(this.renderer.on("drag",(e=>{if(!this.options.interact)return;let i;this.renderer.renderProgress(e),clearTimeout(t),this.isPlaying()?i=0:!0===this.options.dragToSeek?i=200:"object"==typeof this.options.dragToSeek&&void 0!==this.options.dragToSeek&&(i=this.options.dragToSeek.debounceTime),t=setTimeout((()=>{this.seekTo(e)}),i),this.emit("interaction",e*this.getDuration()),this.emit("drag",e)})))}}initPlugins(){var t;(null===(t=this.options.plugins)||void 0===t?void 0:t.length)&&this.options.plugins.forEach((t=>{this.registerPlugin(t)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t=>t())),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=o.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=o.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),null!=t.mediaControls&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t._init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",(()=>{this.plugins=this.plugins.filter((e=>e!==t))}))),t}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){const e=t/this.getDuration();this.renderer.setScrollPercentage(e)}getActivePlugins(){return this.plugins}loadAudio(t,e,i,n){return s(this,void 0,void 0,(function*(){var s;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,!e&&!i){const i=this.options.fetchParams||{};window.AbortController&&!i.signal&&(this.abortController=new AbortController,i.signal=null===(s=this.abortController)||void 0===s?void 0:s.signal);const n=t=>this.emit("loading",t);e=yield h.fetchBlob(t,n,i);const o=this.options.blobMimeType;o&&(e=new Blob([e],{type:o}))}this.setSrc(t,e);const r=yield new Promise((t=>{const e=n||this.getDuration();e?t(e):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>t(this.getDuration())),{once:!0}))}));if(!t&&!e){const t=this.getMediaElement();t instanceof p&&(t.duration=r)}if(i)this.decodedData=o.createBuffer(i,r||0);else if(e){const t=yield e.arrayBuffer();this.decodedData=yield o.decode(t,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(t,e,i){return s(this,void 0,void 0,(function*(){try{return yield this.loadAudio(t,void 0,e,i)}catch(t){throw this.emit("error",t),t}}))}loadBlob(t,e,i){return s(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",t,e,i)}catch(t){throw this.emit("error",t),t}}))}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:e=8e3,precision:i=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const s=Math.min(t,this.decodedData.numberOfChannels),n=[];for(let t=0;t<s;t++){const s=this.decodedData.getChannelData(t),o=[],r=s.length/e;for(let t=0;t<e;t++){const e=s.slice(Math.floor(t*r),Math.ceil((t+1)*r));let n=0;for(let t=0;t<e.length;t++){const i=e[t];Math.abs(i)>Math.abs(n)&&(n=i)}o.push(Math.round(n*i)/i)}n.push(o)}return n}getDuration(){let t=super.getDuration()||0;return 0!==t&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){const e=this.getDuration()*t;this.setTime(e)}play(t,e){const i=Object.create(null,{play:{get:()=>super.play}});return s(this,void 0,void 0,(function*(){null!=t&&this.setTime(t);const s=yield i.play.call(this);return null!=e&&(this.media instanceof p?this.media.stopAt(e):this.stopAtPosition=e),s}))}playPause(){return s(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return s(this,arguments,void 0,(function*(t="image/png",e=1,i="dataURL"){return this.renderer.exportImage(t,e,i)}))}destroy(){var t;this.emit("destroy"),null===(t=this.abortController)||void 0===t||t.abort(),this.plugins.forEach((t=>t.destroy())),this.subscriptions.forEach((t=>t())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}};m.BasePlugin=class extends n{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}},m.dom=l;var f=Object.freeze({__proto__:null,default:m});let v=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}},b=class extends v{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}};function y(t,e,i,s,n=3,o=0,r=100){if(!t)return()=>{};const a=matchMedia("(pointer: coarse)").matches;let l=()=>{};const h=h=>{if(h.button!==o)return;h.preventDefault(),h.stopPropagation();let c=h.clientX,d=h.clientY,u=!1;const p=Date.now(),g=s=>{if(s.preventDefault(),s.stopPropagation(),a&&Date.now()-p<r)return;const o=s.clientX,l=s.clientY,h=o-c,g=l-d;if(u||Math.abs(h)>n||Math.abs(g)>n){const s=t.getBoundingClientRect(),{left:n,top:r}=s;u||(null==i||i(c-n,d-r),u=!0),e(h,g,o-n,l-r),c=o,d=l}},m=e=>{if(u){const i=e.clientX,n=e.clientY,o=t.getBoundingClientRect(),{left:r,top:a}=o;null==s||s(i-r,n-a)}l()},f=t=>{t.relatedTarget&&t.relatedTarget!==document.documentElement||m(t)},v=t=>{u&&(t.stopPropagation(),t.preventDefault())},b=t=>{u&&t.preventDefault()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",m),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",v,{capture:!0}),l=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",m),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",b),setTimeout((()=>{document.removeEventListener("click",v,{capture:!0})}),10)}};return t.addEventListener("pointerdown",h),()=>{l(),t.removeEventListener("pointerdown",h)}}function w(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,s]of Object.entries(e))"string"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(w(t,s));else"style"===t?Object.assign(i.style,s):"textContent"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function C(t,e,i){const s=w(t,e||{});return null==i||i.appendChild(s),s}let x=class extends v{constructor(t,e,i=0){var s,n,o,r,a,l,h,c,d,u;super(),this.totalDuration=e,this.numberOfChannels=i,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.subscriptions=[],this.id=t.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(t.start),this.end=this.clampPosition(null!==(s=t.end)&&void 0!==s?s:t.start),this.drag=null===(n=t.drag)||void 0===n||n,this.resize=null===(o=t.resize)||void 0===o||o,this.resizeStart=null===(r=t.resizeStart)||void 0===r||r,this.resizeEnd=null===(a=t.resizeEnd)||void 0===a||a,this.color=null!==(l=t.color)&&void 0!==l?l:"rgba(0, 0, 0, 0.1)",this.minLength=null!==(h=t.minLength)&&void 0!==h?h:this.minLength,this.maxLength=null!==(c=t.maxLength)&&void 0!==c?c:this.maxLength,this.channelIdx=null!==(d=t.channelIdx)&&void 0!==d?d:-1,this.contentEditable=null!==(u=t.contentEditable)&&void 0!==u?u:this.contentEditable,this.element=this.initElement(),this.setContent(t.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(t){return Math.max(0,Math.min(this.totalDuration,t))}setPart(){const t=this.start===this.end;this.element.setAttribute("part",`${t?"marker":"region"} ${this.id}`)}addResizeHandles(t){const e={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},i=C("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},e),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},t),s=C("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},e),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},t);this.subscriptions.push(y(i,(t=>this.onResize(t,"start")),(()=>null),(()=>this.onEndResizing()),1),y(s,(t=>this.onResize(t,"end")),(()=>null),(()=>this.onEndResizing()),1))}removeResizeHandles(t){const e=t.querySelector('[part*="region-handle-left"]'),i=t.querySelector('[part*="region-handle-right"]');e&&t.removeChild(e),i&&t.removeChild(i)}initElement(){const t=this.start===this.end;let e=0,i=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(i=100/this.numberOfChannels,e=i*this.channelIdx);const s=C("div",{style:{position:"absolute",top:`${e}%`,height:`${i}%`,backgroundColor:t?"none":this.color,borderLeft:t?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!t&&this.resize&&this.addResizeHandles(s),s}renderPosition(){const t=this.start/this.totalDuration,e=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*t+"%",this.element.style.right=100*e+"%"}toggleCursor(t){var e;this.drag&&(null===(e=this.element)||void 0===e?void 0:e.style)&&(this.element.style.cursor=t?"grabbing":"grab")}initMouseEvents(){const{element:t}=this;t&&(t.addEventListener("click",(t=>this.emit("click",t))),t.addEventListener("mouseenter",(t=>this.emit("over",t))),t.addEventListener("mouseleave",(t=>this.emit("leave",t))),t.addEventListener("dblclick",(t=>this.emit("dblclick",t))),t.addEventListener("pointerdown",(()=>this.toggleCursor(!0))),t.addEventListener("pointerup",(()=>this.toggleCursor(!1))),this.subscriptions.push(y(t,(t=>this.onMove(t)),(()=>this.toggleCursor(!0)),(()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")}))),this.contentEditable&&this.content&&(this.content.addEventListener("click",(t=>this.onContentClick(t))),this.content.addEventListener("blur",(()=>this.onContentBlur()))))}_onUpdate(t,e){if(!this.element.parentElement)return;const{width:i}=this.element.parentElement.getBoundingClientRect(),s=t/i*this.totalDuration,n=e&&"start"!==e?this.start:this.start+s,o=e&&"end"!==e?this.end:this.end+s,r=o-n;n>=0&&o<=this.totalDuration&&n<=o&&r>=this.minLength&&r<=this.maxLength&&(this.start=n,this.end=o,this.renderPosition(),this.emit("update",e))}onMove(t){this.drag&&this._onUpdate(t)}onResize(t,e){this.resize&&(this.resizeStart||"start"!==e)&&(this.resizeEnd||"end"!==e)&&this._onUpdate(t,e)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(t){t.stopPropagation(),t.target.focus(),this.emit("click",t)}onContentBlur(){this.emit("update-end")}_setTotalDuration(t){this.totalDuration=t,this.renderPosition()}play(t){this.emit("play",t&&this.end!==this.start?this.end:void 0)}getContent(t=!1){var e;return t?this.content||void 0:this.element instanceof HTMLElement?(null===(e=this.content)||void 0===e?void 0:e.innerHTML)||void 0:""}setContent(t){var e;if(null===(e=this.content)||void 0===e||e.remove(),t){if("string"==typeof t){const e=this.start===this.end;this.content=C("div",{style:{padding:`0.2em ${e?.2:.4}em`,display:"inline-block"},textContent:t})}else this.content=t;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(t){var e,i;if(t.color&&(this.color=t.color,this.element.style.backgroundColor=this.color),void 0!==t.drag&&(this.drag=t.drag,this.element.style.cursor=this.drag?"grab":"default"),void 0!==t.start||void 0!==t.end){const s=this.start===this.end;this.start=this.clampPosition(null!==(e=t.start)&&void 0!==e?e:this.start),this.end=this.clampPosition(null!==(i=t.end)&&void 0!==i?i:s?this.start:this.end),this.renderPosition(),this.setPart()}if(t.content&&this.setContent(t.content),t.id&&(this.id=t.id,this.setPart()),void 0!==t.resize&&t.resize!==this.resize){const e=this.start===this.end;this.resize=t.resize,this.resize&&!e?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}void 0!==t.resizeStart&&(this.resizeStart=t.resizeStart),void 0!==t.resizeEnd&&(this.resizeEnd=t.resizeEnd)}remove(){this.emit("remove"),this.subscriptions.forEach((t=>t())),this.element.remove(),this.element=null}},S=class t extends b{constructor(t){super(t),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new t(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let t=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",(e=>{const i=this.regions.filter((t=>t.start<=e&&(t.end===t.start?t.start+.05:t.end)>=e));i.forEach((e=>{t.includes(e)||this.emit("region-in",e)})),t.forEach((t=>{i.includes(t)||this.emit("region-out",t)})),t=i})))}initRegionsContainer(){return C("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(t){t.content&&setTimeout((()=>{const e=t.content,i=e.getBoundingClientRect(),s=this.regions.map((e=>{if(e===t||!e.content)return 0;const s=e.content.getBoundingClientRect();return i.left<s.left+s.width&&s.left<i.left+i.width?s.height:0})).reduce(((t,e)=>t+e),0);e.style.marginTop=`${s}px`}),10)}adjustScroll(t){var e,i;const s=null===(i=null===(e=this.wavesurfer)||void 0===e?void 0:e.getWrapper())||void 0===i?void 0:i.parentElement;if(!s)return;const{clientWidth:n,scrollWidth:o}=s;if(o<=n)return;const r=s.getBoundingClientRect(),a=t.element.getBoundingClientRect(),l=a.left-r.left,h=a.right-r.left;l<0?s.scrollLeft+=l:h>n&&(s.scrollLeft+=h-n)}virtualAppend(t,e,i){const s=()=>{if(!this.wavesurfer)return;const s=this.wavesurfer.getWidth(),n=this.wavesurfer.getScroll(),o=e.clientWidth,r=this.wavesurfer.getDuration(),a=Math.round(t.start/r*o),l=a+(Math.round((t.end-t.start)/r*o)||1)>n&&a<n+s;l&&!i.parentElement?e.appendChild(i):!l&&i.parentElement&&i.remove()};setTimeout((()=>{if(!this.wavesurfer)return;s();const e=this.wavesurfer.on("scroll",s);this.subscriptions.push(t.once("remove",e),e)}),0)}saveRegion(t){this.virtualAppend(t,this.regionsContainer,t.element),this.avoidOverlapping(t),this.regions.push(t);const e=[t.on("update",(e=>{e||this.adjustScroll(t),this.emit("region-update",t,e)})),t.on("update-end",(()=>{this.avoidOverlapping(t),this.emit("region-updated",t)})),t.on("play",(e=>{var i;null===(i=this.wavesurfer)||void 0===i||i.play(t.start,e)})),t.on("click",(e=>{this.emit("region-clicked",t,e)})),t.on("dblclick",(e=>{this.emit("region-double-clicked",t,e)})),t.on("content-changed",(()=>{this.emit("region-content-changed",t)})),t.once("remove",(()=>{e.forEach((t=>t())),this.regions=this.regions.filter((e=>e!==t)),this.emit("region-removed",t)}))];this.subscriptions.push(...e),this.emit("region-created",t)}addRegion(t){var e,i;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const s=this.wavesurfer.getDuration(),n=null===(i=null===(e=this.wavesurfer)||void 0===e?void 0:e.getDecodedData())||void 0===i?void 0:i.numberOfChannels,o=new x(t,s,n);return this.emit("region-initialized",o),s?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once("ready",(t=>{o._setTotalDuration(t),this.saveRegion(o)}))),o}enableDragSelection(t,e=3){var i;const s=null===(i=this.wavesurfer)||void 0===i?void 0:i.getWrapper();if(!(s&&s instanceof HTMLElement))return()=>{};let n=null,o=0;return y(s,((t,e,i)=>{n&&n._onUpdate(t,i>o?"end":"start")}),(e=>{var i,s;if(o=e,!this.wavesurfer)return;const r=this.wavesurfer.getDuration(),a=null===(s=null===(i=this.wavesurfer)||void 0===i?void 0:i.getDecodedData())||void 0===s?void 0:s.numberOfChannels,{width:l}=this.wavesurfer.getWrapper().getBoundingClientRect(),h=e/l*r,c=(e+5)/l*r;n=new x(Object.assign(Object.assign({},t),{start:h,end:c}),r,a),this.emit("region-initialized",n),this.regionsContainer.appendChild(n.element)}),(()=>{n&&(this.saveRegion(n),n=null)}),e)}clearRegions(){this.regions.slice().forEach((t=>t.remove())),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}},k=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}},M=class extends k{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}};function E(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,s]of Object.entries(e))"string"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(E(t,s));else"style"===t?Object.assign(i.style,s):"textContent"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function _(t,e,i){return E(t,e||{})}const P={height:20,timeOffset:0,formatTimeCallback:t=>t/60>1?`${Math.floor(t/60)}:${(t=Math.round(t%60))<10?"0":""}${t}`:""+Math.round(1e3*t)/1e3};let T=class t extends M{constructor(t){super(t||{}),this.options=Object.assign({},P,t),this.timelineWrapper=this.initTimelineWrapper()}static create(e){return new t(e)}onInit(){var t;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let e=this.wavesurfer.getWrapper();if(this.options.container instanceof HTMLElement)e=this.options.container;else if("string"==typeof this.options.container){const t=document.querySelector(this.options.container);if(!t)throw Error(`No Timeline container found matching ${this.options.container}`);e=t}this.options.insertPosition?(e.firstElementChild||e).insertAdjacentElement(this.options.insertPosition,this.timelineWrapper):e.appendChild(this.timelineWrapper),this.subscriptions.push(this.wavesurfer.on("redraw",(()=>this.initTimeline()))),((null===(t=this.wavesurfer)||void 0===t?void 0:t.getDuration())||this.options.duration)&&this.initTimeline()}destroy(){this.timelineWrapper.remove(),super.destroy()}initTimelineWrapper(){return _("div",{part:"timeline-wrapper",style:{pointerEvents:"none"}})}defaultTimeInterval(t){return t>=25?1:5*t>=25?5:15*t>=25?15:60*Math.ceil(.5/t)}defaultPrimaryLabelInterval(t){return t>=25?10:5*t>=25?6:4}defaultSecondaryLabelInterval(t){return t>=25?5:2}virtualAppend(t,e,i){let s=!1;const n=(n,o)=>{if(!this.wavesurfer)return;const r=i.clientWidth,a=t>n&&t+r<o;a!==s&&(s=a,a?e.appendChild(i):i.remove())};if(!this.wavesurfer)return;const o=this.wavesurfer.getScroll(),r=o+this.wavesurfer.getWidth();n(o,r),this.subscriptions.push(this.wavesurfer.on("scroll",((t,e,i,s)=>{n(i,s)})))}initTimeline(){var t,e,i,s,n,o,r,a;const l=null!==(i=null!==(e=null===(t=this.wavesurfer)||void 0===t?void 0:t.getDuration())&&void 0!==e?e:this.options.duration)&&void 0!==i?i:0,h=((null===(s=this.wavesurfer)||void 0===s?void 0:s.getWrapper().scrollWidth)||this.timelineWrapper.scrollWidth)/l,c=null!==(n=this.options.timeInterval)&&void 0!==n?n:this.defaultTimeInterval(h),d=null!==(o=this.options.primaryLabelInterval)&&void 0!==o?o:this.defaultPrimaryLabelInterval(h),u=this.options.primaryLabelSpacing,p=null!==(r=this.options.secondaryLabelInterval)&&void 0!==r?r:this.defaultSecondaryLabelInterval(h),g=this.options.secondaryLabelSpacing,m="beforebegin"===this.options.insertPosition,f=_("div",{style:Object.assign({height:`${this.options.height}px`,overflow:"hidden",fontSize:this.options.height/2+"px",whiteSpace:"nowrap"},m?{position:"absolute",top:"0",left:"0",right:"0",zIndex:"2"}:{position:"relative"})});f.setAttribute("part","timeline"),"string"==typeof this.options.style?f.setAttribute("style",f.getAttribute("style")+this.options.style):"object"==typeof this.options.style&&Object.assign(f.style,this.options.style);const v=_("div",{style:{width:"0",height:"50%",display:"flex",flexDirection:"column",justifyContent:m?"flex-start":"flex-end",top:m?"0":"auto",bottom:m?"auto":"0",overflow:"visible",borderLeft:"1px solid currentColor",opacity:`${null!==(a=this.options.secondaryLabelOpacity)&&void 0!==a?a:.25}`,position:"absolute",zIndex:"1"}});for(let t=0,e=0;t<l;t+=c,e++){const i=v.cloneNode(),s=Math.round(100*t)%Math.round(100*d)==0||u&&e%u==0,n=Math.round(100*t)%Math.round(100*p)==0||g&&e%g==0;(s||n)&&(i.style.height="100%",i.style.textIndent="3px",i.textContent=this.options.formatTimeCallback(t),s&&(i.style.opacity="1"));const o=s?"primary":n?"secondary":"tick";i.setAttribute("part",`timeline-notch timeline-notch-${o}`);const r=Math.round(100*(t+this.options.timeOffset))/100*h;i.style.left=`${r}px`,this.virtualAppend(r,f,i)}this.timelineWrapper.innerHTML="",this.timelineWrapper.appendChild(f),this.emit("ready")}},R=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}},D=class extends R{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}};function z(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{l(s.next(t))}catch(t){o(t)}}function a(t){try{l(s.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((s=s.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const L={decode:function(t,e){return z(this,void 0,void 0,(function*(){const i=new AudioContext({sampleRate:e});return i.decodeAudioData(t).finally((()=>i.close()))}))},createBuffer:function(t,e){return"number"==typeof t[0]&&(t=[t]),function(t){const e=t[0];if(e.some((t=>t>1||t<-1))){const i=e.length;let s=0;for(let t=0;t<i;t++){const i=Math.abs(e[t]);i>s&&(s=i)}for(const e of t)for(let t=0;t<i;t++)e[t]/=s}}(t),{duration:e,length:t[0].length,sampleRate:t[0].length/e,numberOfChannels:t.length,getChannelData:e=>null==t?void 0:t[e],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function W(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,s]of Object.entries(e))"string"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(W(t,s));else"style"===t?Object.assign(i.style,s):"textContent"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function $(t,e,i){const s=W(t,e||{});return null==i||i.appendChild(s),s}var O=Object.freeze({__proto__:null,createElement:$,default:$});const j={fetchBlob:function(t,e,i){return z(this,void 0,void 0,(function*(){const s=yield fetch(t,i);if(s.status>=400)throw new Error(`Failed to fetch ${t}: ${s.status} (${s.statusText})`);return function(t,e){z(this,void 0,void 0,(function*(){if(!t.body||!t.headers)return;const i=t.body.getReader(),s=Number(t.headers.get("Content-Length"))||0;let n=0;const o=t=>z(this,void 0,void 0,(function*(){n+=(null==t?void 0:t.length)||0;const i=Math.round(n/s*100);e(i)})),r=()=>z(this,void 0,void 0,(function*(){let t;try{t=yield i.read()}catch(t){return}t.done||(o(t.value),yield r())}));r()}))}(s.clone(),e),s.blob()}))}};let I=class extends R{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),null!=t.playbackRate&&this.onMediaEvent("canplay",(()=>{null!=t.playbackRate&&(this.media.playbackRate=t.playbackRate)}),{once:!0})}onMediaEvent(t,e,i){return this.media.addEventListener(t,e,i),()=>this.media.removeEventListener(t,e,i)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return""!==this.media.canPlayType(t)}setSrc(t,e){const i=this.getSrc();if(t&&i===t)return;this.revokeSrc();const s=e instanceof Blob&&(this.canPlayType(e.type)||!t)?URL.createObjectURL(e):t;i&&(this.media.src="");try{this.media.src=s}catch(e){this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(t){this.media=t}play(){return z(this,void 0,void 0,(function*(){return this.media.play()}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,e){null!=e&&(this.media.preservesPitch=e),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}},B=class t extends R{constructor(t,e){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=t;const i=this.parentFromOptionsContainer(t.container);this.parent=i;const[s,n]=this.initHtml();i.appendChild(s),this.container=s,this.scrollContainer=n.querySelector(".scroll"),this.wrapper=n.querySelector(".wrapper"),this.canvasWrapper=n.querySelector(".canvases"),this.progressWrapper=n.querySelector(".progress"),this.cursor=n.querySelector(".cursor"),e&&n.appendChild(e),this.initEvents()}parentFromOptionsContainer(t){let e;if("string"==typeof t?e=document.querySelector(t):t instanceof HTMLElement&&(e=t),!e)throw new Error("Container not found");return e}initEvents(){const t=t=>{const e=this.wrapper.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;return[i/e.width,s/e.height]};if(this.wrapper.addEventListener("click",(e=>{const[i,s]=t(e);this.emit("click",i,s)})),this.wrapper.addEventListener("dblclick",(e=>{const[i,s]=t(e);this.emit("dblclick",i,s)})),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:t,scrollWidth:e,clientWidth:i}=this.scrollContainer,s=t/e,n=(t+i)/e;this.emit("scroll",s,n,t,t+i)})),"function"==typeof ResizeObserver){const t=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{t().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const t=this.parent.clientWidth;t===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=t,this.reRender())}initDrag(){this.subscriptions.push(function(t,e,i,s,n=3,o=0,r=100){if(!t)return()=>{};const a=matchMedia("(pointer: coarse)").matches;let l=()=>{};const h=h=>{if(h.button!==o)return;h.preventDefault(),h.stopPropagation();let c=h.clientX,d=h.clientY,u=!1;const p=Date.now(),g=s=>{if(s.preventDefault(),s.stopPropagation(),a&&Date.now()-p<r)return;const o=s.clientX,l=s.clientY,h=o-c,g=l-d;if(u||Math.abs(h)>n||Math.abs(g)>n){const s=t.getBoundingClientRect(),{left:n,top:r}=s;u||(null==i||i(c-n,d-r),u=!0),e(h,g,o-n,l-r),c=o,d=l}},m=e=>{if(u){const i=e.clientX,n=e.clientY,o=t.getBoundingClientRect(),{left:r,top:a}=o;null==s||s(i-r,n-a)}l()},f=t=>{t.relatedTarget&&t.relatedTarget!==document.documentElement||m(t)},v=t=>{u&&(t.stopPropagation(),t.preventDefault())},b=t=>{u&&t.preventDefault()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",m),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",v,{capture:!0}),l=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",m),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",b),setTimeout((()=>{document.removeEventListener("click",v,{capture:!0})}),10)}};return t.addEventListener("pointerdown",h),()=>{l(),t.removeEventListener("pointerdown",h)}}(this.wrapper,((t,e,i)=>{this.emit("drag",Math.max(0,Math.min(1,i/this.wrapper.getBoundingClientRect().width)))}),(t=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))}),(t=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))})))}getHeight(t,e){var i;const s=(null===(i=this.audioData)||void 0===i?void 0:i.numberOfChannels)||1;if(null==t)return 128;if(!isNaN(Number(t)))return Number(t);if("auto"===t){const t=this.parent.clientHeight||128;return(null==e?void 0:e.every((t=>!t.overlay)))?t/s:t}return 128}initHtml(){const t=document.createElement("div"),e=t.attachShadow({mode:"open"}),i=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return e.innerHTML=`\n      <style${i?` nonce="${i}"`:""}>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    `,[t,e]}setOptions(t){if(this.options.container!==t.container){const e=this.parentFromOptionsContainer(t.container);e.appendChild(this.container),this.parent=e}!0!==t.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){const{scrollWidth:e}=this.scrollContainer,i=e*t;this.setScroll(i)}destroy(){var t,e;this.subscriptions.forEach((t=>t())),this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(e=this.unsubscribeOnScroll)||void 0===e||e.forEach((t=>t())),this.unsubscribeOnScroll=[]}createDelay(t=10){let e,i;const s=()=>{e&&clearTimeout(e),i&&i()};return this.timeouts.push(s),()=>new Promise(((n,o)=>{s(),i=o,e=setTimeout((()=>{e=void 0,i=void 0,n()}),t)}))}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";const e=document.createElement("canvas"),i=e.getContext("2d"),s=e.height*(window.devicePixelRatio||1),n=i.createLinearGradient(0,0,0,s),o=1/(t.length-1);return t.forEach(((t,e)=>{const i=e*o;n.addColorStop(i,t)})),n}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(t,e,i,s){const n=t[0],o=t[1]||t[0],r=n.length,{width:a,height:l}=i.canvas,h=l/2,c=this.getPixelRatio(),d=e.barWidth?e.barWidth*c:1,u=e.barGap?e.barGap*c:e.barWidth?d/2:0,p=e.barRadius||0,g=a/(d+u)/r,m=p&&"roundRect"in i?"roundRect":"rect";i.beginPath();let f=0,v=0,b=0;for(let t=0;t<=r;t++){const r=Math.round(t*g);if(r>f){const t=Math.round(v*h*s),n=t+Math.round(b*h*s)||1;let o=h-t;"top"===e.barAlign?o=0:"bottom"===e.barAlign&&(o=l-n),i[m](f*(d+u),o,d,n,p),f=r,v=0,b=0}const a=Math.abs(n[t]||0),c=Math.abs(o[t]||0);a>v&&(v=a),c>b&&(b=c)}i.fill(),i.closePath()}renderLineWaveform(t,e,i,s){const n=e=>{const n=t[e]||t[0],o=n.length,{height:r}=i.canvas,a=r/2,l=i.canvas.width/o;i.moveTo(0,a);let h=0,c=0;for(let t=0;t<=o;t++){const o=Math.round(t*l);if(o>h){const t=a+(Math.round(c*a*s)||1)*(0===e?-1:1);i.lineTo(h,t),h=o,c=0}const r=Math.abs(n[t]||0);r>c&&(c=r)}i.lineTo(h,a)};i.beginPath(),n(0),n(1),i.fill(),i.closePath()}renderWaveform(t,e,i){if(i.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction)return void e.renderFunction(t,i);let s=e.barHeight||1;if(e.normalize){const e=Array.from(t[0]).reduce(((t,e)=>Math.max(t,Math.abs(e))),0);s=e?1/e:1}e.barWidth||e.barGap||e.barAlign?this.renderBarWaveform(t,e,i,s):this.renderLineWaveform(t,e,i,s)}renderSingleCanvas(t,e,i,s,n,o,r){const a=this.getPixelRatio(),l=document.createElement("canvas");l.width=Math.round(i*a),l.height=Math.round(s*a),l.style.width=`${i}px`,l.style.height=`${s}px`,l.style.left=`${Math.round(n)}px`,o.appendChild(l);const h=l.getContext("2d");if(this.renderWaveform(t,e,h),l.width>0&&l.height>0){const t=l.cloneNode(),i=t.getContext("2d");i.drawImage(l,0,0),i.globalCompositeOperation="source-in",i.fillStyle=this.convertColorValues(e.progressColor),i.fillRect(0,0,l.width,l.height),r.appendChild(t)}}renderMultiCanvas(e,i,s,n,o,r){const a=this.getPixelRatio(),{clientWidth:l}=this.scrollContainer,h=s/a;let c=Math.min(t.MAX_CANVAS_WIDTH,l,h),d={};if(0===c)return;if(i.barWidth||i.barGap){const t=i.barWidth||.5,e=t+(i.barGap||t/2);c%e!=0&&(c=Math.floor(c/e)*e)}const u=t=>{if(t<0||t>=p)return;if(d[t])return;d[t]=!0;const s=t*c,a=Math.min(h-s,c);if(a<=0)return;const l=e.map((t=>{const e=Math.floor(s/h*t.length),i=Math.floor((s+a)/h*t.length);return t.slice(e,i)}));this.renderSingleCanvas(l,i,a,n,s,o,r)},p=Math.ceil(h/c);if(!this.isScrollable){for(let t=0;t<p;t++)u(t);return}const g=this.scrollContainer.scrollLeft/h,m=Math.floor(g*p);if(u(m-1),u(m),u(m+1),p>1){const e=this.on("scroll",(()=>{const{scrollLeft:e}=this.scrollContainer,i=Math.floor(e/h*p);Object.keys(d).length>t.MAX_NODES&&(o.innerHTML="",r.innerHTML="",d={}),u(i-1),u(i),u(i+1)}));this.unsubscribeOnScroll.push(e)}}renderChannel(t,e,i,s){var{overlay:n}=e,o=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(i[s[n]]=t[s[n]])}return i}(e,["overlay"]);const r=document.createElement("div"),a=this.getHeight(o.height,o.splitChannels);r.style.height=`${a}px`,n&&s>0&&(r.style.marginTop=`-${a}px`),this.canvasWrapper.style.minHeight=`${a}px`,this.canvasWrapper.appendChild(r);const l=r.cloneNode();this.progressWrapper.appendChild(l),this.renderMultiCanvas(t,o,i,a,r,l)}render(t){return z(this,void 0,void 0,(function*(){var e;this.timeouts.forEach((t=>t())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);const i=this.getPixelRatio(),s=this.scrollContainer.clientWidth,n=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrollable=n>s;const o=this.options.fillParent&&!this.isScrollable,r=(o?s:n)*i;if(this.wrapper.style.width=o?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let i=0;i<t.numberOfChannels;i++){const s=Object.assign(Object.assign({},this.options),null===(e=this.options.splitChannels)||void 0===e?void 0:e[i]);this.renderChannel([t.getChannelData(i)],s,r,i)}else{const e=[t.getChannelData(0)];t.numberOfChannels>1&&e.push(t.getChannelData(1)),this.renderChannel(e,this.options,r,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){if(this.unsubscribeOnScroll.forEach((t=>t())),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:t}=this.scrollContainer,{right:e}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){const{right:t}=this.progressWrapper.getBoundingClientRect();let i=t-e;i*=2,i=i<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,e=!1){const{scrollLeft:i,scrollWidth:s,clientWidth:n}=this.scrollContainer,o=t*s,r=i,a=i+n,l=n/2;if(this.isDragging){const t=30;o+t>a?this.scrollContainer.scrollLeft+=t:o-t<r&&(this.scrollContainer.scrollLeft-=t)}else{(o<r||o>a)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?l:0));const t=o-i-l;e&&this.options.autoCenter&&t>0&&(this.scrollContainer.scrollLeft+=Math.min(t,10))}{const t=this.scrollContainer.scrollLeft,e=t/s,i=(t+n)/s;this.emit("scroll",e,i,t,t+n)}}renderProgress(t,e){if(isNaN(t))return;const i=100*t;this.canvasWrapper.style.clipPath=`polygon(${i}% 0, 100% 0, 100% 100%, ${i}% 100%)`,this.progressWrapper.style.width=`${i}%`,this.cursor.style.left=`${i}%`,this.cursor.style.transform=`translateX(-${100===Math.round(i)?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,e)}exportImage(t,e,i){return z(this,void 0,void 0,(function*(){const s=this.canvasWrapper.querySelectorAll("canvas");if(!s.length)throw new Error("No waveform data");if("dataURL"===i){const i=Array.from(s).map((i=>i.toDataURL(t,e)));return Promise.resolve(i)}return Promise.all(Array.from(s).map((i=>new Promise(((s,n)=>{i.toBlob((t=>{t?s(t):n(new Error("Could not export image"))}),t,e)})))))}))}};B.MAX_CANVAS_WIDTH=8e3,B.MAX_NODES=10;class N extends R{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",(()=>{requestAnimationFrame((()=>{this.emit("tick")}))})),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class H extends R{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return z(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((e=>{if(e.status>=400)throw new Error(`Failed to fetch ${t}: ${e.status} (${e.statusText})`);return e.arrayBuffer()})).then((e=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(e))).then((e=>{this.currentSrc===t&&(this.buffer=e,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}))}_play(){var t;if(!this.paused)return;this.paused=!1,null===(t=this.bufferNode)||void 0===t||t.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let e=this.playedDuration*this._playbackRate;(e>=this.duration||e<0)&&(e=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,e),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,null===(t=this.bufferNode)||void 0===t||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return z(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){const e=t-this.currentTime,i=this.bufferNode;null==i||i.stop(this.audioContext.currentTime+e),null==i||i.addEventListener("ended",(()=>{i===this.bufferNode&&(this.bufferNode=null,this.pause())}),{once:!0})}setSinkId(t){return z(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){const e=!this.paused;e&&this._pause(),this.playedDuration=t/this._playbackRate,e&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,e;return null!==(t=this._duration)&&void 0!==t?t:(null===(e=this.buffer)||void 0===e?void 0:e.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){const t=[];if(!this.buffer)return t;const e=this.buffer.numberOfChannels;for(let i=0;i<e;i++)t.push(this.buffer.getChannelData(i));return t}}const F={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class V extends I{static create(t){return new V(t)}constructor(t){const e=t.media||("WebAudio"===t.backend?new H:void 0);super({media:e,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},F,t),this.timer=new N;const i=e?void 0:this.getMediaElement();this.renderer=new B(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const s=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:t,duration:e}=this.options;(s||t&&e)&&this.load(s,t,e).catch((()=>null))}))}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),null!=this.stopAtPosition&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const t=this.updateProgress();this.emit("timeupdate",t)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("emptied",(()=>{this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("ended",(()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(()=>{var t;this.emit("error",null!==(t=this.getMediaElement().error)&&void 0!==t?t:new Error("Media error")),this.stopAtPosition=null})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((t,e)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,e))})),this.renderer.on("dblclick",((t,e)=>{this.emit("dblclick",t,e)})),this.renderer.on("scroll",((t,e,i,s)=>{const n=this.getDuration();this.emit("scroll",t*n,e*n,i,s)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(t=>{this.emit("dragstart",t)})),this.renderer.on("dragend",(t=>{this.emit("dragend",t)})));{let t;this.subscriptions.push(this.renderer.on("drag",(e=>{if(!this.options.interact)return;let i;this.renderer.renderProgress(e),clearTimeout(t),this.isPlaying()?i=0:!0===this.options.dragToSeek?i=200:"object"==typeof this.options.dragToSeek&&void 0!==this.options.dragToSeek&&(i=this.options.dragToSeek.debounceTime),t=setTimeout((()=>{this.seekTo(e)}),i),this.emit("interaction",e*this.getDuration()),this.emit("drag",e)})))}}initPlugins(){var t;(null===(t=this.options.plugins)||void 0===t?void 0:t.length)&&this.options.plugins.forEach((t=>{this.registerPlugin(t)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t=>t())),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=L.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=L.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),null!=t.mediaControls&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t._init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",(()=>{this.plugins=this.plugins.filter((e=>e!==t))}))),t}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){const e=t/this.getDuration();this.renderer.setScrollPercentage(e)}getActivePlugins(){return this.plugins}loadAudio(t,e,i,s){return z(this,void 0,void 0,(function*(){var n;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,!e&&!i){const i=this.options.fetchParams||{};window.AbortController&&!i.signal&&(this.abortController=new AbortController,i.signal=null===(n=this.abortController)||void 0===n?void 0:n.signal);const s=t=>this.emit("loading",t);e=yield j.fetchBlob(t,s,i);const o=this.options.blobMimeType;o&&(e=new Blob([e],{type:o}))}this.setSrc(t,e);const o=yield new Promise((t=>{const e=s||this.getDuration();e?t(e):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>t(this.getDuration())),{once:!0}))}));if(!t&&!e){const t=this.getMediaElement();t instanceof H&&(t.duration=o)}if(i)this.decodedData=L.createBuffer(i,o||0);else if(e){const t=yield e.arrayBuffer();this.decodedData=yield L.decode(t,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(t,e,i){return z(this,void 0,void 0,(function*(){try{return yield this.loadAudio(t,void 0,e,i)}catch(t){throw this.emit("error",t),t}}))}loadBlob(t,e,i){return z(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",t,e,i)}catch(t){throw this.emit("error",t),t}}))}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:e=8e3,precision:i=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const s=Math.min(t,this.decodedData.numberOfChannels),n=[];for(let t=0;t<s;t++){const s=this.decodedData.getChannelData(t),o=[],r=s.length/e;for(let t=0;t<e;t++){const e=s.slice(Math.floor(t*r),Math.ceil((t+1)*r));let n=0;for(let t=0;t<e.length;t++){const i=e[t];Math.abs(i)>Math.abs(n)&&(n=i)}o.push(Math.round(n*i)/i)}n.push(o)}return n}getDuration(){let t=super.getDuration()||0;return 0!==t&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){const e=this.getDuration()*t;this.setTime(e)}play(t,e){const i=Object.create(null,{play:{get:()=>super.play}});return z(this,void 0,void 0,(function*(){null!=t&&this.setTime(t);const s=yield i.play.call(this);return null!=e&&(this.media instanceof H?this.media.stopAt(e):this.stopAtPosition=e),s}))}playPause(){return z(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return z(this,arguments,void 0,(function*(t="image/png",e=1,i="dataURL"){return this.renderer.exportImage(t,e,i)}))}destroy(){var t;this.emit("destroy"),null===(t=this.abortController)||void 0===t||t.abort(),this.plugins.forEach((t=>t.destroy())),this.subscriptions.forEach((t=>t())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}V.BasePlugin=D,V.dom=O;const q={height:50,overlayColor:"rgba(100, 100, 100, 0.1)",insertPosition:"afterend"};class U extends D{constructor(t){super(t),this.miniWavesurfer=null,this.container=null,this.options=Object.assign({},q,t),this.minimapWrapper=this.initMinimapWrapper(),this.overlay=this.initOverlay()}static create(t){return new U(t)}onInit(){var t,e;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.options.container?("string"==typeof this.options.container?this.container=document.querySelector(this.options.container):this.options.container instanceof HTMLElement&&(this.container=this.options.container),null===(t=this.container)||void 0===t||t.appendChild(this.minimapWrapper)):(this.container=this.wavesurfer.getWrapper().parentElement,null===(e=this.container)||void 0===e||e.insertAdjacentElement(this.options.insertPosition,this.minimapWrapper)),this.initWaveSurferEvents(),Promise.resolve().then((()=>{this.initMinimap()}))}initMinimapWrapper(){return $("div",{part:"minimap",style:{position:"relative"}})}initOverlay(){return $("div",{part:"minimap-overlay",style:{position:"absolute",zIndex:"2",left:"0",top:"0",bottom:"0",transition:"left 100ms ease-out",pointerEvents:"none",backgroundColor:this.options.overlayColor}},this.minimapWrapper)}initMinimap(){if(this.miniWavesurfer&&(this.miniWavesurfer.destroy(),this.miniWavesurfer=null),!this.wavesurfer)return;const t=this.wavesurfer.getDecodedData(),e=this.wavesurfer.getMediaElement();if(!t||!e)return;const i=[];for(let e=0;e<t.numberOfChannels;e++)i.push(t.getChannelData(e));this.miniWavesurfer=V.create(Object.assign(Object.assign({},this.options),{container:this.minimapWrapper,minPxPerSec:0,fillParent:!0,media:e,peaks:i,duration:t.duration})),this.subscriptions.push(this.miniWavesurfer.on("audioprocess",(t=>{this.emit("audioprocess",t)})),this.miniWavesurfer.on("click",((t,e)=>{this.emit("click",t,e)})),this.miniWavesurfer.on("dblclick",((t,e)=>{this.emit("dblclick",t,e)})),this.miniWavesurfer.on("decode",(t=>{this.emit("decode",t)})),this.miniWavesurfer.on("destroy",(()=>{this.emit("destroy")})),this.miniWavesurfer.on("drag",(t=>{this.emit("drag",t)})),this.miniWavesurfer.on("dragend",(t=>{this.emit("dragend",t)})),this.miniWavesurfer.on("dragstart",(t=>{this.emit("dragstart",t)})),this.miniWavesurfer.on("interaction",(()=>{this.emit("interaction")})),this.miniWavesurfer.on("init",(()=>{this.emit("init")})),this.miniWavesurfer.on("ready",(()=>{this.emit("ready")})),this.miniWavesurfer.on("redraw",(()=>{this.emit("redraw")})),this.miniWavesurfer.on("redrawcomplete",(()=>{this.emit("redrawcomplete")})),this.miniWavesurfer.on("seeking",(t=>{this.emit("seeking",t)})),this.miniWavesurfer.on("timeupdate",(t=>{this.emit("timeupdate",t)})))}getOverlayWidth(){var t;const e=(null===(t=this.wavesurfer)||void 0===t?void 0:t.getWrapper().clientWidth)||1;return Math.round(this.minimapWrapper.clientWidth/e*100)}onRedraw(){const t=this.getOverlayWidth();this.overlay.style.width=`${t}%`}onScroll(t){if(!this.wavesurfer)return;const e=this.wavesurfer.getDuration();this.overlay.style.left=t/e*100+"%"}initWaveSurferEvents(){this.wavesurfer&&this.subscriptions.push(this.wavesurfer.on("decode",(()=>{this.initMinimap()})),this.wavesurfer.on("scroll",(t=>{this.onScroll(t)})),this.wavesurfer.on("redraw",(()=>{this.onRedraw()})))}destroy(){var t;null===(t=this.miniWavesurfer)||void 0===t||t.destroy(),this.minimapWrapper.remove(),super.destroy()}}let X=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}},G=class extends X{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}};const Y={scale:.5,deltaThreshold:5,exponentialZooming:!1,iterations:20};let Z=class t extends G{constructor(t){super(t||{}),this.wrapper=void 0,this.container=null,this.accumulatedDelta=0,this.pointerTime=0,this.oldX=0,this.endZoom=0,this.startZoom=0,this.onWheel=t=>{if(this.wavesurfer&&this.container&&!(Math.abs(t.deltaX)>=Math.abs(t.deltaY))&&(t.preventDefault(),this.accumulatedDelta+=-t.deltaY,0===this.startZoom&&this.options.exponentialZooming&&(this.startZoom=this.wavesurfer.getWrapper().clientWidth/this.wavesurfer.getDuration()),0===this.options.deltaThreshold||Math.abs(this.accumulatedDelta)>=this.options.deltaThreshold)){const e=this.wavesurfer.getDuration(),i=0===this.wavesurfer.options.minPxPerSec?this.wavesurfer.getWrapper().scrollWidth/e:this.wavesurfer.options.minPxPerSec,s=t.clientX-this.container.getBoundingClientRect().left,n=this.container.clientWidth,o=this.wavesurfer.getScroll();s===this.oldX&&0!==this.oldX||(this.pointerTime=(o+s)/i),this.oldX=s;const r=this.calculateNewZoom(i,this.accumulatedDelta),a=n/r*(s/n);r*e<n?(this.wavesurfer.zoom(n/e),this.container.scrollLeft=0):(this.wavesurfer.zoom(r),this.container.scrollLeft=(this.pointerTime-a)*r),this.accumulatedDelta=0}},this.calculateNewZoom=(t,e)=>{let i;if(this.options.exponentialZooming){const s=e>0?Math.pow(this.endZoom/this.startZoom,1/(this.options.iterations-1)):Math.pow(this.startZoom/this.endZoom,1/(this.options.iterations-1));i=Math.max(0,t*s)}else i=Math.max(0,t+e*this.options.scale);return Math.min(i,this.options.maxZoom)},this.options=Object.assign({},Y,t)}static create(e){return new t(e)}onInit(){var t;this.wrapper=null===(t=this.wavesurfer)||void 0===t?void 0:t.getWrapper(),this.wrapper&&(this.container=this.wrapper.parentElement,this.container.addEventListener("wheel",this.onWheel),void 0===this.options.maxZoom&&(this.options.maxZoom=this.container.clientWidth),this.endZoom=this.options.maxZoom)}destroy(){this.wrapper&&this.wrapper.removeEventListener("wheel",this.onWheel),super.destroy()}},K=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}},J=class extends K{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}};function Q(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,s]of Object.entries(e))"string"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(Q(t,s));else"style"===t?Object.assign(i.style,s):"textContent"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function tt(t,e,i){const s=Q(t,e||{});return null==i||i.appendChild(s),s}const et={lineWidth:1,labelSize:11,formatTimeCallback:t=>`${Math.floor(t/60)}:${("0"+Math.floor(t)%60).slice(-2)}`};let it=class t extends J{constructor(t){super(t||{}),this.unsubscribe=()=>{},this.onPointerMove=t=>{if(!this.wavesurfer)return;const e=this.wavesurfer.getWrapper().getBoundingClientRect(),{width:i}=e,s=t.clientX-e.left,n=Math.min(1,Math.max(0,s/i)),o=Math.min(i-this.options.lineWidth-1,s);this.wrapper.style.transform=`translateX(${o}px)`,this.wrapper.style.opacity="1";const r=this.wavesurfer.getDuration()||0;this.label.textContent=this.options.formatTimeCallback(r*n);const a=this.label.offsetWidth;this.label.style.transform=o+a>i?`translateX(-${a+this.options.lineWidth}px)`:"",this.emit("hover",n)},this.onPointerLeave=()=>{this.wrapper.style.opacity="0"},this.options=Object.assign({},et,t),this.wrapper=tt("div",{part:"hover"}),this.label=tt("span",{part:"hover-label"},this.wrapper)}static create(e){return new t(e)}addUnits(t){return`${t}${"number"==typeof t?"px":""}`}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const t=this.wavesurfer.options,e=this.options.lineColor||t.cursorColor||t.progressColor;Object.assign(this.wrapper.style,{position:"absolute",zIndex:10,left:0,top:0,height:"100%",pointerEvents:"none",borderLeft:`${this.addUnits(this.options.lineWidth)} solid ${e}`,opacity:"0",transition:"opacity .1s ease-in"}),Object.assign(this.label.style,{display:"block",backgroundColor:this.options.labelBackground,color:this.options.labelColor,fontSize:`${this.addUnits(this.options.labelSize)}`,transition:"transform .1s ease-in",padding:"2px 3px"});const i=this.wavesurfer.getWrapper();i.appendChild(this.wrapper),i.addEventListener("pointermove",this.onPointerMove),i.addEventListener("pointerleave",this.onPointerLeave),i.addEventListener("wheel",this.onPointerMove),this.unsubscribe=()=>{i.removeEventListener("pointermove",this.onPointerMove),i.removeEventListener("pointerleave",this.onPointerLeave),i.removeEventListener("wheel",this.onPointerLeave)}}destroy(){super.destroy(),this.unsubscribe(),this.wrapper.remove()}};"function"==typeof SuppressedError&&SuppressedError;let st=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}},nt=class extends st{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}};function ot(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,s]of Object.entries(e))"string"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(ot(t,s));else"style"===t?Object.assign(i.style,s):"textContent"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function rt(t,e,i){const s=ot(t,e||{});return null==i||i.appendChild(s),s}function at(t,e,i,s){switch(this.bufferSize=t,this.sampleRate=e,this.bandwidth=2/t*(e/2),this.sinTable=new Float32Array(t),this.cosTable=new Float32Array(t),this.windowValues=new Float32Array(t),this.reverseTable=new Uint32Array(t),this.peakBand=0,this.peak=0,i){case"bartlett":for(n=0;n<t;n++)this.windowValues[n]=2/(t-1)*((t-1)/2-Math.abs(n-(t-1)/2));break;case"bartlettHann":for(n=0;n<t;n++)this.windowValues[n]=.62-.48*Math.abs(n/(t-1)-.5)-.38*Math.cos(2*Math.PI*n/(t-1));break;case"blackman":for(s=s||.16,n=0;n<t;n++)this.windowValues[n]=(1-s)/2-.5*Math.cos(2*Math.PI*n/(t-1))+s/2*Math.cos(4*Math.PI*n/(t-1));break;case"cosine":for(n=0;n<t;n++)this.windowValues[n]=Math.cos(Math.PI*n/(t-1)-Math.PI/2);break;case"gauss":for(s=s||.25,n=0;n<t;n++)this.windowValues[n]=Math.pow(Math.E,-.5*Math.pow((n-(t-1)/2)/(s*(t-1)/2),2));break;case"hamming":for(n=0;n<t;n++)this.windowValues[n]=.54-.46*Math.cos(2*Math.PI*n/(t-1));break;case"hann":case void 0:for(n=0;n<t;n++)this.windowValues[n]=.5*(1-Math.cos(2*Math.PI*n/(t-1)));break;case"lanczoz":for(n=0;n<t;n++)this.windowValues[n]=Math.sin(Math.PI*(2*n/(t-1)-1))/(Math.PI*(2*n/(t-1)-1));break;case"rectangular":for(n=0;n<t;n++)this.windowValues[n]=1;break;case"triangular":for(n=0;n<t;n++)this.windowValues[n]=2/t*(t/2-Math.abs(n-(t-1)/2));break;default:throw Error("No such window function '"+i+"'")}for(var n,o=1,r=t>>1;o<t;){for(n=0;n<o;n++)this.reverseTable[n+o]=this.reverseTable[n]+r;o<<=1,r>>=1}for(n=0;n<t;n++)this.sinTable[n]=Math.sin(-Math.PI/n),this.cosTable[n]=Math.cos(-Math.PI/n);this.calculateSpectrum=function(t){var e,i,s,n=this.bufferSize,o=this.cosTable,r=this.sinTable,a=this.reverseTable,l=new Float32Array(n),h=new Float32Array(n),c=2/this.bufferSize,d=Math.sqrt,u=new Float32Array(n/2),p=Math.floor(Math.log(n)/Math.LN2);if(Math.pow(2,p)!==n)throw"Invalid buffer size, must be a power of 2.";if(n!==t.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+n+" Buffer Size: "+t.length;for(var g,m,f,v,b,y,w,C,x=1,S=0;S<n;S++)l[S]=t[a[S]]*this.windowValues[a[S]],h[S]=0;for(;x<n;){g=o[x],m=r[x],f=1,v=0;for(var k=0;k<x;k++){for(S=k;S<n;)y=f*l[b=S+x]-v*h[b],w=f*h[b]+v*l[b],l[b]=l[S]-y,h[b]=h[S]-w,l[S]+=y,h[S]+=w,S+=x<<1;f=(C=f)*g-v*m,v=C*m+v*g}x<<=1}S=0;for(var M=n/2;S<M;S++)(s=c*d((e=l[S])*e+(i=h[S])*i))>this.peak&&(this.peakBand=S,this.peak=s),u[S]=s;return u}}const lt=1e3*Math.log(10)/107.939;class ht extends nt{static create(t){return new ht(t||{})}constructor(t){var e,i;if(super(t),this.frequenciesDataUrl=t.frequenciesDataUrl,this.container="string"==typeof t.container?document.querySelector(t.container):t.container,t.colorMap&&"string"!=typeof t.colorMap){if(t.colorMap.length<256)throw new Error("Colormap must contain 256 elements");for(let e=0;e<t.colorMap.length;e++)if(4!==t.colorMap[e].length)throw new Error("ColorMap entries must contain 4 values");this.colorMap=t.colorMap}else switch(this.colorMap=t.colorMap||"roseus",this.colorMap){case"gray":this.colorMap=[];for(let t=0;t<256;t++){const e=(255-t)/256;this.colorMap.push([e,e,e,1])}break;case"igray":this.colorMap=[];for(let t=0;t<256;t++){const e=t/256;this.colorMap.push([e,e,e,1])}break;case"roseus":this.colorMap=[[.004528,.004341,.004307,1],[.005625,.006156,.00601,1],[.006628,.008293,.008161,1],[.007551,.010738,.01079,1],[.008382,.013482,.013941,1],[.009111,.01652,.017662,1],[.009727,.019846,.022009,1],[.010223,.023452,.027035,1],[.010593,.027331,.032799,1],[.010833,.031475,.039361,1],[.010941,.035875,.046415,1],[.010918,.04052,.053597,1],[.010768,.045158,.060914,1],[.010492,.049708,.068367,1],[.010098,.054171,.075954,1],[.009594,.058549,.083672,1],[.008989,.06284,.091521,1],[.008297,.067046,.099499,1],[.00753,.071165,.107603,1],[.006704,.075196,.11583,1],[.005838,.07914,.124178,1],[.004949,.082994,.132643,1],[.004062,.086758,.141223,1],[.003198,.09043,.149913,1],[.002382,.09401,.158711,1],[.001643,.097494,.167612,1],[.001009,.100883,.176612,1],[514e-6,.104174,.185704,1],[187e-6,.107366,.194886,1],[66e-6,.110457,.204151,1],[186e-6,.113445,.213496,1],[587e-6,.116329,.222914,1],[.001309,.119106,.232397,1],[.002394,.121776,.241942,1],[.003886,.124336,.251542,1],[.005831,.126784,.261189,1],[.008276,.12912,.270876,1],[.011268,.131342,.280598,1],[.014859,.133447,.290345,1],[.0191,.135435,.300111,1],[.024043,.137305,.309888,1],[.029742,.139054,.319669,1],[.036252,.140683,.329441,1],[.043507,.142189,.339203,1],[.050922,.143571,.348942,1],[.058432,.144831,.358649,1],[.066041,.145965,.368319,1],[.073744,.146974,.377938,1],[.081541,.147858,.387501,1],[.089431,.148616,.396998,1],[.097411,.149248,.406419,1],[.105479,.149754,.415755,1],[.113634,.150134,.424998,1],[.121873,.150389,.434139,1],[.130192,.150521,.443167,1],[.138591,.150528,.452075,1],[.147065,.150413,.460852,1],[.155614,.150175,.469493,1],[.164232,.149818,.477985,1],[.172917,.149343,.486322,1],[.181666,.148751,.494494,1],[.190476,.148046,.502493,1],[.199344,.147229,.510313,1],[.208267,.146302,.517944,1],[.217242,.145267,.52538,1],[.226264,.144131,.532613,1],[.235331,.142894,.539635,1],[.24444,.141559,.546442,1],[.253587,.140131,.553026,1],[.262769,.138615,.559381,1],[.271981,.137016,.5655,1],[.281222,.135335,.571381,1],[.290487,.133581,.577017,1],[.299774,.131757,.582404,1],[.30908,.129867,.587538,1],[.318399,.12792,.592415,1],[.32773,.125921,.597032,1],[.337069,.123877,.601385,1],[.346413,.121793,.605474,1],[.355758,.119678,.609295,1],[.365102,.11754,.612846,1],[.374443,.115386,.616127,1],[.383774,.113226,.619138,1],[.393096,.111066,.621876,1],[.402404,.108918,.624343,1],[.411694,.106794,.62654,1],[.420967,.104698,.628466,1],[.430217,.102645,.630123,1],[.439442,.100647,.631513,1],[.448637,.098717,.632638,1],[.457805,.096861,.633499,1],[.46694,.095095,.6341,1],[.47604,.093433,.634443,1],[.485102,.091885,.634532,1],[.494125,.090466,.63437,1],[.503104,.08919,.633962,1],[.512041,.088067,.633311,1],[.520931,.087108,.63242,1],[.529773,.086329,.631297,1],[.538564,.085738,.629944,1],[.547302,.085346,.628367,1],[.555986,.085162,.626572,1],[.564615,.08519,.624563,1],[.573187,.085439,.622345,1],[.581698,.085913,.619926,1],[.590149,.086615,.617311,1],[.598538,.087543,.614503,1],[.606862,.0887,.611511,1],[.61512,.090084,.608343,1],[.623312,.09169,.605001,1],[.631438,.093511,.601489,1],[.639492,.095546,.597821,1],[.647476,.097787,.593999,1],[.655389,.100226,.590028,1],[.66323,.102856,.585914,1],[.670995,.105669,.581667,1],[.678686,.108658,.577291,1],[.686302,.111813,.57279,1],[.69384,.115129,.568175,1],[.7013,.118597,.563449,1],[.708682,.122209,.558616,1],[.715984,.125959,.553687,1],[.723206,.12984,.548666,1],[.730346,.133846,.543558,1],[.737406,.13797,.538366,1],[.744382,.142209,.533101,1],[.751274,.146556,.527767,1],[.758082,.151008,.522369,1],[.764805,.155559,.516912,1],[.771443,.160206,.511402,1],[.777995,.164946,.505845,1],[.784459,.169774,.500246,1],[.790836,.174689,.494607,1],[.797125,.179688,.488935,1],[.803325,.184767,.483238,1],[.809435,.189925,.477518,1],[.815455,.19516,.471781,1],[.821384,.200471,.466028,1],[.827222,.205854,.460267,1],[.832968,.211308,.454505,1],[.838621,.216834,.448738,1],[.844181,.222428,.442979,1],[.849647,.22809,.43723,1],[.855019,.233819,.431491,1],[.860295,.239613,.425771,1],[.865475,.245471,.420074,1],[.870558,.251393,.414403,1],[.875545,.25738,.408759,1],[.880433,.263427,.403152,1],[.885223,.269535,.397585,1],[.889913,.275705,.392058,1],[.894503,.281934,.386578,1],[.898993,.288222,.381152,1],[.903381,.294569,.375781,1],[.907667,.300974,.370469,1],[.911849,.307435,.365223,1],[.915928,.313953,.360048,1],[.919902,.320527,.354948,1],[.923771,.327155,.349928,1],[.927533,.333838,.344994,1],[.931188,.340576,.340149,1],[.934736,.347366,.335403,1],[.938175,.354207,.330762,1],[.941504,.361101,.326229,1],[.944723,.368045,.321814,1],[.947831,.375039,.317523,1],[.950826,.382083,.313364,1],[.953709,.389175,.309345,1],[.956478,.396314,.305477,1],[.959133,.403499,.301766,1],[.961671,.410731,.298221,1],[.964093,.418008,.294853,1],[.966399,.425327,.291676,1],[.968586,.43269,.288696,1],[.970654,.440095,.285926,1],[.972603,.44754,.28338,1],[.974431,.455025,.281067,1],[.976139,.462547,.279003,1],[.977725,.470107,.277198,1],[.979188,.477703,.275666,1],[.980529,.485332,.274422,1],[.981747,.492995,.273476,1],[.98284,.50069,.272842,1],[.983808,.508415,.272532,1],[.984653,.516168,.27256,1],[.985373,.523948,.272937,1],[.985966,.531754,.273673,1],[.986436,.539582,.274779,1],[.98678,.547434,.276264,1],[.986998,.555305,.278135,1],[.987091,.563195,.280401,1],[.987061,.5711,.283066,1],[.986907,.579019,.286137,1],[.986629,.58695,.289615,1],[.986229,.594891,.293503,1],[.985709,.602839,.297802,1],[.985069,.610792,.302512,1],[.98431,.618748,.307632,1],[.983435,.626704,.313159,1],[.982445,.634657,.319089,1],[.981341,.642606,.32542,1],[.98013,.650546,.332144,1],[.978812,.658475,.339257,1],[.977392,.666391,.346753,1],[.97587,.67429,.354625,1],[.974252,.68217,.362865,1],[.972545,.690026,.371466,1],[.97075,.697856,.380419,1],[.968873,.705658,.389718,1],[.966921,.713426,.399353,1],[.964901,.721157,.409313,1],[.962815,.728851,.419594,1],[.960677,.7365,.430181,1],[.95849,.744103,.44107,1],[.956263,.751656,.452248,1],[.954009,.759153,.463702,1],[.951732,.766595,.475429,1],[.949445,.773974,.487414,1],[.947158,.781289,.499647,1],[.944885,.788535,.512116,1],[.942634,.795709,.524811,1],[.940423,.802807,.537717,1],[.938261,.809825,.550825,1],[.936163,.81676,.564121,1],[.934146,.823608,.577591,1],[.932224,.830366,.59122,1],[.930412,.837031,.604997,1],[.928727,.843599,.618904,1],[.927187,.850066,.632926,1],[.925809,.856432,.647047,1],[.92461,.862691,.661249,1],[.923607,.868843,.675517,1],[.92282,.874884,.689832,1],[.922265,.880812,.704174,1],[.921962,.886626,.718523,1],[.92193,.892323,.732859,1],[.922183,.897903,.747163,1],[.922741,.903364,.76141,1],[.92362,.908706,.77558,1],[.924837,.913928,.789648,1],[.926405,.919031,.80359,1],[.92834,.924015,.817381,1],[.930655,.928881,.830995,1],[.93336,.933631,.844405,1],[.936466,.938267,.857583,1],[.939982,.942791,.870499,1],[.943914,.947207,.883122,1],[.948267,.951519,.895421,1],[.953044,.955732,.907359,1],[.958246,.959852,.918901,1],[.963869,.963887,.930004,1],[.969909,.967845,.940623,1],[.976355,.971737,.950704,1],[.983195,.97558,.960181,1],[.990402,.979395,.968966,1],[.99793,.983217,.97692,1]];break;default:throw Error("No such colormap '"+this.colorMap+"'")}this.fftSamples=t.fftSamples||512,this.height=t.height||200,this.noverlap=t.noverlap||null,this.windowFunc=t.windowFunc||"hann",this.alpha=t.alpha,this.frequencyMin=t.frequencyMin||0,this.frequencyMax=t.frequencyMax||0,this.gainDB=null!==(e=t.gainDB)&&void 0!==e?e:20,this.rangeDB=null!==(i=t.rangeDB)&&void 0!==i?i:80,this.scale=t.scale||"mel",this.numMelFilters=this.fftSamples/2,this.numLogFilters=this.fftSamples/2,this.numBarkFilters=this.fftSamples/2,this.numErbFilters=this.fftSamples/2,this.createWrapper(),this.createCanvas()}onInit(){this.container=this.container||this.wavesurfer.getWrapper(),this.container.appendChild(this.wrapper),this.wavesurfer.options.fillParent&&Object.assign(this.wrapper.style,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.subscriptions.push(this.wavesurfer.on("redraw",(()=>this.render())))}destroy(){this.unAll(),this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("redraw",this._onRender),this.wavesurfer=null,this.util=null,this.options=null,this.wrapper&&(this.wrapper.remove(),this.wrapper=null),super.destroy()}loadFrequenciesData(t){return function(t,e,i,s){return new(i||(i=Promise))((function(e,n){function o(t){try{a(s.next(t))}catch(t){n(t)}}function r(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(t){t(s)}))).then(o,r)}a((s=s.apply(t,[])).next())}))}(this,0,void 0,(function*(){const e=yield fetch(t);if(!e.ok)throw new Error("Unable to fetch frequencies data");const i=yield e.json();this.drawSpectrogram(i)}))}createWrapper(){this.wrapper=rt("div",{style:{display:"block",position:"relative",userSelect:"none"}}),this.options.labels&&(this.labelsEl=rt("canvas",{part:"spec-labels",style:{position:"absolute",zIndex:9,width:"55px",height:"100%"}},this.wrapper)),this.wrapper.addEventListener("click",this._onWrapperClick)}createCanvas(){this.canvas=rt("canvas",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",zIndex:4}},this.wrapper),this.spectrCc=this.canvas.getContext("2d")}render(){var t;if(this.frequenciesDataUrl)this.loadFrequenciesData(this.frequenciesDataUrl);else{const e=null===(t=this.wavesurfer)||void 0===t?void 0:t.getDecodedData();e&&this.drawSpectrogram(this.getFrequencies(e))}}drawSpectrogram(t){isNaN(t[0][0])||(t=[t]),this.wrapper.style.height=this.height*t.length+"px",this.canvas.width=this.getWidth(),this.canvas.height=this.height*t.length;const e=this.spectrCc,i=this.height,s=this.getWidth(),n=this.buffer.sampleRate/2,o=this.frequencyMin,r=this.frequencyMax;if(e){if(r>n){const n=this.colorMap[this.colorMap.length-1];e.fillStyle=`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`,e.fillRect(0,0,s,i*t.length)}for(let a=0;a<t.length;a++){const l=this.resample(t[a]),h=l[0].length,c=new ImageData(s,h);for(let t=0;t<l.length;t++)for(let e=0;e<l[t].length;e++){const i=this.colorMap[l[t][e]],n=4*((h-e-1)*s+t);c.data[n]=255*i[0],c.data[n+1]=255*i[1],c.data[n+2]=255*i[2],c.data[n+3]=255*i[3]}const d=this.hzToScale(o)/this.hzToScale(n),u=this.hzToScale(r)/this.hzToScale(n),p=Math.min(1,u);createImageBitmap(c,0,Math.round(h*(1-p)),s,Math.round(h*(p-d))).then((t=>{e.drawImage(t,0,i*(a+1-p/u),s,i*p/u)}))}this.options.labels&&this.loadLabels(this.options.labelsBackground,"12px","12px","",this.options.labelsColor,this.options.labelsHzColor||this.options.labelsColor,"center","#specLabels",t.length),this.emit("ready")}}createFilterBank(t,e,i,s){const n=i(0),o=i(e/2),r=Array.from({length:t},(()=>Array(this.fftSamples/2+1).fill(0))),a=e/this.fftSamples;for(let e=0;e<t;e++){let i=s(n+e/t*(o-n)),l=Math.floor(i/a),h=l*a,c=(i-h)/((l+1)*a-h);r[e][l]=1-c,r[e][l+1]=c}return r}hzToMel(t){return 2595*Math.log10(1+t/700)}melToHz(t){return 700*(Math.pow(10,t/2595)-1)}createMelFilterBank(t,e){return this.createFilterBank(t,e,this.hzToMel,this.melToHz)}hzToLog(t){return Math.log10(Math.max(1,t))}logToHz(t){return Math.pow(10,t)}createLogFilterBank(t,e){return this.createFilterBank(t,e,this.hzToLog,this.logToHz)}hzToBark(t){let e=26.81*t/(1960+t)-.53;return e<2&&(e+=.15*(2-e)),e>20.1&&(e+=.22*(e-20.1)),e}barkToHz(t){return t<2&&(t=(t-.3)/.85),t>20.1&&(t=(t+4.422)/1.22),(t+.53)/(26.28-t)*1960}createBarkFilterBank(t,e){return this.createFilterBank(t,e,this.hzToBark,this.barkToHz)}hzToErb(t){return lt*Math.log10(1+.00437*t)}erbToHz(t){return(Math.pow(10,t/lt)-1)/.00437}createErbFilterBank(t,e){return this.createFilterBank(t,e,this.hzToErb,this.erbToHz)}hzToScale(t){switch(this.scale){case"mel":return this.hzToMel(t);case"logarithmic":return this.hzToLog(t);case"bark":return this.hzToBark(t);case"erb":return this.hzToErb(t)}return t}scaleToHz(t){switch(this.scale){case"mel":return this.melToHz(t);case"logarithmic":return this.logToHz(t);case"bark":return this.barkToHz(t);case"erb":return this.erbToHz(t)}return t}applyFilterBank(t,e){const i=e.length,s=Float32Array.from({length:i},(()=>0));for(let n=0;n<i;n++)for(let i=0;i<t.length;i++)s[n]+=t[i]*e[n][i];return s}getWidth(){return this.wavesurfer.getWrapper().offsetWidth}getFrequencies(t){var e,i;const s=this.fftSamples,n=(null!==(e=this.options.splitChannels)&&void 0!==e?e:null===(i=this.wavesurfer)||void 0===i?void 0:i.options.splitChannels)?t.numberOfChannels:1;if(this.frequencyMax=this.frequencyMax||t.sampleRate/2,!t)return;this.buffer=t;const o=t.sampleRate,r=[];let a=this.noverlap;if(!a){const e=t.length/this.canvas.width;a=Math.max(0,Math.round(s-e))}const l=new at(s,o,this.windowFunc,this.alpha);let h;switch(this.scale){case"mel":h=this.createFilterBank(this.numMelFilters,o,this.hzToMel,this.melToHz);break;case"logarithmic":h=this.createFilterBank(this.numLogFilters,o,this.hzToLog,this.logToHz);break;case"bark":h=this.createFilterBank(this.numBarkFilters,o,this.hzToBark,this.barkToHz);break;case"erb":h=this.createFilterBank(this.numErbFilters,o,this.hzToErb,this.erbToHz)}for(let e=0;e<n;e++){const i=t.getChannelData(e),n=[];let o=0;for(;o+s<i.length;){const t=i.slice(o,o+s),e=new Uint8Array(s/2);let r=l.calculateSpectrum(t);h&&(r=this.applyFilterBank(r,h));for(let t=0;t<s/2;t++){const i=r[t]>1e-12?r[t]:1e-12,s=20*Math.log10(i);s<-this.gainDB-this.rangeDB?e[t]=0:s>-this.gainDB?e[t]=255:e[t]=(s+this.gainDB)/this.rangeDB*255+256}n.push(e),o+=s-a}r.push(n)}return r}freqType(t){return t>=1e3?(t/1e3).toFixed(1):Math.round(t)}unitType(t){return t>=1e3?"kHz":"Hz"}getLabelFrequency(t,e){const i=this.hzToScale(this.frequencyMin),s=this.hzToScale(this.frequencyMax);return this.scaleToHz(i+t/e*(s-i))}loadLabels(t,e,i,s,n,o,r,a,l){t=t||"rgba(68,68,68,0)",e=e||"12px",i=i||"12px",s=s||"Helvetica",n=n||"#fff",o=o||"#fff",r=r||"center";const h=this.height||512,c=h/256*5;this.frequencyMin,this.frequencyMax;const d=this.labelsEl.getContext("2d"),u=window.devicePixelRatio;if(this.labelsEl.height=this.height*l*u,this.labelsEl.width=55*u,d.scale(u,u),d)for(let a=0;a<l;a++){let l;for(d.fillStyle=t,d.fillRect(0,a*h,55,(1+a)*h),d.fill(),l=0;l<=c;l++){d.textAlign=r,d.textBaseline="middle";const t=this.getLabelFrequency(l,c),u=this.freqType(t),p=this.unitType(t),g=16;let m=(1+a)*h-l/c*h;m=Math.min(Math.max(m,a*h+10),(1+a)*h-10),d.fillStyle=o,d.font=i+" "+s,d.fillText(p,g+24,m),d.fillStyle=n,d.font=e+" "+s,d.fillText(u,g,m)}}}resample(t){const e=this.getWidth(),i=[],s=1/t.length,n=1/e;let o;for(o=0;o<e;o++){const e=new Array(t[0].length);let r;for(r=0;r<t.length;r++){const i=r*s,a=i+s,l=o*n,h=l+n,c=Math.max(0,Math.min(a,h)-Math.max(i,l));let d;if(c>0)for(d=0;d<t[0].length;d++)null==e[d]&&(e[d]=0),e[d]+=c/n*t[r][d]}const a=new Uint8Array(t[0].length);let l;for(l=0;l<t[0].length;l++)a[l]=e[l];i.push(a)}return i}}function ct(t,e,i,s){return new(i||(i=Promise))((function(e,n){function o(t){try{a(s.next(t))}catch(t){n(t)}}function r(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(t){t(s)}))).then(o,r)}a((s=s.apply(t,[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;let dt=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}},ut=class extends dt{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}},pt=class extends dt{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",(()=>{requestAnimationFrame((()=>{this.emit("tick")}))})),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}};const gt=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];let mt=class t extends ut{constructor(t){var e,i,s,n,o,r;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:null!==(e=t.audioBitsPerSecond)&&void 0!==e?e:128e3,scrollingWaveform:null!==(i=t.scrollingWaveform)&&void 0!==i&&i,scrollingWaveformWindow:null!==(s=t.scrollingWaveformWindow)&&void 0!==s?s:5,continuousWaveform:null!==(n=t.continuousWaveform)&&void 0!==n&&n,renderRecordedAudio:null===(o=t.renderRecordedAudio)||void 0===o||o,mediaRecorderTimeslice:null!==(r=t.mediaRecorderTimeslice)&&void 0!==r?r:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.timer=new pt,this.subscriptions.push(this.timer.on("tick",(()=>{const t=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+t,this.emit("record-progress",this.duration)})))}static create(e){return new t(e||{})}renderMicStream(t){var e;const i=new AudioContext,s=i.createMediaStreamSource(t),n=i.createAnalyser();s.connect(n),this.options.continuousWaveform&&(n.fftSize=32);const o=n.frequencyBinCount,r=new Float32Array(o);let a=0;this.wavesurfer&&(null!==(e=this.originalOptions)&&void 0!==e||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));const l=setInterval((()=>{var t,e,s,l;if(!this.isWaveformPaused){if(n.getFloatTimeDomainData(r),this.options.scrollingWaveform){const t=Math.floor((this.options.scrollingWaveformWindow||0)*i.sampleRate),e=Math.min(t,this.dataWindow?this.dataWindow.length+o:o),s=new Float32Array(t);if(this.dataWindow){const i=Math.max(0,t-this.dataWindow.length);s.set(this.dataWindow.slice(-e+o),i)}s.set(r,t-o),this.dataWindow=s}else if(this.options.continuousWaveform){if(!this.dataWindow){const i=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):(null!==(e=null===(t=this.wavesurfer)||void 0===t?void 0:t.getWidth())&&void 0!==e?e:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(i)}let i=0;for(let t=0;t<o;t++){const e=Math.abs(r[t]);e>i&&(i=e)}if(a+1>this.dataWindow.length){const t=new Float32Array(2*this.dataWindow.length);t.set(this.dataWindow,0),this.dataWindow=t}this.dataWindow[a]=i,a++}else this.dataWindow=r;if(this.wavesurfer){const t=(null!==(l=null===(s=this.dataWindow)||void 0===s?void 0:s.length)&&void 0!==l?l:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:t).then((()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1e3),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))})).catch((t=>{}))}}}),10);return{onDestroy:()=>{clearInterval(l),null==s||s.disconnect(),null==i||i.close()},onEnd:()=>{this.isWaveformPaused=!0,clearInterval(l),this.stopMic()}}}startMic(t){return ct(this,0,void 0,(function*(){let e;try{e=yield navigator.mediaDevices.getUserMedia({audio:null==t||t})}catch(e){throw new Error("Error accessing the microphone: "+e.message)}const{onDestroy:i,onEnd:s}=this.renderMicStream(e);return this.subscriptions.push(this.once("destroy",i)),this.subscriptions.push(this.once("record-end",s)),this.stream=e,e}))}stopMic(){this.stream&&(this.stream.getTracks().forEach((t=>t.stop())),this.stream=null,this.mediaRecorder=null)}startRecording(t){return ct(this,0,void 0,(function*(){const e=this.stream||(yield this.startMic(t));this.dataWindow=null;const i=this.mediaRecorder||new MediaRecorder(e,{mimeType:this.options.mimeType||gt.find((t=>MediaRecorder.isTypeSupported(t))),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=i,this.stopRecording();const s=[];i.ondataavailable=t=>{t.data.size>0&&s.push(t.data),this.emit("record-data-available",t.data)};const n=t=>{var e;const n=new Blob(s,{type:i.mimeType});this.emit(t,n),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),null===(e=this.wavesurfer)||void 0===e||e.load(URL.createObjectURL(n)))};i.onpause=()=>n("record-pause"),i.onstop=()=>n("record-end"),i.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")}))}getDuration(){return this.duration}isRecording(){var t;return"recording"===(null===(t=this.mediaRecorder)||void 0===t?void 0:t.state)}isPaused(){var t;return"paused"===(null===(t=this.mediaRecorder)||void 0===t?void 0:t.state)}isActive(){var t;return"inactive"!==(null===(t=this.mediaRecorder)||void 0===t?void 0:t.state)}stopRecording(){var t;this.isActive()&&(null===(t=this.mediaRecorder)||void 0===t||t.stop(),this.timer.stop())}pauseRecording(){var t,e;this.isRecording()&&(this.isWaveformPaused=!0,null===(t=this.mediaRecorder)||void 0===t||t.requestData(),null===(e=this.mediaRecorder)||void 0===e||e.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,null===(t=this.mediaRecorder)||void 0===t||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return ct(this,0,void 0,(function*(){return navigator.mediaDevices.enumerateDevices().then((t=>t.filter((t=>"audioinput"===t.kind))))}))}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic()}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}};class ft{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}}class vt extends ft{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t()))}}function bt(t,e,i,s,n=3,o=0,r=100){if(!t)return()=>{};const a=matchMedia("(pointer: coarse)").matches;let l=()=>{};const h=h=>{if(h.button!==o)return;h.preventDefault(),h.stopPropagation();let c=h.clientX,d=h.clientY,u=!1;const p=Date.now(),g=s=>{if(s.preventDefault(),s.stopPropagation(),a&&Date.now()-p<r)return;const o=s.clientX,l=s.clientY,h=o-c,g=l-d;if(u||Math.abs(h)>n||Math.abs(g)>n){const s=t.getBoundingClientRect(),{left:n,top:r}=s;u||(null==i||i(c-n,d-r),u=!0),e(h,g,o-n,l-r),c=o,d=l}},m=e=>{if(u){const i=e.clientX,n=e.clientY,o=t.getBoundingClientRect(),{left:r,top:a}=o;null==s||s(i-r,n-a)}l()},f=t=>{t.relatedTarget&&t.relatedTarget!==document.documentElement||m(t)},v=t=>{u&&(t.stopPropagation(),t.preventDefault())},b=t=>{u&&t.preventDefault()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",m),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",v,{capture:!0}),l=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",m),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",b),setTimeout((()=>{document.removeEventListener("click",v,{capture:!0})}),10)}};return t.addEventListener("pointerdown",h),()=>{l(),t.removeEventListener("pointerdown",h)}}function yt(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,s]of Object.entries(e))"string"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(yt(t,s));else"style"===t?Object.assign(i.style,s):"textContent"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function wt(t,e,i){const s=yt(t,e||{});return null==i||i.appendChild(s),s}const Ct={points:[],lineWidth:4,lineColor:"rgba(0, 0, 255, 0.5)",dragPointSize:10,dragPointFill:"rgba(255, 255, 255, 0.8)",dragPointStroke:"rgba(255, 255, 255, 0.8)"};class xt extends ft{constructor(t,e){super(),this.subscriptions=[],this.subscriptions=[],this.options=t,this.polyPoints=new Map;const i=e.clientWidth,s=e.clientHeight,n=wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",viewBox:`0 0 ${i} ${s}`,preserveAspectRatio:"none",style:{position:"absolute",left:"0",top:"0",zIndex:"4"},part:"envelope"},e);this.svg=n;const o=wt("polyline",{xmlns:"http://www.w3.org/2000/svg",points:`0,${s} ${i},${s}`,stroke:t.lineColor,"stroke-width":t.lineWidth,fill:"none",part:"polyline",style:t.dragLine?{cursor:"row-resize",pointerEvents:"stroke"}:{}},n);t.dragLine&&this.subscriptions.push(bt(o,((t,e)=>{const{height:i}=n.viewBox.baseVal,{points:s}=o;for(let t=1;t<s.numberOfItems-1;t++){const n=s.getItem(t);n.y=Math.min(i,Math.max(0,n.y+e))}const r=n.querySelectorAll("ellipse");Array.from(r).forEach((t=>{const s=Math.min(i,Math.max(0,Number(t.getAttribute("cy"))+e));t.setAttribute("cy",s.toString())})),this.emit("line-move",e/i)}))),n.addEventListener("dblclick",(t=>{const e=n.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;this.emit("point-create",i/e.width,s/e.height)}));{let t;const e=()=>clearTimeout(t);n.addEventListener("touchstart",(i=>{1===i.touches.length?t=window.setTimeout((()=>{i.preventDefault();const t=n.getBoundingClientRect(),e=i.touches[0].clientX-t.left,s=i.touches[0].clientY-t.top;this.emit("point-create",e/t.width,s/t.height)}),500):e()})),n.addEventListener("touchmove",e),n.addEventListener("touchend",e)}}makeDraggable(t,e){this.subscriptions.push(bt(t,e,(()=>t.style.cursor="grabbing"),(()=>t.style.cursor="grab"),1))}createCircle(t,e){const i=this.options.dragPointSize/2;return wt("ellipse",{xmlns:"http://www.w3.org/2000/svg",cx:t,cy:e,rx:i,ry:i,fill:this.options.dragPointFill,stroke:this.options.dragPointStroke,"stroke-width":"2",style:{cursor:"grab",pointerEvents:"all"},part:"envelope-circle"},this.svg)}removePolyPoint(t){const e=this.polyPoints.get(t);if(!e)return;const{polyPoint:i,circle:s}=e,{points:n}=this.svg.querySelector("polyline"),o=Array.from(n).findIndex((t=>t.x===i.x&&t.y===i.y));n.removeItem(o),s.remove(),this.polyPoints.delete(t)}addPolyPoint(t,e,i){const{svg:s}=this,{width:n,height:o}=s.viewBox.baseVal,r=t*n,a=o-e*o,l=this.options.dragPointSize/2,h=s.createSVGPoint();h.x=t*n,h.y=o-e*o;const c=this.createCircle(r,a),{points:d}=s.querySelector("polyline"),u=Array.from(d).findIndex((t=>t.x>=r));d.insertItemBefore(h,Math.max(u,1)),this.polyPoints.set(i,{polyPoint:h,circle:c}),this.makeDraggable(c,((t,e)=>{const s=h.x+t,r=h.y+e;if(s<-l||r<-l||s>n+l||r>o+l)return void this.emit("point-dragout",i);const a=Array.from(d).find((t=>t.x>h.x)),u=Array.from(d).findLast((t=>t.x<h.x));a&&s>=a.x||u&&s<=u.x||(h.x=s,h.y=r,c.setAttribute("cx",s.toString()),c.setAttribute("cy",r.toString()),this.emit("point-move",i,s/n,r/o))}))}update(){const{svg:t}=this,e=t.viewBox.baseVal.width/t.clientWidth,i=t.viewBox.baseVal.height/t.clientHeight;t.querySelectorAll("ellipse").forEach((t=>{const s=this.options.dragPointSize/2,n=s*e,o=s*i;t.setAttribute("rx",n.toString()),t.setAttribute("ry",o.toString())}))}destroy(){this.subscriptions.forEach((t=>t())),this.polyPoints.clear(),this.svg.remove()}}class St extends vt{constructor(t){super(t),this.polyline=null,this.throttleTimeout=null,this.volume=1,this.points=t.points||[],this.options=Object.assign({},Ct,t),this.options.lineColor=this.options.lineColor||Ct.lineColor,this.options.dragPointFill=this.options.dragPointFill||Ct.dragPointFill,this.options.dragPointStroke=this.options.dragPointStroke||Ct.dragPointStroke,this.options.dragPointSize=this.options.dragPointSize||Ct.dragPointSize}static create(t){return new St(t)}addPoint(t){var e;t.id||(t.id=Math.random().toString(36).slice(2));const i=this.points.findLastIndex((e=>e.time<t.time));this.points.splice(i+1,0,t),this.emitPoints();const s=null===(e=this.wavesurfer)||void 0===e?void 0:e.getDuration();s&&this.addPolyPoint(t,s)}removePoint(t){var e;const i=this.points.indexOf(t);i>-1&&(this.points.splice(i,1),null===(e=this.polyline)||void 0===e||e.removePolyPoint(t),this.emitPoints())}getPoints(){return this.points}setPoints(t){this.points.slice().forEach((t=>this.removePoint(t))),t.forEach((t=>this.addPoint(t)))}destroy(){var t;null===(t=this.polyline)||void 0===t||t.destroy(),super.destroy()}getCurrentVolume(){return this.volume}setVolume(t){var e;this.volume=t,null===(e=this.wavesurfer)||void 0===e||e.setVolume(t)}onInit(){var t;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const{options:e}=this;e.volume=null!==(t=e.volume)&&void 0!==t?t:this.wavesurfer.getVolume(),this.setVolume(e.volume),this.subscriptions.push(this.wavesurfer.on("decode",(t=>{this.initPolyline(),this.points.forEach((e=>{this.addPolyPoint(e,t)}))})),this.wavesurfer.on("redraw",(()=>{var t;null===(t=this.polyline)||void 0===t||t.update()})),this.wavesurfer.on("timeupdate",(t=>{this.onTimeUpdate(t)})))}emitPoints(){this.throttleTimeout&&clearTimeout(this.throttleTimeout),this.throttleTimeout=setTimeout((()=>{this.emit("points-change",this.points)}),200)}initPolyline(){if(this.polyline&&this.polyline.destroy(),!this.wavesurfer)return;const t=this.wavesurfer.getWrapper();this.polyline=new xt(this.options,t),this.subscriptions.push(this.polyline.on("point-move",((t,e,i)=>{var s;const n=(null===(s=this.wavesurfer)||void 0===s?void 0:s.getDuration())||0;t.time=e*n,t.volume=1-i,this.emitPoints()})),this.polyline.on("point-dragout",(t=>{this.removePoint(t)})),this.polyline.on("point-create",((t,e)=>{var i;this.addPoint({time:t*((null===(i=this.wavesurfer)||void 0===i?void 0:i.getDuration())||0),volume:1-e})})),this.polyline.on("line-move",(t=>{var e;this.points.forEach((e=>{e.volume=Math.min(1,Math.max(0,e.volume-t))})),this.emitPoints(),this.onTimeUpdate((null===(e=this.wavesurfer)||void 0===e?void 0:e.getCurrentTime())||0)})))}addPolyPoint(t,e){var i;null===(i=this.polyline)||void 0===i||i.addPolyPoint(t.time/e,t.volume,t)}onTimeUpdate(t){if(!this.wavesurfer)return;let e=this.points.find((e=>e.time>t));e||(e={time:this.wavesurfer.getDuration()||0,volume:0});let i=this.points.findLast((e=>e.time<=t));i||(i={time:0,volume:0});const s=e.time-i.time,n=e.volume-i.volume,o=i.volume+(t-i.time)*(n/s),r=Math.min(1,Math.max(0,o)),a=Math.round(100*r)/100;a!==this.getCurrentVolume()&&(this.setVolume(a),this.emit("volume-change",a))}}const kt=new class{constructor(){this.version="1.0.0",this.modules=new Map,this.initialized=!1}async init(){try{await this.loadCoreModules(),await this.loadFrameworkModules(),await this.loadApplicationModules(),this.initialized=!0,window.SQUIRREL_VERSION=this.version,window.squirrel=this}catch(t){this.handleInitError(t)}}async loadCoreModules(){await this.loadModulesParallel([{name:"utils",path:"../native/utils.js"}])}async loadFrameworkModules(){await this.loadModulesParallel([{name:"core",path:"../a/a.js"},{name:"apis",path:"../a/apis.js",optional:!0},{name:"particles",path:"../a/particles/all.js",optional:!0}])}async loadApplicationModules(){this.shouldLoadApplication()&&await this.loadModule("application","../application/index.js",!0)}async loadModulesParallel(t){const e=t.map((t=>this.loadModule(t.name,t.path,t.optional)));(await Promise.allSettled(e)).forEach(((e,i)=>{if("rejected"===e.status){t[i].optional}}))}async loadModule(t,e,i=!1){try{const i=await import(e);return this.modules.set(t,i),i}catch(t){return null}}shouldLoadApplication(){return!window.location.search.includes("debug=core")&&(!(window.location.pathname.includes("test-")&&!window.location.search.includes("app=true"))&&!window.location.search.includes("app=false"))}handleInitError(t){const e=document.createElement("div");e.style.cssText="\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background: #ff4444;\n            color: white;\n            padding: 20px;\n            border-radius: 8px;\n            text-align: center;\n            z-index: 10000;\n            font-family: Arial, sans-serif;\n        ",e.innerHTML=`\n            <h2>❌ Erreur d'initialisation Squirrel</h2>\n            <p>${t.message}</p>\n            <button onclick="location.reload()" style="\n                background: white;\n                color: #ff4444;\n                border: none;\n                padding: 10px 20px;\n                border-radius: 4px;\n                cursor: pointer;\n                margin-top: 10px;\n            ">Recharger</button>\n        `,document.body.appendChild(e)}getModule(t){return this.modules.get(t)}isReady(){return this.initialized}getVersion(){return this.version}listModules(){return Array.from(this.modules.keys())}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>kt.init())):kt.init(),window.Module=Module,window.Slider=Slider,window.Matrix=Matrix,window.SquirrelWaveSurfer=i,window.WaveSurferComponent=i,window.WaveSurfer=m,window.WaveSurferRegions=S,window.WaveSurferTimeline=T,window.WaveSurferMinimap=U,window.WaveSurferZoom=Z,window.WaveSurferHover=it,window.WaveSurferSpectrogram=ht,window.WaveSurferRecord=mt,window.WaveSurferEnvelope=St,window.WaveSurferPlugins={Regions:S,Timeline:T,Minimap:U,Zoom:Z,Hover:it,Spectrogram:ht,Record:mt,Envelope:St};class Mt{constructor(){this.loadedPlugins=new Set,this.pluginCache=new Map,this.baseUrl="./js/wavesurfer-v7/"}async loadWaveSurfer(){try{const t=await import(`${this.baseUrl}core/wavesurfer.esm.js`);return window.WaveSurfer=t.default,t.default}catch(t){throw t}}async loadPlugin(t){if(this.loadedPlugins.has(t))return this.pluginCache.get(t);try{const e=await import(`${this.baseUrl}${t}.esm.js`);return this.loadedPlugins.add(t),this.pluginCache.set(t,e.default),e.default}catch(t){throw t}}async loadPlugins(t=[]){const e={};for(const i of t)try{e[i]=await this.loadPlugin(i)}catch(t){e[i]=null}return e}async initialize(t=[]){try{const e=await this.loadWaveSurfer();if(t.length>0){const i=await this.loadPlugins(t);Object.entries(i).forEach((([t,i])=>{i&&e.registerPlugin(i)}))}return e}catch(t){throw t}}getAvailablePlugins(){return["regions","timeline","minimap","zoom","hover","spectrogram","record","envelope"]}isPluginLoaded(t){return this.loadedPlugins.has(t)}getLoadedPlugins(){return Array.from(this.loadedPlugins)}}window.WaveSurferV7Loader=new Mt;var Et=Object.freeze({__proto__:null,default:Mt});return kt}();
