class t{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null!=i&&i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){null!=(t=this.listeners[t])&&t.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach(t=>t(...e))}}class e extends t{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(t=>t()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function i(t,e){const s=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,n]of Object.entries(e))if("children"===t&&n)for(const[t,e]of Object.entries(n))e instanceof Node?s.appendChild(e):"string"==typeof e?s.appendChild(document.createTextNode(e)):s.appendChild(i(t,e));else"style"===t?Object.assign(s.style,n):"textContent"===t?s.textContent=n:s.setAttribute(t,n.toString());return s}function s(t,e,s){return i(t,e||{})}const n={height:20,timeOffset:0,formatTimeCallback:t=>1<t/60?Math.floor(t/60)+":"+((t=Math.round(t%60))<10?"0":"")+t:""+Math.round(1e3*t)/1e3};class r extends e{constructor(t){super(t||{}),this.unsubscribeNotches=[],this.options=Object.assign({},n,t),this.timelineWrapper=this.initTimelineWrapper()}static create(t){return new r(t)}onInit(){var t;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let e=this.wavesurfer.getWrapper();if(this.options.container instanceof HTMLElement)e=this.options.container;else if("string"==typeof this.options.container){const t=document.querySelector(this.options.container);if(!t)throw Error("No Timeline container found matching "+this.options.container);e=t}this.options.insertPosition?(e.firstElementChild||e).insertAdjacentElement(this.options.insertPosition,this.timelineWrapper):e.appendChild(this.timelineWrapper),this.subscriptions.push(this.wavesurfer.on("redraw",()=>this.initTimeline())),(null!=(t=this.wavesurfer)&&t.getDuration()||this.options.duration)&&this.initTimeline()}destroy(){this.unsubscribeNotches.forEach(t=>t()),this.unsubscribeNotches=[],this.timelineWrapper.remove(),super.destroy()}initTimelineWrapper(){return s("div",{part:"timeline-wrapper",style:{pointerEvents:"none"}})}defaultTimeInterval(t){return 25<=t?1:25<=5*t?5:25<=15*t?15:60*Math.ceil(.5/t)}defaultPrimaryLabelInterval(t){return 25<=t?10:25<=5*t?6:4}defaultSecondaryLabelInterval(t){return 25<=t?5:2}virtualAppend(s,n,r){let o=!1;const l=(t,e)=>{var i;this.wavesurfer&&(i=r.clientWidth,(t=t<=s&&s+i<e)!==o&&((o=t)?n.appendChild(r):r.remove()))};var t,e;this.wavesurfer&&(e=(t=this.wavesurfer.getScroll())+this.wavesurfer.getWidth(),l(t,e),this.unsubscribeNotches.push(this.wavesurfer.on("scroll",(t,e,i,s)=>{l(i,s)})))}initTimeline(){var i,n,r,t,o;this.unsubscribeNotches.forEach(t=>t()),this.unsubscribeNotches=[];const l=null!=(o=null!=(t=null==(t=this.wavesurfer)?void 0:t.getDuration())?t:this.options.duration)?o:0,a=((null==(i=this.wavesurfer)?void 0:i.getWrapper().scrollWidth)||this.timelineWrapper.scrollWidth)/l,h=null!=(n=this.options.timeInterval)?n:this.defaultTimeInterval(a),p=null!=(r=this.options.primaryLabelInterval)?r:this.defaultPrimaryLabelInterval(a),u=this.options.primaryLabelSpacing,c=null!=(t=this.options.secondaryLabelInterval)?t:this.defaultSecondaryLabelInterval(a),d=this.options.secondaryLabelSpacing,e="beforebegin"===this.options.insertPosition,f=s("div",{style:Object.assign({height:this.options.height+"px",overflow:"hidden",fontSize:this.options.height/2+"px",whiteSpace:"nowrap"},e?{position:"absolute",top:"0",left:"0",right:"0",zIndex:"2"}:{position:"relative"})}),m=(f.setAttribute("part","timeline"),"string"==typeof this.options.style?f.setAttribute("style",f.getAttribute("style")+this.options.style):"object"==typeof this.options.style&&Object.assign(f.style,this.options.style),s("div",{style:{width:"0",height:"50%",display:"flex",flexDirection:"column",justifyContent:e?"flex-start":"flex-end",top:e?"0":"auto",bottom:e?"auto":"0",overflow:"visible",borderLeft:"1px solid currentColor",opacity:""+(null!=(o=this.options.secondaryLabelOpacity)?o:.25),position:"absolute",zIndex:"1"}}));for(let t=0,e=0;t<l;t+=h,e++){const o=m.cloneNode(),s=Math.round(100*t)%Math.round(100*p)==0||u&&e%u==0,i=Math.round(100*t)%Math.round(100*c)==0||d&&e%d==0,n=((s||i)&&(o.style.height="100%",o.style.textIndent="3px",o.textContent=this.options.formatTimeCallback(t),s&&(o.style.opacity="1")),s?"primary":i?"secondary":"tick"),r=(o.setAttribute("part","timeline-notch timeline-notch-"+n),Math.round(100*(t+this.options.timeOffset))/100*a);o.style.left=r+"px",this.virtualAppend(r,f,o)}this.timelineWrapper.innerHTML="",this.timelineWrapper.appendChild(f),this.emit("ready")}}export{r as default};