/*! Squirrel.js v1.0.0 | MIT License | 2025-06-18T19:29:39.837Z */
var Squirrel=function(e){"use strict";const t=new Map,n=new Map,s=new WeakMap,i=new WeakMap,r=e=>{if(n.has(e))return n.get(e);const t=e.replace(/([A-Z])/g,"-$1").toLowerCase();return n.set(e,t),t},o=e=>e.startsWith("on"),a=new Set(["draggable","hidden","spellcheck","contenteditable","disabled","checked","readonly"]),l=(e,t)=>{t&&("string"==typeof t?-1===t.indexOf(" ")?e.classList.add(t):e.classList.add(...t.split(" ")):Array.isArray(t)&&e.classList.add(...t))},d=(e,n={})=>{const c=t.get(e)||{},u=(g=c.tag||n.tag||e||"div",document.createElement(g));var g;const w={...c,...n};if((c.css||n.css)&&("string"==typeof c.css&&"string"==typeof n.css?w.css=c.css+";"+n.css:"object"==typeof c.css&&"object"==typeof n.css?w.css={...c.css,...n.css}:w.css=n.css||c.css),(c.attrs||n.attrs)&&(w.attrs={...c.attrs||{},...n.attrs||{}}),w.mark&&u.setAttribute("data-hyperfactory","true"),w.id&&(u.id=w.id),w.text&&(u.textContent=w.text),l(u,w.class),w.attrs)for(const[e,t]of Object.entries(w.attrs))null==t?u.removeAttribute(e):a.has(e)?t?u.setAttribute(e,""):u.removeAttribute(e):u.setAttribute(e,t);if(w.css)if("string"==typeof w.css)u.style.cssText=w.css;else for(const e in w.css)if(w.css.hasOwnProperty(e)){const t=w.css[e],n=r(e);null==t?u.style.removeProperty(n):u.style.setProperty(n,t)}s.set(u,{});for(const e in w)if(o(e)&&"function"==typeof w[e]){const t=e.slice(2).toLowerCase(),n=w[e];u.addEventListener(t,n),s.get(u)[t]=n}w.children&&w.children.forEach((e=>{const t=d(e.id,e);u.appendChild(t)})),u.$=e=>{if("text"in e&&(u.textContent=e.text),e.class&&l(u,e.class),e.css)if("string"==typeof e.css)u.style.cssText=e.css;else for(const t in e.css)if(e.css.hasOwnProperty(t)){const n=e.css[t],s=r(t);null==n?u.style.removeProperty(s):u.style.setProperty(s,n)}if(e.attrs)for(const t in e.attrs)if(e.attrs.hasOwnProperty(t)){const n=e.attrs[t];null==n?u.removeAttribute(t):a.has(t)?n?u.setAttribute(t,""):u.removeAttribute(t):u.setAttribute(t,n)}const t=s.get(u);for(const n in e)if(o(n)&&"function"==typeof e[n]){const s=n.slice(2).toLowerCase(),i=e[n];t[s]&&u.removeEventListener(s,t[s]),u.addEventListener(s,i),t[s]=i}return u},u._=u.style;const p=w.parent||"#view";if("string"==typeof p){const e=document.querySelector(p);e?e.appendChild(u):console.warn(`Parent selector "${p}" not found`)}else p.appendChild(u);return u.animate=(e,t={})=>u.animate(e,{duration:t.duration||300,easing:t.easing||"ease",fill:"forwards"}).finished,u.remove=()=>{const e=i.get(u);e&&(e.forEach((e=>e.disconnect())),i.delete(u));const t=s.get(u);if(t){for(const e in t)t.hasOwnProperty(e)&&u.removeEventListener(e,t[e]);s.delete(u)}u.parentNode?.removeChild(u)},u},c=(e,n)=>(t.set(e,n),n),u=(e,t,n={})=>{const s=new MutationObserver((e=>{e.forEach((e=>t(e)))}));s.observe(e,{attributes:!0,childList:!0,subtree:!0,...n}),i.has(e)||i.set(e,[]),i.get(e).push(s)};window.puts=function(e){console.log(e)},window.print=function(e){console.log("[PRINT]",e)},window.grab=function(){const e=new Map;return function(t){if(!t)return null;const n=_registry[t];if(n)return n;if(e.has(t)){const n=e.get(t);if(n&&n.isConnected)return n;e.delete(t)}const s=document.getElementById(t);if(!s)return null;if(!s._enhanced){s._enhanced=!0;["width","height","color","backgroundColor","x","y"].forEach((e=>{const t="x"===e?"left":"y"===e?"top":e;s[e]=function(e){return 0===arguments.length?getComputedStyle(this)[t]:(this.style[t]=window._isNumber&&window._isNumber(e)?window._formatSize(e):e,this)}}))}return e.set(t,s),s}}(),Object.prototype.define_method=function(e,t){return this[e]=t,this},Array.prototype.each=function(e){return this.forEach(e),this},Object.prototype.inspect=function(){return AJS.inspect(this)};window.wait=(e,t)=>{if("function"!=typeof t)return new Promise((t=>setTimeout(t,e)));setTimeout(t,e)},window.log=window.puts,window._registry=window._registry||{},window.AJS=window.AJS||{inspect:function(e){return JSON.stringify(e,null,2)}};class g{constructor(){this.plugins=new Map,this.loadedPlugins=new Set,this.componentsPath="./components/",this.registeredComponents=[]}async discover(){const e=["List_builder","badge_builder","button_builder","draggable_builder","matrix_builder","menu_builder","slider_builder","table_builder","tooltip_builder","unit_builder"];return e.forEach((e=>{this.registerLazyPlugin(e)})),this.registeredComponents=e,e}registerLazyPlugin(e){const t=this.getPluginName(e);this.plugins.set(t,{componentFile:e,loaded:!1,instance:null,loader:()=>this.loadComponent(e,t)})}getPluginName(e){const t=e.replace("_builder","").replace(".js","");return t.charAt(0).toUpperCase()+t.slice(1)}async loadComponent(e,t){if(this.loadedPlugins.has(t))return this.plugins.get(t);try{const n=`${this.componentsPath}${e}.js`,s=await import(n);this.exposePlugin(e,s,t);const i=this.plugins.get(t);return i.loaded=!0,i.instance=window[t],this.loadedPlugins.add(t),i}catch(e){throw console.error(`❌ Erreur lors du chargement du plugin "${t}":`,e),e}}getExportName(e,t){if(t.default)return"default";return Object.keys(t)[0]||"default"}exposePlugin(e,t,n){if(t.default&&"function"==typeof t.default.create)return window[n]=t.default.create,window[n+"Styles"]=t.default,"draggable_builder"===e&&(window.makeDraggable=t.makeDraggable,window.makeDraggableWithDrop=t.makeDraggableWithDrop,window.makeDropZone=t.makeDropZone),void("unit_builder"===e&&Object.assign(window[n],{deleteUnit:t.deleteUnit,deleteUnits:t.deleteUnits,selectUnit:t.selectUnit,selectUnits:t.selectUnits,deselectUnit:t.deselectUnit,deselectUnits:t.deselectUnits,deselectAllUnits:t.deselectAllUnits,getSelectedUnits:t.getSelectedUnits,renameUnit:t.renameUnit,renameUnits:t.renameUnits,connectUnits:t.connectUnits,disconnectUnits:t.disconnectUnits,getAllConnections:t.getAllConnections,getUnit:t.getUnit,getAllUnits:t.getAllUnits}));if(t.default&&"function"==typeof t.default)return void(window[n]=t.default);const s=`create${n}`;if(t[s]&&"function"==typeof t[s])return void(window[n]=t[s]);const i=Object.keys(t).filter((e=>e.startsWith("create")&&"function"==typeof t[e]));if(i.length>0)return void(window[n]=t[i[0]]);const r=Object.keys(t).filter((e=>"function"==typeof t[e]));r.length>0?window[n]=t[r[0]]:t.default?window[n]=t.default:this.exposePluginManual(e,t,n)}exposePluginManual(e,t,n){if("draggable_builder"===e)window.draggable=t.draggable,window.makeDraggable=t.makeDraggable,window.makeDraggableWithDrop=t.makeDraggableWithDrop,window.makeDropZone=t.makeDropZone,window.Draggable=t.draggable;else{const e=Object.keys(t)[0];e?window[n]=t[e]:(console.warn(`❌ Impossible d'exposer le plugin ${n} automatiquement`),console.warn("   Module exports:",Object.keys(t)))}}async load(e){const t=this.plugins.get(e);if(!t)throw new Error(`Plugin "${e}" non trouvé. Plugins disponibles: ${Array.from(this.plugins.keys()).join(", ")}`);return t.loaded||await t.loader(),t.instance}async loadMultiple(e){const t={};for(const n of e)try{t[n]=await this.load(n)}catch(e){console.error(`Erreur lors du chargement de ${n}:`,e),t[n]=null}return t}async loadAll(){const e=Array.from(this.plugins.keys());return await this.loadMultiple(e)}getAvailablePlugins(){return Array.from(this.plugins.keys())}getLoadedPlugins(){return Array.from(this.loadedPlugins)}getStatus(){const e=this.getAvailablePlugins(),t=this.getLoadedPlugins();return{available:e.length,loaded:t.length,availableList:e,loadedList:t,pending:e.filter((e=>!t.includes(e)))}}loadSync(e){const t=this.plugins.get(e);return t?t.loaded?t.instance:(console.warn(`⚠️ Tentative de chargement synchrone du plugin "${e}" non préchargé`),this.load(e).catch((t=>{console.error(`❌ Erreur chargement synchrone de "${e}":`,t)})),null):(console.error(`❌ Plugin "${e}" non trouvé. Plugins disponibles: ${Array.from(this.plugins.keys()).join(", ")}`),null)}}window.PluginManager=g;class w{constructor(e){this.pluginManager=e}async use(e){"string"==typeof e&&(e=[e]);return await this.pluginManager.loadMultiple(e)}async plugin(e){return await this.pluginManager.load(e)}hasPlugin(e){return this.pluginManager.plugins.has(e)}isPluginLoaded(e){return this.pluginManager.loadedPlugins.has(e)}getAvailablePlugins(){return this.pluginManager.getAvailablePlugins()}getLoadedPlugins(){return this.pluginManager.getLoadedPlugins()}getPluginStatus(){return this.pluginManager.getStatus()}async create(e,...t){await this.use([e]);const n=window[e];if(!n)throw new Error(`Composant "${e}" non trouvé après chargement`);return new n(...t)}async button(...e){return await this.create("Button",...e)}async slider(...e){return await this.create("Slider",...e)}async matrix(...e){return await this.create("Matrix",...e)}async module(...e){return await this.create("Module",...e)}async table(...e){return await this.create("Table",...e)}async list(...e){return await this.create("List",...e)}async menu(...e){return await this.create("Menu",...e)}}async function p(){const e={},t=["List_builder.js","badge_builder.js","button_builder.js","draggable_builder.js","matrix_builder.js","menu_builder.js","slider_builder.js","table_builder.js","tooltip_builder.js","unit_builder.js"];for(const n of t)try{const t=n.replace("_builder.js","").replace(".js",""),s=t.charAt(0).toUpperCase()+t.slice(1)+"Builder",i=await import(`../src/squirrel/components/${n}`);e[s]=i}catch(e){console.warn(`  ⚠️ Impossible de charger ${n}:`,e.message)}return e}async function f(){window.$=d,window.define=c,window.observeMutations=u,window.body=document.body,window.toKebabCase=e=>e.replace(/([A-Z])/g,"-$1").toLowerCase();const e=new g;window.pluginManager=e;const t=new w(e);window.Squirrel=t;const n=await p();Object.entries(n).forEach((([t,n])=>{try{if(n.default&&n.default.create){const s=t.replace("Builder","");window[s]=n.default.create,window[`${s}Styles`]=n.default,"Draggable"===s&&(window.draggable=n.default.create,window.makeDraggable=n.default.makeDraggable,window.makeDraggableWithDrop=n.default.makeDraggableWithDrop,window.makeDropZone=n.default.makeDropZone),e.loadedPlugins.add(s)}}catch(e){console.warn(`  ⚠️ Erreur lors de l'exposition de ${t}:`,e.message)}})),window.loadPlugin=async e=>window[e],window.dispatchEvent(new CustomEvent("squirrel:ready",{detail:{version:"1.0.0",components:Array.from(e.loadedPlugins),count:Object.keys(n).length,dynamicLoading:!0}}))}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):setTimeout(f,0));var h={init:f,loadComponents:p};return e.default=h,e.initSquirrel=f,e.loadComponents=p,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
