!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Squirrel={})}(this,function(t){"use strict";window.puts=function(t){console.log(t)},window.print=function(t){console.log("[PRINT]",t)},window.grab=function(){const t=new Map;return function(e){if(!e)return null;const n=_registry[e];if(n)return n;if(t.has(e)){const n=t.get(e);if(n&&n.isConnected)return n;t.delete(e)}const i=document.getElementById(e);if(!i)return null;if(!i._enhanced){i._enhanced=!0;["width","height","color","backgroundColor","x","y"].forEach(t=>{const e="x"===t?"left":"y"===t?"top":t;i[t]=function(t){return 0===arguments.length?getComputedStyle(this)[e]:(this.style[e]=window._isNumber&&window._isNumber(t)?window._formatSize(t):t,this)}})}return t.set(e,i),i}}(),Object.prototype.define_method=function(t,e){return this[t]=e,this},Array.prototype.each=function(t){return this.forEach(t),this},Object.prototype.inspect=function(){return AJS.inspect(this)};window.wait=(t,e)=>{if("function"!=typeof e)return new Promise(e=>setTimeout(e,t));setTimeout(e,t)},window.log=window.puts,window._registry=window._registry||{},window.AJS=window.AJS||{inspect:function(t){return JSON.stringify(t,null,2)}};var e=Object.freeze({__proto__:null});const n=new Map,i=new Map,o=new WeakMap,s=new WeakMap,r=t=>{if(i.has(t))return i.get(t);const e=t.replace(/([A-Z])/g,"-$1").toLowerCase();return i.set(t,e),e},a=t=>t.startsWith("on"),l=new Set(["draggable","hidden","spellcheck","contenteditable","disabled","checked","readonly"]),c=HTMLElement.prototype.animate,d=(t,e)=>{e&&("string"==typeof e?-1===e.indexOf(" ")?t.classList.add(e):t.classList.add(...e.split(" ")):Array.isArray(e)&&t.classList.add(...e))},h=(t,e={})=>{const i=n.get(t)||{},p=(u=i.tag||e.tag||t||"div",document.createElement(u));var u;const g={...i,...e};if((i.css||e.css)&&("string"==typeof i.css&&"string"==typeof e.css?g.css=i.css+";"+e.css:"object"==typeof i.css&&"object"==typeof e.css?g.css={...i.css,...e.css}:g.css=e.css||i.css),(i.attrs||e.attrs)&&(g.attrs={...i.attrs||{},...e.attrs||{}}),g.mark&&p.setAttribute("data-hyperfactory","true"),g.id&&(p.id=g.id),g.text&&(p.textContent=g.text),d(p,g.class),g.attrs)for(const[t,e]of Object.entries(g.attrs))null==e?p.removeAttribute(t):l.has(t)?e?p.setAttribute(t,""):p.removeAttribute(t):p.setAttribute(t,e);if(g.css)if("string"==typeof g.css)p.style.cssText=g.css;else for(const t in g.css)if(g.css.hasOwnProperty(t)){const e=g.css[t],n=r(t);null==e?p.style.removeProperty(n):p.style.setProperty(n,e)}o.set(p,{});for(const t in g)if(a(t)&&"function"==typeof g[t]){const e=t.slice(2).toLowerCase(),n=g[t];p.addEventListener(e,n),o.get(p)[e]=n}g.children&&g.children.forEach(t=>{const e=h(t.id,t);p.appendChild(e)}),p.$=t=>{if("text"in t&&(p.textContent=t.text),t.class&&d(p,t.class),t.css)if("string"==typeof t.css)p.style.cssText=t.css;else for(const e in t.css)if(t.css.hasOwnProperty(e)){const n=t.css[e],i=r(e);null==n?p.style.removeProperty(i):p.style.setProperty(i,n)}if(t.attrs)for(const e in t.attrs)if(t.attrs.hasOwnProperty(e)){const n=t.attrs[e];null==n?p.removeAttribute(e):l.has(e)?n?p.setAttribute(e,""):p.removeAttribute(e):p.setAttribute(e,n)}const e=o.get(p);for(const n in t)if(a(n)&&"function"==typeof t[n]){const i=n.slice(2).toLowerCase(),o=t[n];e[i]&&p.removeEventListener(i,e[i]),p.addEventListener(i,o),e[i]=o}return p},p._=p.style;const f=g.parent||"#view",m=()=>{if("string"==typeof f){const t=document.querySelector(f);t?t.appendChild(p):console.warn(`Parent selector "${f}" not found`)}else f.appendChild(p)};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m(),p.animate=(t,e={})=>c.call(p,t,{duration:e.duration||300,easing:e.easing||"ease",fill:"forwards"}).finished,p.remove=()=>{const t=s.get(p);t&&(t.forEach(t=>t.disconnect()),s.delete(p));const e=o.get(p);if(e){for(const t in e)e.hasOwnProperty(t)&&p.removeEventListener(t,e[t]);o.delete(p)}p.parentNode?.removeChild(p)},p},p=(t,e)=>(n.set(t,e),e);var u={$:h,define:p,batch:(...t)=>{requestAnimationFrame(()=>{t.forEach(t=>{try{t()}catch(t){console.error("Batch operation failed:",t)}})})},observeMutations:(t,e,n={})=>{const i=new MutationObserver(t=>{t.forEach(t=>e(t))});i.observe(t,{attributes:!0,childList:!0,subtree:!0,...n}),s.has(t)||s.set(t,[]),s.get(t).push(i)}};p("slider-container",{tag:"div",class:"hs-slider",css:{position:"relative",display:"inline-block",userSelect:"none",touchAction:"none"}}),p("slider-track",{tag:"div",class:"hs-slider-track",css:{position:"absolute",backgroundColor:"#e0e0e0",borderRadius:"4px",overflow:"hidden",zIndex:"1",boxSizing:"border-box"}}),p("slider-progression",{tag:"div",class:"hs-slider-progression",css:{position:"absolute",backgroundColor:"#007bff",borderRadius:"0",zIndex:"2"}}),p("slider-handle",{tag:"div",class:"hs-slider-handle",css:{position:"absolute",backgroundColor:"#fff",border:"2px solid #007bff",borderRadius:"50%",cursor:"pointer",zIndex:"20",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}}),p("slider-label",{tag:"div",class:"hs-slider-label",css:{position:"absolute",fontSize:"12px",fontFamily:"system-ui, sans-serif",color:"#666",whiteSpace:"nowrap"}}),p("slider-tick",{tag:"div",class:"hs-slider-tick",css:{position:"absolute",backgroundColor:"#ccc",pointerEvents:"none"}});const g={horizontal:{container:{width:"200px",height:"20px"},track:{width:"100%",height:"4px",top:"50%",transform:"translateY(-50%)"},progression:{height:"100%",left:"0",top:"0",borderTopLeftRadius:"4px",borderBottomLeftRadius:"4px"},handle:{width:"16px",height:"16px",top:"50%"},label:{top:"25px",transform:"translateX(-50%)"}},vertical:{container:{width:"20px",height:"200px"},track:{width:"4px",height:"100%",left:"50%",transform:"translateX(-50%)"},progression:{width:"100%",bottom:"0",left:"0",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px"},handle:{width:"16px",height:"16px",left:"50%"},label:{left:"25px",transform:"translateY(-50%)"}},circular:{container:{width:"120px",height:"120px"},track:{width:"100%",height:"100%",borderRadius:"50%",border:"4px solid #e0e0e0"},progression:{display:"none"},handle:{width:"20px",height:"20px"},label:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}},f={sm:{scale:.8},md:{scale:1},lg:{scale:1.2},xl:{scale:1.5}},m=(t={})=>{const{type:e="horizontal",min:n=0,max:i=100,value:o=50,step:s=1,onChange:r,onInput:a,skin:l={},id:c,disabled:d=!1,showLabel:p=!0,showTicks:u=!1,ticks:m=[],size:b="md",radius:y,handleOffset:x=0,dragMin:C=null,dragMax:w=null,...v}=t,S=c||`slider_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,k=Math.max(n,Math.min(i,o)),E="circular"===e;let $={...g[e]?.container||{},...f[b]||{}},L={...g[e]?.track||{}},M={...g[e]?.progression||{}},z={...g[e]?.handle||{}},I={...g[e]?.label||{}};if(E&&y){const t=2*y;$.width=`${t}px`,$.height=`${t}px`}l.container&&($={...$,...l.container}),l.track&&(L={...L,...l.track}),l.progression&&(M={...M,...l.progression}),l.handle&&(z={...z,...l.handle}),l.label&&(I={...I,...l.label}),d&&($.opacity="0.6",$.pointerEvents="none");const D=h("slider-container",{id:S,css:$,...v}),R=h("slider-track",{id:`${S}_track`,css:L});let A;E&&R.$({css:{width:"100%",height:"100%",top:"0",left:"0"}}),E||(A=h("slider-progression",{id:`${S}_progression`,css:M}),R.appendChild(A));const T=h("slider-handle",{id:`${S}_handle`,css:z});let O;p&&(O=h("slider-label",{id:`${S}_label`,text:k.toString(),css:I})),u&&m.length>0&&m.forEach((t,o)=>{const s=(t-n)/(i-n)*100,r=h("slider-tick",{id:`${S}_tick_${o}`,css:{...l.tick||{},..."horizontal"===e?{left:`${s}%`,top:"12px",width:"2px",height:"6px"}:{top:100-s+"%",left:"12px",width:"6px",height:"2px"}}});D.appendChild(r)}),D.appendChild(R),!E&&A&&R.appendChild(A),D.appendChild(T),O&&D.appendChild(O);let q=!1,H=k,j=x;const N=t=>{const o=Math.max(n,Math.min(i,t));if(E){const t=(o-n)/(i-n)*100;let e=0;null!==C||null!==w?o>=_&&o<=P?e=(o-_)/(P-_)*100:o>P&&(e=100):e=t;const s=(t/100*360-90)*Math.PI/180,r=window.getComputedStyle(R),a=50-(parseFloat(r.borderWidth)||parseFloat(r.borderTopWidth)||6)/D.offsetWidth*100+j,c=50+a*Math.cos(s),d=50+a*Math.sin(s);if(T.$({css:{left:`${c}%`,top:`${d}%`,transform:"translate(-50%, -50%)",zIndex:"15"}}),R.querySelector("svg")){const t=R.querySelector(".progress-circle");if(t){const o=42,s=2*Math.PI*o;if(null!==C||null!==w){const o=e/100*(s*((P-_)/(i-n))),r=s*((_-n)/(i-n));t.style.strokeDasharray=`${o} ${s-o}`,t.style.strokeDashoffset=-r}else{const n=s-e/100*s;t.style.strokeDasharray=s,t.style.strokeDashoffset=n}}}else{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 0 100 100"),t.style.cssText="\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          transform: rotate(-90deg);\n          pointer-events: none;\n          z-index: 2;\n        ";const o=42,s=2*Math.PI*o,r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.style.cssText="\n          fill: none;\n          stroke: #e0e0e0;\n          stroke-width: 6;\n          opacity: 0.3;\n        ",r.setAttribute("cx","50"),r.setAttribute("cy","50"),r.setAttribute("r",o.toString());const a=l.progression||{},c=document.createElementNS("http://www.w3.org/2000/svg","circle");if(c.classList.add("progress-circle"),null!==C||null!==w){const t=e/100*(s*((P-_)/(i-n))),o=s*((_-n)/(i-n));c.style.cssText=`\n            fill: none;\n            stroke: ${a.stroke||M.backgroundColor||"#007bff"};\n            stroke-width: ${a.strokeWidth||"6"};\n            stroke-dasharray: ${t} ${s-t};\n            stroke-dashoffset: ${-o};\n            stroke-linecap: ${a.strokeLinecap||"butt"};\n            opacity: ${a.opacity||"1"};\n          `}else c.style.cssText=`\n            fill: none;\n            stroke: ${a.stroke||M.backgroundColor||"#007bff"};\n            stroke-width: ${a.strokeWidth||"6"};\n            stroke-dasharray: ${s};\n            stroke-dashoffset: ${s-e/100*s};\n            stroke-linecap: ${a.strokeLinecap||"butt"};\n            opacity: ${a.opacity||"1"};\n          `;c.setAttribute("cx","50"),c.setAttribute("cy","50"),c.setAttribute("r",o.toString()),t.appendChild(r),t.appendChild(c),R.appendChild(t)}}else{const t=(o-n)/(i-n)*100;"vertical"===e?(T.$({css:{top:100-t+"%",transform:"translate(-50%, -50%)"}}),A&&A.$({css:{height:`${t}%`}})):(T.$({css:{left:`${t}%`,transform:"translate(-50%, -50%)"}}),A&&A.$({css:{width:`${t}%`}}))}O&&O.$({text:Math.round(o).toString()}),H=o},U=(t,o)=>{if(E){const e=D.getBoundingClientRect(),s=t-(e.left+e.width/2),r=o-(e.top+e.height/2);let a=Math.atan2(r,s)*(180/Math.PI);a+=90,a<0&&(a+=360);const l=n+a/360*(i-n);return E?Math.max(_,Math.min(P,l)):l}if("vertical"===e){const t=R.getBoundingClientRect(),e=1-(o-t.top)/t.height;return n+Math.max(0,Math.min(1,e))*(i-n)}{const e=R.getBoundingClientRect(),o=(t-e.left)/e.width;return n+Math.max(0,Math.min(1,o))*(i-n)}},_=null!==C?C:n,P=null!==w?w:i;_<n&&console.warn(`dragMin (${_}) ne peut pas être inférieur à min (${n})`),P>i&&console.warn(`dragMax (${P}) ne peut pas être supérieur à max (${i})`);const B=t=>{if(d)return;q=!0;const e=U(t.clientX,t.clientY),n=Math.round(e/s)*s;N(n),a&&a(H),document.addEventListener("mousemove",W),document.addEventListener("mouseup",F),t.preventDefault()},W=t=>{if(!q)return;const e=U(t.clientX,t.clientY),n=Math.round(e/s)*s;N(n),a&&a(H),t.preventDefault()},F=()=>{q&&(q=!1,r&&r(H),document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",F))},Y=t=>{if(d)return;const e=t.touches[0];B({clientX:e.clientX,clientY:e.clientY,preventDefault:()=>t.preventDefault()})};return T.addEventListener("mousedown",B),R.addEventListener("mousedown",B),T.addEventListener("touchstart",Y,{passive:!1}),R.addEventListener("touchstart",Y,{passive:!1}),document.addEventListener("touchmove",t=>{if(!q)return;const e=t.touches[0];W({clientX:e.clientX,clientY:e.clientY,preventDefault:()=>t.preventDefault()})},{passive:!1}),document.addEventListener("touchend",()=>{F()}),N(k),D.setValue=t=>(N(t),r&&r(H),D),D.getValue=()=>H,D.setRange=(t,e)=>(n=t,i=e,N(H),D),D.setDisabled=t=>(d=t,D.$({css:{opacity:t?"0.6":"1",pointerEvents:t?"none":"auto"}}),D),D.setHandleOffset=t=>(E&&(j=t,N(H)),D),D.getHandleOffset=()=>j,D};p("badge-element",{tag:"span",class:"hs-badge",css:{display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"4px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"0.5px"}});const b=(t={})=>{const{text:e="Badge",variant:n="primary",css:i={},onclick:o,...s}=t,r={primary:{backgroundColor:"#007bff",color:"white"},success:{backgroundColor:"#28a745",color:"white"},warning:{backgroundColor:"#ffc107",color:"#212529"},danger:{backgroundColor:"#dc3545",color:"white"},info:{backgroundColor:"#17a2b8",color:"white"},light:{backgroundColor:"#f8f9fa",color:"#212529",border:"1px solid #dee2e6"},dark:{backgroundColor:"#343a40",color:"white"}};return h("badge-element",{text:e,css:{...r[n]||r.primary,...i,cursor:o?"pointer":"default"},onclick:o||null,...s})};p("button-container",{tag:"button",class:"hs-button",text:"hello",css:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"8px 16px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"#f8f9fa",color:"#333",fontSize:"14px",fontFamily:"system-ui, sans-serif",cursor:"pointer",transition:"all 0.2s ease",outline:"none"},attrs:{type:"button"}}),p("button-icon",{tag:"span",class:"hs-button-icon",css:{display:"inline-flex",alignItems:"center",justifyContent:"center",marginRight:"6px",fontSize:"16px"}}),p("button-text",{tag:"span",class:"hs-button-text",css:{fontSize:"inherit",fontWeight:"400",lineHeight:"1"}}),p("button-badge",{tag:"span",class:"hs-button-badge",css:{position:"absolute",top:"-6px",right:"-6px",minWidth:"18px",height:"18px",padding:"0 4px",borderRadius:"9px",backgroundColor:"#dc3545",color:"white",fontSize:"11px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"}});const y={primary:{backgroundColor:"#007bff",color:"white",borderColor:"#007bff"},secondary:{backgroundColor:"#6c757d",color:"white",borderColor:"#6c757d"},success:{backgroundColor:"#28a745",color:"white",borderColor:"#28a745"},danger:{backgroundColor:"#dc3545",color:"white",borderColor:"#dc3545"},warning:{backgroundColor:"#ffc107",color:"#212529",borderColor:"#ffc107"},outline:{backgroundColor:"transparent",borderWidth:"2px"},ghost:{backgroundColor:"transparent",border:"none",boxShadow:"none"}},x={xs:{padding:"4px 8px",fontSize:"11px"},sm:{padding:"6px 12px",fontSize:"12px"},md:{padding:"8px 16px",fontSize:"14px"},lg:{padding:"12px 24px",fontSize:"16px"},xl:{padding:"16px 32px",fontSize:"18px"}},C=(t={})=>{const{text:e="Button",icon:n,badge:i,variant:o="default",size:s="md",onClick:r,skin:a={},id:l,disabled:c=!1,...d}=t,p=l||`btn_${Date.now()}_${Math.random().toString(36).substr(2,6)}`;let u={...y[o]||{},...x[s]||{}};a.container&&(u={...u,...a.container}),c&&(u.opacity="0.6",u.cursor="not-allowed",u.pointerEvents="none");const g=h("button-container",{id:p,css:u,attrs:{disabled:c},onClick:c?void 0:r,...d});if(n){const t=h("button-icon",{id:`${p}_icon`,text:n,css:a.icon||{}});e||t.$({css:{marginRight:"0"}}),g.appendChild(t)}if(e){const t=h("button-text",{id:`${p}_text`,text:e,css:a.text||{}});g.appendChild(t)}if(void 0!==i){const t=h("button-badge",{id:`${p}_badge`,text:i.toString(),css:a.badge||{}});g.appendChild(t)}return g.updateText=t=>{const e=g.querySelector(".hs-button-text");return e&&(e.textContent=t),g},g.updateBadge=t=>{const e=g.querySelector(".hs-button-badge");if(e)e.textContent=t.toString();else if(void 0!==t){const e=h("button-badge",{id:`${p}_badge_new`,text:t.toString(),css:a.badge||{}});g.appendChild(e)}return g},g.setVariant=t=>{const e=y[t]||{};return g.$({css:e}),g},g.setDisabled=t=>(g.disabled=t,g.$({css:{opacity:t?"0.6":"1",cursor:t?"not-allowed":"pointer",pointerEvents:t?"none":"auto"}}),g),g};function w(t="draggable-box",e={}){const{content:n="Drag me!",css:i={},attrs:o={},parent:s=null,cursor:r="grab",rotationFactor:a=0,scaleFactor:l=0,constrainToParent:c=!1,bounds:d=null,onDragStart:p=()=>{},onDragMove:u=()=>{},onDragEnd:g=()=>{},dragActiveClass:f="dragging",dragHoverShadow:m="0 8px 16px rgba(0,0,0,0.2)"}=e,b=h(t,{content:n,css:i,attrs:o,parent:s}),y=function(t,e={}){const{onDragStart:n=()=>{},onDragMove:i=()=>{},onDragEnd:o=()=>{},cursor:s="move",constrainToParent:r=!1,bounds:a=null,rotationFactor:l=0,scaleFactor:c=0}=e;t.style.cursor=s,t.style.userSelect="none";let d=0,h=0;const p=e=>{let r=!0,a=e.clientX,p=e.clientY;const u=t.style.cursor;t.style.cursor="grab"===s?"grabbing":s,n(t,a,p,d,h);const g=e=>{if(!r)return;const n=e.clientX-a,o=e.clientY-p;d+=n,h+=o;let s=[`translate(${d}px, ${h}px)`];if(l>0){const t=d,e=h;if(Math.abs(t)>5||Math.abs(e)>5){const n=Math.atan2(e,t)*(180/Math.PI)*l;s.push(`rotate(${n}deg)`)}}if(c>0){const t=1+Math.sqrt(d*d+h*h)*c*.001;s.push(`scale(${Math.min(t,1.5)})`)}t.style.transform=s.join(" "),i(t,d,h,n,o),a=e.clientX,p=e.clientY,e.preventDefault()},f=e=>{r=!1,t.style.cursor=u,o(t,d,h,d,h),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",f),document.removeEventListener("mouseleave",f)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",f),document.addEventListener("mouseleave",f),e.preventDefault()};return t.addEventListener("mousedown",p),()=>{t.removeEventListener("mousedown",p),t.style.cursor="",t.style.userSelect="",t.style.transform=""}}(b,{cursor:r,rotationFactor:a,scaleFactor:l,constrainToParent:c,bounds:d,onDragStart:(t,e,n,i,o)=>{f&&t.classList.add(f),m&&(t.style.boxShadow=m),p(t,e,n,i,o)},onDragMove:(t,e,n,i,o)=>{u(t,e,n,i,o)},onDragEnd:(t,e,n,i,o)=>{f&&t.classList.remove(f),m&&(t.style.boxShadow=""),g(t,e,n,i,o)}});return b.destroyDraggable=y,b}p("draggable-box",{tag:"div",class:"hs-draggable",css:{position:"absolute",width:"100px",height:"100px",backgroundColor:"#3498db",border:"2px solid #2980b9",borderRadius:"8px",cursor:"grab",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",transition:"box-shadow 0.2s ease"}}),p("drag-handle",{tag:"div",class:"hs-drag-handle",css:{position:"absolute",top:"0",left:"0",right:"0",height:"30px",backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"8px 8px 0 0",cursor:"grab",display:"flex",alignItems:"center",justifyContent:"center"}}),p("drop-zone",{tag:"div",class:"hs-drop-zone",css:{position:"relative",minHeight:"100px",border:"2px dashed #bdc3c7",borderRadius:"8px",backgroundColor:"#ecf0f1",display:"flex",alignItems:"center",justifyContent:"center",color:"#7f8c8d",fontSize:"14px",transition:"all 0.3s ease",margin:"10px"}}),p("drop-zone-active",{css:{borderColor:"#3498db",backgroundColor:"#ebf3fd",color:"#2980b9"}}),p("drop-zone-hover",{css:{borderColor:"#27ae60",backgroundColor:"#e8f5e8",color:"#27ae60",transform:"scale(1.02)"}}),p("drop-zone-reject",{css:{borderColor:"#e74c3c",backgroundColor:"#fdf2f2",color:"#c0392b"}});class v{constructor(t={}){this.config={id:t.id||`list-${Date.now()}`,items:t.items||[],position:{x:0,y:0,...t.position},size:{width:300,height:400,...t.size},spacing:{vertical:t.spacing?.vertical??4,horizontal:t.spacing?.horizontal??0,itemPadding:t.spacing?.itemPadding??16,marginTop:t.spacing?.marginTop??0,marginBottom:t.spacing?.marginBottom??0,...t.spacing},attach:t.attach||"body",itemStyle:{fontSize:t.itemStyle?.fontSize??"14px",fontWeight:t.itemStyle?.fontWeight??"400",lineHeight:t.itemStyle?.lineHeight??"1.4",textColor:t.itemStyle?.textColor??"#212121",backgroundColor:t.itemStyle?.backgroundColor??"#ffffff",borderRadius:t.itemStyle?.borderRadius??"8px",...t.itemStyle},states:{hover:{backgroundColor:"#f5f5f5",boxShadow:"0 2px 4px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.24)",transform:"translateY(-1px)",...t.states?.hover},selected:{backgroundColor:"#1976d2",color:"#ffffff",boxShadow:"0 4px 8px rgba(25,118,210,0.3)",transform:"translateY(-1px)",...t.states?.selected},...t.states},containerStyle:t.containerStyle||{},selectable:!1!==t.selectable,multiSelect:t.multiSelect||!1,elevation:t.elevation??2,rippleEffect:!1!==t.rippleEffect,debug:t.debug||!1},this.itemsMap=new Map,this.itemStates=new Map,this.itemElements=new Map,this.selectedItems=new Set,this.callbacks={onItemClick:t.onItemClick||null,onItemSelect:t.onItemSelect||null,onItemHover:t.onItemHover||null,onItemLeave:t.onItemLeave||null},this.container=null,this.isInitialized=!1,this.init()}init(){try{this.createContainer(),this.createItems(),this.setupEventListeners(),this.isInitialized=!0,this.config.debug}catch(t){console.error(`❌ Erreur lors de l'initialisation de List "${this.config.id}":`,t)}}createContainer(){const t="string"==typeof this.config.attach?document.querySelector(this.config.attach):this.config.attach;if(!t)throw new Error(`Point d'attachement "${this.config.attach}" non trouvé`);this.container=document.createElement("div"),this.container.id=this.config.id,this.container.className="list-container",this.applyContainerStyles(),t.appendChild(this.container)}applyContainerStyles(){const t=this.getElevationShadow(this.config.elevation),e={...{position:"absolute",left:`${this.config.position.x}px`,top:`${this.config.position.y}px`,width:`${this.config.size.width}px`,height:`${this.config.size.height}px`,overflow:"auto",background:"#ffffff",borderRadius:"12px",padding:"8px",boxShadow:t,border:"none",fontFamily:'Roboto, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'},...this.config.containerStyle};Object.assign(this.container.style,e)}getElevationShadow(t){const e={0:"none",1:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)",2:"0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)",3:"0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23)",4:"0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22)",5:"0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22)"};return e[t]||e[2]}createItems(){this.config.items.forEach((t,e)=>{const n=this.createItem(t,e);this.container.appendChild(n)})}createItem(t,e){const n=document.createElement("div"),i=t.id||`item-${e}`;return n.id=i,n.className="list-item",n.textContent=t.content||t.text||`Élément ${e+1}`,this.itemsMap.set(i,t),this.itemElements.set(i,n),this.itemStates.set(i,"default"),this.applyItemStyles(n,t),n}applyItemStyles(t,e){const n={...{padding:`${this.config.spacing.itemPadding}px`,marginTop:`${this.config.spacing.marginTop}px`,marginBottom:`${this.config.spacing.vertical}px`,marginLeft:`${this.config.spacing.horizontal}px`,marginRight:`${this.config.spacing.horizontal}px`,fontSize:this.config.itemStyle.fontSize,fontWeight:this.config.itemStyle.fontWeight,lineHeight:this.config.itemStyle.lineHeight,color:this.config.itemStyle.textColor,fontFamily:"inherit",background:this.config.itemStyle.backgroundColor,borderRadius:this.config.itemStyle.borderRadius,border:"none",boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)",cursor:"pointer",transition:"all 0.2s cubic-bezier(0.4, 0.0, 0.2, 1)",position:"relative",overflow:"hidden",userSelect:"none"},...this.config.itemStyle.default||{},...e.style||{}};Object.assign(t.style,n),this.config.rippleEffect&&this.addRippleEffect(t)}addRippleEffect(t){t.addEventListener("click",e=>{const n=document.createElement("span"),i=t.getBoundingClientRect(),o=Math.max(i.width,i.height),s=e.clientX-i.left-o/2,r=e.clientY-i.top-o/2;if(n.style.cssText=`\n        position: absolute;\n        width: ${o}px;\n        height: ${o}px;\n        left: ${s}px;\n        top: ${r}px;\n        background: rgba(255, 255, 255, 0.6);\n        border-radius: 50%;\n        transform: scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 1;\n      `,!document.getElementById("ripple-styles")){const t=document.createElement("style");t.id="ripple-styles",t.textContent="\n          @keyframes ripple {\n            to {\n              transform: scale(4);\n              opacity: 0;\n            }\n          }\n        ",document.head.appendChild(t)}t.appendChild(n),setTimeout(()=>n.remove(),600)})}setupEventListeners(){this.container.addEventListener("click",t=>{const e=t.target.closest(".list-item");e&&this.handleItemClick(e,t)}),this.container.addEventListener("mouseover",t=>{const e=t.target.closest(".list-item");e&&this.handleItemHover(e)}),this.container.addEventListener("mouseout",t=>{const e=t.target.closest(".list-item");e&&this.handleItemLeave(e)})}handleItemClick(t,e){const n=t.id,i=this.itemsMap.get(n),o=Array.from(this.itemElements.values()).indexOf(t);this.config.selectable&&this.toggleSelection(n),this.callbacks.onItemClick&&this.callbacks.onItemClick(i,o,e)}handleItemHover(t){const e=t.id;if(this.applyState(e,"hover"),this.callbacks.onItemHover){const t=this.itemsMap.get(e);this.callbacks.onItemHover(t)}}handleItemLeave(t){const e=t.id;if("hover"===this.itemStates.get(e)){const t=this.selectedItems.has(e);this.applyState(e,t?"selected":"default")}if(this.callbacks.onItemLeave){const t=this.itemsMap.get(e);this.callbacks.onItemLeave(t)}}applyState(t,e){const n=this.itemElements.get(t);if(!n)return;const i=this.config.states[e]||{};if("default"===e){const e=this.itemsMap.get(t);this.applyItemStyles(n,e)}else Object.assign(n.style,i);this.itemStates.set(t,e)}toggleSelection(t){const e=this.selectedItems.has(t);if(this.config.multiSelect||e||this.selectedItems.forEach(t=>{this.selectedItems.delete(t),this.applyState(t,"default")}),e?(this.selectedItems.delete(t),this.applyState(t,"default")):(this.selectedItems.add(t),this.applyState(t,"selected")),this.callbacks.onItemSelect){const n=this.itemsMap.get(t);this.callbacks.onItemSelect(n,!e)}}addItem(t){const e=this.config.items.length;this.config.items.push(t);const n=this.createItem(t,e);return this.container.appendChild(n),t.id||`item-${e}`}removeItem(t){const e=this.itemElements.get(t);e&&(e.remove(),this.itemElements.delete(t),this.itemsMap.delete(t),this.itemStates.delete(t),this.selectedItems.delete(t))}getSelectedItems(){return Array.from(this.selectedItems).map(t=>this.itemsMap.get(t))}clearSelection(){this.selectedItems.forEach(t=>{this.applyState(t,"default")}),this.selectedItems.clear()}updateSpacing(t){this.config.spacing={...this.config.spacing,...t},this.itemElements.forEach((t,e)=>{const n=this.itemsMap.get(e);this.applyItemStyles(t,n)})}updateTextStyle(t){this.config.itemStyle={...this.config.itemStyle,...t},this.itemElements.forEach((t,e)=>{const n=this.itemsMap.get(e);this.applyItemStyles(t,n)})}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.itemsMap.clear(),this.itemElements.clear(),this.itemStates.clear(),this.selectedItems.clear(),this.isInitialized=!1}}function S(t={}){const e=new v(t);return e.init(),e.container}class k{constructor(t={}){this.config={id:t.id||`matrix-${Date.now()}`,grid:{x:4,y:4,...t.grid},size:{width:400,height:400,...t.size},position:{x:0,y:0,...t.position},spacing:{horizontal:8,vertical:8,external:16,...t.spacing},attach:t.attach||"body",cells:t.cells||{},states:t.states||{},containerStyle:t.containerStyle||{},debug:t.debug||!1,responsive:!1!==t.responsive,autoResize:!1!==t.autoResize,maintainAspectRatio:t.maintainAspectRatio||!1},this.cellsMap=new Map,this.cellStates=new Map,this.cellElements=new Map,this.selectedCells=new Set,this.callbacks={onCellClick:t.onCellClick||null,onCellDoubleClick:t.onCellDoubleClick||null,onCellLongClick:t.onCellLongClick||null,onCellHover:t.onCellHover||null,onCellLeave:t.onCellLeave||null,onCellStateChange:t.onCellStateChange||null,onSelectionChange:t.onSelectionChange||null,onResize:t.onResize||null},this.container=null,this.longClickTimer=null,this.resizeObserver=null,this.isInitialized=!1,this.init()}init(){try{this.createContainer(),this.createCells(),this.setupEventListeners(),this.setupResizeObserver(),this.applyInitialStates(),this.isInitialized=!0,this.config.debug}catch(t){console.error(`❌ Erreur lors de l'initialisation de Matrix "${this.config.id}":`,t)}}createContainer(){const t="string"==typeof this.config.attach?document.querySelector(this.config.attach):this.config.attach;if(!t)throw new Error(`Point d'attachement "${this.config.attach}" non trouvé`);this.container=document.createElement("div"),this.container.id=this.config.id,this.container.className="matrix-container",this.applyContainerStyles(),t.appendChild(this.container)}applyContainerStyles(){const t={position:"absolute",left:`${this.config.position.x}px`,top:`${this.config.position.y}px`,display:"grid",gridTemplateColumns:`repeat(${this.config.grid.x}, 1fr)`,gridTemplateRows:`repeat(${this.config.grid.y}, 1fr)`,gap:`${this.config.spacing.vertical}px ${this.config.spacing.horizontal}px`,background:"#f8f9fa",borderRadius:"12px",border:"1px solid #dee2e6",fontFamily:"system-ui, -apple-system, sans-serif",userSelect:"none",boxSizing:"border-box"};this.config.autoResize?Object.assign(t,{position:"relative",left:"auto",top:"auto",width:"100%",height:"100%",padding:`${this.config.spacing.external}px`}):Object.assign(t,{width:`${this.config.size.width}px`,height:`${this.config.size.height}px`,padding:`${this.config.spacing.external}px`});const e={...t,...this.config.containerStyle};Object.assign(this.container.style,e)}createCells(){for(let t=0;t<this.config.grid.y;t++)for(let e=0;e<this.config.grid.x;e++)this.createCell(e,t)}createCell(t,e){const n=`${t},${e}`,i=this.config.cells[n]||{},o=this.config.cells.default||{},s=i.id||`${this.config.id}-cell-${t}-${e}`,r=document.createElement("div");r.id=s,r.className="matrix-cell",r.tabIndex=0,r.setAttribute("data-x",t),r.setAttribute("data-y",e),r.setAttribute("data-cell-id",s),r.setAttribute("role","button"),r.setAttribute("aria-label",`Cellule ${t}, ${e}`);const a=i.content||o.content||"";r.textContent=a;const l={display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",minHeight:"40px",transition:"all 0.2s ease",userSelect:"none",...o.style,...i.style};Object.assign(r.style,l),this.cellsMap.set(n,{id:s,x:t,y:e,content:a,element:r,config:i}),this.cellElements.set(n,r);const c=new Set(["normal"]);i.states&&i.states.forEach(t=>c.add(t)),this.cellStates.set(n,c),this.config.debug&&r.setAttribute("title",`Cellule (${t}, ${e}) - ID: ${s}`),this.container.appendChild(r)}applyInitialStates(){this.cellStates.forEach((t,e)=>{t.forEach(t=>{if("normal"!==t&&this.config.states[t]){const[n,i]=e.split(",").map(Number);this.applyCellStateStyle(n,i,t)}})})}setupEventListeners(){this.container.addEventListener("click",this.handleCellClick.bind(this)),this.container.addEventListener("dblclick",this.handleCellDoubleClick.bind(this)),this.container.addEventListener("mousedown",this.handleCellMouseDown.bind(this)),this.container.addEventListener("mouseup",this.handleCellMouseUp.bind(this)),this.container.addEventListener("mouseenter",this.handleCellHover.bind(this),!0),this.container.addEventListener("mouseleave",this.handleCellLeave.bind(this),!0),this.container.addEventListener("keydown",this.handleCellKeyDown.bind(this))}handleCellClick(t){const e=this.getCellFromEvent(t);if(!e)return;const{x:n,y:i,id:o,element:s}=e;this.callbacks.onCellClick&&this.callbacks.onCellClick(s,n,i,o,t)}handleCellDoubleClick(t){const e=this.getCellFromEvent(t);if(!e)return;const{x:n,y:i,id:o,element:s}=e;this.callbacks.onCellDoubleClick&&this.callbacks.onCellDoubleClick(s,n,i,o,t)}handleCellMouseDown(t){const e=this.getCellFromEvent(t);if(!e)return;const{x:n,y:i,id:o,element:s}=e;this.longClickTimer=setTimeout(()=>{this.callbacks.onCellLongClick&&this.callbacks.onCellLongClick(s,n,i,o,t)},500)}handleCellMouseUp(t){this.longClickTimer&&(clearTimeout(this.longClickTimer),this.longClickTimer=null)}handleCellHover(t){const e=this.getCellFromEvent(t);if(!e||!t.target.classList.contains("matrix-cell"))return;const{x:n,y:i,id:o,element:s}=e;this.config.states.hover&&this.applyStylesToElement(s,this.config.states.hover,!0),this.callbacks.onCellHover&&this.callbacks.onCellHover(s,n,i,o,t)}handleCellLeave(t){const e=this.getCellFromEvent(t);if(!e||!t.target.classList.contains("matrix-cell"))return;const{x:n,y:i,id:o,element:s}=e;this.reapplyCellStyles(n,i),this.callbacks.onCellLeave&&this.callbacks.onCellLeave(s,n,i,o,t)}handleCellKeyDown(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.handleCellClick(t))}getCellFromEvent(t){const e=t.target.closest(".matrix-cell");if(!e)return null;const n=parseInt(e.getAttribute("data-x")),i=parseInt(e.getAttribute("data-y")),o=`${n},${i}`;return{x:n,y:i,id:e.getAttribute("data-cell-id"),element:e,cellData:this.cellsMap.get(o)}}getCellState(t,e){const n=`${t},${e}`,i=this.cellStates.get(n);if(!i||0===i.size)return null;return Array.from(i).find(t=>"normal"!==t)||"normal"}getCellStates(t,e){const n=`${t},${e}`,i=this.cellStates.get(n);return i?Array.from(i):[]}hasCellState(t,e,n){const i=`${t},${e}`,o=this.cellStates.get(i);return!!o&&o.has(n)}setCellState(t,e,n,i=!0){const o=`${t},${e}`,s=this.cellStates.get(o)||new Set,r=this.cellsMap.get(o);if(!r)return;const a=s.has(n);i&&!a?(s.add(n),this.applyCellStateStyle(t,e,n)):!i&&a&&(s.delete(n),this.removeCellStateStyle(t,e,n)),this.cellStates.set(o,s),"selected"===n&&(i?this.selectedCells.add(o):this.selectedCells.delete(o),this.triggerSelectionChange()),this.callbacks.onCellStateChange&&a!==i&&this.callbacks.onCellStateChange(r.element,t,e,n,i)}addCellState(t,e,n){this.setCellState(t,e,n,!0)}removeCellState(t,e,n){this.setCellState(t,e,n,!1)}toggleCellState(t,e,n){const i=this.hasCellState(t,e,n);return this.setCellState(t,e,n,!i),!i}clearCellStates(t,e){const n=`${t},${e}`;this.cellsMap.get(n)&&(this.resetCellStyle(t,e),this.cellStates.set(n,new Set(["normal"])),this.selectedCells.delete(n),this.triggerSelectionChange())}applyCellStateStyle(t,e,n){const i=`${t},${e}`,o=this.cellsMap.get(i),s=this.config.states[n];o&&s&&this.applyStylesToElement(o.element,s,!0)}removeCellStateStyle(t,e,n){const i=`${t},${e}`,o=this.cellsMap.get(i);if(!o)return;const s=this.config.states[n];s&&Object.keys(s).forEach(t=>{const e=t.replace(/([A-Z])/g,"-$1").toLowerCase();o.element.style.removeProperty(e)}),this.reapplyCellStyles(t,e)}reapplyCellStyles(t,e){const n=`${t},${e}`,i=this.cellsMap.get(n),o=this.cellStates.get(n);i&&o&&(this.resetCellStyle(t,e),o.forEach(t=>{"normal"!==t&&this.config.states[t]&&this.applyStylesToElement(i.element,this.config.states[t],!0)}))}resize(t,e){void 0!==t&&void 0!==e&&(this.config.size.width=t,this.config.size.height=e,this.config.autoResize||(this.container.style.width=`${t}px`,this.container.style.height=`${e}px`)),this.updateCellSizes(),this.config.debug}setAutoResize(t){const e=this.config.autoResize;this.config.autoResize=t,t&&!e?(this.applyContainerStyles(),this.setupResizeObserver()):!t&&e&&(this.disconnectResizeObserver(),this.applyContainerStyles())}disconnectResizeObserver(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}fitToParent(t){const e="string"==typeof t?document.querySelector(t):t;if(!e)return void console.error("❌ Élément parent non trouvé");e.appendChild(this.container),this.setAutoResize(!0);const n=e.getBoundingClientRect();this.handleResize({contentRect:n})}autoSizeCells(t={}){const{minWidth:e=40,minHeight:n=40,padding:i=8,fontSize:o=null}=t;this.cellsMap.forEach((t,s)=>{const r=t.element,a=r.textContent||"";if(a.length>0){const t=document.createElement("div");t.style.cssText=`\n          position: absolute;\n          top: -9999px;\n          left: -9999px;\n          visibility: hidden;\n          white-space: nowrap;\n          font-family: ${r.style.fontFamily||"inherit"};\n          font-size: ${o||r.style.fontSize||"14px"};\n          font-weight: ${r.style.fontWeight||"inherit"};\n        `,t.textContent=a,document.body.appendChild(t);const s=t.offsetWidth,l=t.offsetHeight;document.body.removeChild(t);const c=Math.max(s+2*i,e),d=Math.max(l+2*i,n);r.style.width=`${c}px`,r.style.height=`${d}px`}}),this.config.debug}fitToContent(t={}){this.autoSizeCells(t);let e=0,n=0;this.cellsMap.forEach(t=>{const i=t.element.getBoundingClientRect();e=Math.max(e,i.width),n=Math.max(n,i.height)});const i=e*this.config.grid.x+this.config.spacing.horizontal*(this.config.grid.x-1)+2*this.config.spacing.external,o=n*this.config.grid.y+this.config.spacing.vertical*(this.config.grid.y-1)+2*this.config.spacing.external;this.resize(i,o)}setupResizeObserver(){if(!this.config.autoResize||!window.ResizeObserver)return;this.resizeObserver=new ResizeObserver(t=>{for(let e of t)this.handleResize(e)});const t=this.container.parentElement;t&&this.resizeObserver.observe(t)}handleResize(t){if(!this.config.autoResize)return;const{width:e,height:n}=t.contentRect;this.config.debug,this.config.size.width=e,this.config.size.height=n,this.updateCellSizes(),this.callbacks.onResize&&this.callbacks.onResize(e,n)}updateCellSizes(){if(!this.config.autoResize)return;const t=this.container.getBoundingClientRect(),e=t.width-2*this.config.spacing.external,n=t.height-2*this.config.spacing.external,i=(e-this.config.spacing.horizontal*(this.config.grid.x-1))/this.config.grid.x,o=(n-this.config.spacing.vertical*(this.config.grid.y-1))/this.config.grid.y;if(this.config.maintainAspectRatio){const t=Math.min(i,o);this.cellsMap.forEach(e=>{e.element.style.width=`${t}px`,e.element.style.height=`${t}px`})}this.config.debug}applyStylesToElement(t,e,n=!1){Object.entries(e).forEach(([e,i])=>{if("string"==typeof i||"number"==typeof i){const o=e.replace(/([A-Z])/g,"-$1").toLowerCase();t.style.setProperty(o,String(i),n?"important":"")}})}camelToKebab(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}getCellsByState(t){const e=[];return this.cellStates.forEach((n,i)=>{if(n.has(t)){const[t,n]=i.split(",").map(Number),o=this.cellsMap.get(i);e.push({x:t,y:n,id:o.id,element:o.element})}}),e}getCellsWithAnyState(t){const e=[];return this.cellStates.forEach((n,i)=>{if(t.some(t=>n.has(t))){const[t,o]=i.split(",").map(Number),s=this.cellsMap.get(i);e.push({x:t,y:o,id:s.id,element:s.element,states:Array.from(n)})}}),e}getCellsWithAllStates(t){const e=[];return this.cellStates.forEach((n,i)=>{if(t.every(t=>n.has(t))){const[t,o]=i.split(",").map(Number),s=this.cellsMap.get(i);e.push({x:t,y:o,id:s.id,element:s.element,states:Array.from(n)})}}),e}getStateCount(t){let e=0;return this.cellStates.forEach(n=>{n.has(t)&&e++}),e}getAllStates(){const t=new Set;return this.cellStates.forEach(e=>{e.forEach(e=>t.add(e))}),Array.from(t)}getStateDistribution(){const t={};return this.cellStates.forEach(e=>{e.forEach(e=>{t[e]=(t[e]||0)+1})}),t}findCells(t){const e=[];return this.cellsMap.forEach((n,i)=>{const[o,s]=i.split(",").map(Number);let r=!0;if(t.state&&!this.hasCellState(o,s,t.state)&&(r=!1),void 0!==t.hasContent){const e=n.content&&n.content.trim().length>0;t.hasContent!==e&&(r=!1)}t.position&&(t.position.x&&(void 0!==t.position.x.min&&o<t.position.x.min&&(r=!1),void 0!==t.position.x.max&&o>t.position.x.max&&(r=!1)),t.position.y&&(void 0!==t.position.y.min&&s<t.position.y.min&&(r=!1),void 0!==t.position.y.max&&s>t.position.y.max&&(r=!1))),r&&e.push({x:o,y:s,id:n.id,element:n.element,content:n.content,states:this.getCellStates(o,s)})}),e}getCellsInRange(t,e,n,i){const o=[],s=Math.min(t,n),r=Math.max(t,n),a=Math.min(e,i),l=Math.max(e,i);for(let t=a;t<=l;t++)for(let e=s;e<=r;e++){const n=`${e},${t}`,i=this.cellsMap.get(n);i&&o.push({x:e,y:t,id:i.id,element:i.element})}return o}getCellsInRow(t){const e=[];for(let n=0;n<this.config.grid.x;n++){const i=`${n},${t}`,o=this.cellsMap.get(i);o&&e.push({x:n,y:t,id:o.id,element:o.element})}return e}getCellsInColumn(t){const e=[];for(let n=0;n<this.config.grid.y;n++){const i=`${t},${n}`,o=this.cellsMap.get(i);o&&e.push({x:t,y:n,id:o.id,element:o.element})}return e}compareCellStates(t,e,n,i){const o=new Set(this.getCellStates(t,e)),s=new Set(this.getCellStates(n,i));return{same:[...o].every(t=>s.has(t))&&[...s].every(t=>o.has(t)),common:[...o].filter(t=>s.has(t)),different1:[...o].filter(t=>!s.has(t)),different2:[...s].filter(t=>!o.has(t))}}findSimilarCells(t,e){const n=new Set(this.getCellStates(t,e)),i=[];return this.cellStates.forEach((o,s)=>{const[r,a]=s.split(",").map(Number);if(r===t&&a===e)return;if(o.size===n.size&&[...o].every(t=>n.has(t))){const t=this.cellsMap.get(s);i.push({x:r,y:a,id:t.id,element:t.element})}}),i}groupCellsByState(){const t={};return this.cellStates.forEach((e,n)=>{const[i,o]=n.split(",").map(Number),s=this.cellsMap.get(n);e.forEach(e=>{t[e]||(t[e]=[]),t[e].push({x:i,y:o,id:s.id,element:s.element})})}),t}getCellId(t,e){const n=`${t},${e}`,i=this.cellsMap.get(n);return i?i.id:null}getCellContent(t,e){const n=`${t},${e}`,i=this.cellsMap.get(n);return i?i.content:null}setCellContent(t,e,n){const i=`${t},${e}`,o=this.cellsMap.get(i);o&&(o.content=n,o.element.textContent=n)}getCellStyle(t,e){const n=`${t},${e}`,i=this.cellsMap.get(n);return i?i.element.style:null}setCellStyle(t,e,n){const i=`${t},${e}`,o=this.cellsMap.get(i);o&&Object.assign(o.element.style,n)}resetCellStyle(t,e){const n=`${t},${e}`,i=this.cellsMap.get(n);if(i){const t=i.config,e={...{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#ffffff",border:"1px solid #dee2e6",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",minHeight:"40px",transition:"all 0.2s ease",userSelect:"none"},...(this.config.cells.default||{}).style,...t.style};i.element.removeAttribute("style"),this.applyStylesToElement(i.element,e,!1)}}getSelectedCells(){const t=[];return this.selectedCells.forEach(e=>{const[n,i]=e.split(",").map(Number),o=this.cellsMap.get(e);t.push({x:n,y:i,id:o.id,element:o.element})}),t}clearSelection(){Array.from(this.selectedCells).forEach(t=>{const[e,n]=t.split(",").map(Number);this.removeCellState(e,n,"selected")})}triggerSelectionChange(){this.callbacks.onSelectionChange&&this.callbacks.onSelectionChange(this.getSelectedCells())}getTotalCells(){return this.config.grid.x*this.config.grid.y}getCell(t,e){const n=`${t},${e}`,i=this.cellsMap.get(n);return i?i.element:null}getCellData(t,e){const n=`${t},${e}`;return this.cellsMap.get(n)}destroy(){try{this.longClickTimer&&(clearTimeout(this.longClickTimer),this.longClickTimer=null),this.disconnectResizeObserver(),this.container&&(this.container.removeEventListener("click",this.handleCellClick),this.container.removeEventListener("dblclick",this.handleCellDoubleClick),this.container.removeEventListener("mousedown",this.handleCellMouseDown),this.container.removeEventListener("mouseup",this.handleCellMouseUp),this.container.removeEventListener("mouseenter",this.handleCellHover),this.container.removeEventListener("mouseleave",this.handleCellLeave),this.container.removeEventListener("keydown",this.handleCellKeyDown),this.container.parentNode&&this.container.parentNode.removeChild(this.container)),this.cellsMap.clear(),this.cellStates.clear(),this.cellElements.clear(),this.selectedCells.clear(),this.callbacks={}}catch(t){console.error(`❌ Erreur lors de la destruction de Matrix "${this.config.id}":`,t)}}}function E(t){return new k(t)}function $(t={}){const e={id:t.id||`menu-${Date.now()}`,position:{x:0,y:0,...t.position},size:{width:"auto",height:"auto",...t.size},attach:t.attach||"body",layout:{direction:"horizontal",wrap:!1,justify:"flex-start",align:"center",gap:"8px",...t.layout},content:t.content||[],style:{display:"flex",position:"relative",backgroundColor:"#ffffff",border:"1px solid #e0e0e0",borderRadius:"8px",padding:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",fontFamily:"system-ui, -apple-system, sans-serif",...t.style},responsive:{enabled:t.responsive?.enabled??!0,breakpoints:{mobile:{maxWidth:"768px",...t.responsive?.breakpoints?.mobile},tablet:{maxWidth:"1024px",...t.responsive?.breakpoints?.tablet},...t.responsive?.breakpoints},...t.responsive},callbacks:{onItemClick:t.callbacks?.onItemClick||t.onItemClick||null,onItemHover:t.callbacks?.onItemHover||t.onItemHover||null,onDropdownOpen:t.callbacks?.onDropdownOpen||t.onDropdownOpen||null,onDropdownClose:t.callbacks?.onDropdownClose||t.onDropdownClose||null,...t.callbacks},debug:t.debug||!1};function n(t,e){switch(t.type){case"item":return i(t,e);case"group":return function(t,e){const i=document.createElement("div");i.id=t.id||`menu-group-${e}`,i.className="menu-group";const o={display:"flex",alignItems:"center",gap:t.layout?.gap||"8px",...t.style};"vertical"===t.layout?.direction&&(o.flexDirection="column");Object.assign(i.style,o),t.items&&t.items.forEach((t,e)=>{const o=n(t,e);o&&i.appendChild(o)});return i}(t,e);case"separator":return function(t,e){const n=document.createElement("div");n.id=t.id||`menu-separator-${e}`,n.className="menu-separator";const i={borderTop:"1px solid #e0e0e0",margin:"4px 0",...t.style};return Object.assign(n.style,i),n}(t,e);default:return i({...t},e)}}function i(t,i){const s=document.createElement(t.href?"a":"div");s.id=t.id||`menu-item-${i}`,s.className="menu-item",s.setAttribute("data-menu-id",t.id||`menu-item-${i}`),t.content&&(t.content.text?s.textContent=t.content.text:t.content.html&&(s.innerHTML=t.content.html)),t.href&&"A"===s.tagName&&(s.href=t.href);const r={display:"flex",alignItems:"center",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",transition:"all 0.3s ease",textDecoration:"none",color:"#333333",fontSize:"14px",fontWeight:"400",userSelect:"none",...t.style};return Object.assign(s.style,r),function(t,n){t.addEventListener("click",i=>{i.preventDefault();const s=document.getElementById(`${t.id}-dropdown`);s&&o(s),e.callbacks.onItemClick&&e.callbacks.onItemClick(n.id||t.id,i)}),t.addEventListener("mouseenter",i=>{!function(t,e){e.states?.hover?Object.assign(t.style,e.states.hover):(t.style.backgroundColor="#f8f9fa",t.style.transform="translateY(-1px)")}(t,n),e.callbacks.onItemHover&&e.callbacks.onItemHover(n.id||t.id,i)}),t.addEventListener("mouseleave",e=>{!function(t,e){e.states?.hover?Object.keys(e.states.hover).forEach(e=>{t.style[e]=""}):(t.style.backgroundColor="",t.style.transform="");e.style&&Object.assign(t.style,e.style)}(t,n)})}(s,t),t.dropdown&&function(t,e){const i=document.createElement("div");i.id=`${t.id}-dropdown`,i.className="menu-dropdown";const o={position:"absolute",top:"100%",left:"0",minWidth:"200px",backgroundColor:"#ffffff",border:"1px solid #e0e0e0",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"4px",zIndex:"1000",opacity:"0",visibility:"hidden",transform:"translateY(-10px)",transition:"all 0.3s ease",...e.style};Object.assign(i.style,o),e.items&&e.items.forEach((t,e)=>{const o=n(t,e);o&&i.appendChild(o)});document.body.appendChild(i),function(t,e,n){const i=()=>{const i=t.getBoundingClientRect(),o=n.offset||{x:0,y:4};e.style.position="fixed",e.style.left=`${i.left+o.x}px`,e.style.top=`${i.bottom+o.y}px`};i(),window.addEventListener("scroll",i),window.addEventListener("resize",i)}(t,i,e)}(s,t.dropdown),s}function o(t){"1"===t.style.opacity?(t.style.opacity="0",t.style.visibility="hidden",t.style.transform="translateY(-10px)"):(t.style.opacity="1",t.style.visibility="visible",t.style.transform="translateY(0)")}function s(t,n){const i=e.responsive.breakpoints[n];if(i)if(i.style&&Object.assign(t.style,i.style),i.showHamburger){const e=t.querySelector("#hamburger-icon"),n=t.querySelector("#nav-links");e&&(e.style.display="flex"),n&&(n.style.display="none")}else{const e=t.querySelector("#hamburger-icon"),n=t.querySelector("#nav-links");e&&(e.style.display="none"),n&&(n.style.display="flex")}}const r=function(){const t=document.createElement("nav");t.id=e.id,t.className="professional-menu";const n=document.querySelector(e.attach);return n?(function(t){const n={};void 0===e.position.x&&void 0===e.position.y||(n.position="absolute",void 0!==e.position.x&&(n.left=`${e.position.x}px`),void 0!==e.position.y&&(n.top=`${e.position.y}px`));const i={};"auto"!==e.size.width&&(i.width="string"==typeof e.size.width?e.size.width:`${e.size.width}px`);"auto"!==e.size.height&&(i.height="string"==typeof e.size.height?e.size.height:`${e.size.height}px`);e.size.maxWidth&&(i.maxWidth="string"==typeof e.size.maxWidth?e.size.maxWidth:`${e.size.maxWidth}px`);e.size.minHeight&&(i.minHeight="string"==typeof e.size.minHeight?e.size.minHeight:`${e.size.minHeight}px`);const o={flexDirection:"vertical"===e.layout.direction?"column":"row",flexWrap:e.layout.wrap?"wrap":"nowrap",justifyContent:e.layout.justify,alignItems:e.layout.align,gap:e.layout.gap},s={...e.style,...n,...i,...o};Object.assign(t.style,s)}(t),n.appendChild(t),e.debug&&console.log(`📦 Container menu créé et attaché à "${e.attach}"`),t):(console.error(`❌ Point d'attachement "${e.attach}" introuvable`),null)}();return r?(function(t){e.content.forEach((e,i)=>{const o=n(e,i);o&&t.appendChild(o)})}(r),function(t){if(!e.responsive.enabled)return;const n=()=>{const n=window.innerWidth,i=e.responsive.breakpoints;i.mobile&&n<=i.mobile.maxWidth?s(t,"mobile"):i.tablet&&n<=i.tablet.maxWidth?s(t,"tablet"):s(t,"desktop")};window.addEventListener("resize",n),n()}(r),document.addEventListener("click",t=>{if(!r.contains(t.target)){document.querySelectorAll(".menu-dropdown").forEach(t=>{"1"===t.style.opacity&&o(t)})}}),e.debug&&console.log(`✅ Menu "${e.id}" créé avec succès`),r):null}function L(t={}){const e={content:t.content||"Minimal Component",style:t.style||{},onClick:t.onClick||null},n=document.createElement("div");n.className="hs-minimal",n.textContent=e.content;return Object.assign(n.style,{padding:"12px",margin:"8px",backgroundColor:"#f0f0f0",border:"1px solid #ccc",borderRadius:"4px",fontFamily:"system-ui, sans-serif"},e.style),e.onClick&&(n.addEventListener("click",e.onClick),n.style.cursor="pointer"),document.body.appendChild(n),n}p("table-container",{tag:"div",class:"hs-table",css:{position:"relative",display:"flex",flexDirection:"column",border:"1px solid #dee2e6",borderRadius:"6px",backgroundColor:"#ffffff",overflow:"hidden",fontFamily:"system-ui, sans-serif",fontSize:"14px"}}),p("table-header",{tag:"div",class:"hs-table-header",css:{display:"flex",flexShrink:0,borderBottom:"2px solid #dee2e6",backgroundColor:"#343a40"}}),p("table-header-cell",{tag:"div",class:"hs-table-header-cell",css:{padding:"12px",backgroundColor:"#343a40",color:"#ffffff",fontWeight:"600",fontSize:"14px",borderRight:"1px solid #495057",cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"space-between"}}),p("table-body",{tag:"div",class:"hs-table-body",css:{flex:1,overflowY:"auto",overflowX:"hidden"}}),p("table-row",{tag:"div",class:"hs-table-row",css:{display:"flex",borderBottom:"1px solid #dee2e6",backgroundColor:"#ffffff",transition:"all 0.2s ease"}}),p("table-cell",{tag:"div",class:"hs-table-cell",css:{padding:"8px 12px",borderRight:"1px solid #dee2e6",backgroundColor:"#ffffff",color:"#212529",fontSize:"13px",display:"flex",alignItems:"center"}});const M={default:{headerStyle:{backgroundColor:"#343a40",color:"#ffffff"},cellStyle:{backgroundColor:"#ffffff",color:"#212529"},alternateRowStyle:{backgroundColor:"#f8f9fa"}},modern:{headerStyle:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#ffffff"},cellStyle:{backgroundColor:"#ffffff",color:"#2c3e50"},alternateRowStyle:{backgroundColor:"#f8f9fa"}},minimal:{headerStyle:{backgroundColor:"#f8f9fa",color:"#495057",borderBottom:"2px solid #dee2e6"},cellStyle:{backgroundColor:"#ffffff",color:"#212529",border:"none",borderBottom:"1px solid #f1f3f4"},alternateRowStyle:{backgroundColor:"#fbfbfb"}}},z=(t={})=>{const{id:e,columns:n=[],rows:i=[],styling:o={},options:s={},skin:r={},onCellClick:a,onSort:l,onRowSelect:c,position:d,size:p,attach:u,variant:g="default",...f}=t,m=e||`table_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,b={rowHeight:40,...M[g]||M.default,...o},y={cellsMap:new Map,rowsMap:new Map,selectedRows:new Set,sortConfig:{column:null,direction:"asc"},columns:[...n],rows:[...i]};let x={width:p?.width?`${p.width}px`:"800px",height:p?.height?`${p.height}px`:"600px"};d&&(x={...x,position:"absolute",left:`${d.x}px`,top:`${d.y}px`}),r.container&&(x={...x,...r.container});const C=h("table-container",{id:m,css:x,...f}),w=h("table-header",{id:`${m}_header`,css:r.header||{}});y.columns.forEach((t,e)=>{const n=h("table-header-cell",{id:`${m}_header_${t.id}`,text:t.header||t.id,css:{width:t.width?`${t.width}px`:"auto",flex:t.width?"none":"1",...b.headerStyle,...t.style,...r.headerCell||{}},onclick:()=>{!1!==s.sortable&&!1!==t.sortable&&k(t.id)}});if(!1!==s.sortable&&!1!==t.sortable){const t=document.createElement("span");t.style.marginLeft="8px",t.style.opacity="0.5",t.textContent="⇅",n.appendChild(t)}w.appendChild(n)});const v=h("table-body",{id:`${m}_body`,css:r.body||{}}),S=(t,e)=>{const n=h("table-row",{id:`${m}_row_${t.id||e}`,css:{height:`${b.rowHeight}px`,...e%2==1?b.alternateRowStyle:{},...r.row||{}}});return!1!==s.selectable&&(n.style.cursor="pointer",n.addEventListener("mouseenter",()=>{y.selectedRows.has(t.id)||Object.assign(n.style,b.states?.hover||{backgroundColor:"#e9ecef"})}),n.addEventListener("mouseleave",()=>{y.selectedRows.has(t.id)||Object.assign(n.style,e%2==1?b.alternateRowStyle:{backgroundColor:"#ffffff"})}),n.addEventListener("click",()=>{E(t.id,n)})),y.columns.forEach((i,o)=>{const s=t.cells?.[i.id]||{content:"",style:{}},l=h("table-cell",{id:`${m}_cell_${t.id}_${i.id}`,text:s.content||"",css:{width:i.width?`${i.width}px`:"auto",flex:i.width?"none":"1",...b.cellStyle,...i.style,...s.style,...r.cell||{}},onclick:t=>{t.stopPropagation(),a&&a(s,e,o)}});y.cellsMap.set(`${t.id}_${i.id}`,{element:l,data:s,rowId:t.id,columnId:i.id}),n.appendChild(l)}),y.rowsMap.set(t.id,{element:n,data:t,index:e}),n},k=t=>{const e="asc"===(y.sortConfig.column===t?y.sortConfig.direction:"asc")?"desc":"asc";y.sortConfig={column:t,direction:e},y.rows.sort((n,i)=>{const o=n.cells?.[t]?.content||"",s=i.cells?.[t]?.content||"",r=String(o).localeCompare(String(s),void 0,{numeric:!0});return"asc"===e?r:-r}),C.refresh(),l&&l(t,e),w.querySelectorAll(".hs-table-header-cell span").forEach(t=>{t.textContent="⇅",t.style.opacity="0.5"});const n=w.querySelector(`#${m}_header_${t} span`);n&&(n.textContent="asc"===e?"↑":"↓",n.style.opacity="1")},E=(t,e)=>{s.multiSelect?y.selectedRows.has(t)?(y.selectedRows.delete(t),Object.assign(e.style,{backgroundColor:"#ffffff"})):(y.selectedRows.add(t),Object.assign(e.style,b.states?.selected||{backgroundColor:"#007bff",color:"#ffffff"})):(y.selectedRows.forEach(t=>{const e=y.rowsMap.get(t);e&&Object.assign(e.element.style,{backgroundColor:"#ffffff"})}),y.selectedRows.clear(),y.selectedRows.add(t),Object.assign(e.style,b.states?.selected||{backgroundColor:"#007bff",color:"#ffffff"})),c&&c(t,Array.from(y.selectedRows))};if(C.refresh=()=>{v.innerHTML="",y.rows.forEach((t,e)=>{const n=S(t,e);v.appendChild(n)})},C.addRow=t=>{y.rows.push(t);const e=S(t,y.rows.length-1);return v.appendChild(e),C},C.removeRow=t=>{const e=y.rows.findIndex(e=>e.id===t);return-1!==e&&(y.rows.splice(e,1),y.rowsMap.delete(t),y.selectedRows.delete(t),C.refresh()),C},C.updateCell=(t,e,n)=>{const i=`${t}_${e}`,o=y.cellsMap.get(i);return o&&(o.data={...o.data,...n},o.element.textContent=n.content||"",n.style&&Object.assign(o.element.style,n.style)),C},C.getSelectedRows=()=>Array.from(y.selectedRows),C.clearSelection=()=>(y.selectedRows.forEach(t=>{const e=y.rowsMap.get(t);e&&Object.assign(e.element.style,{backgroundColor:"#ffffff"})}),y.selectedRows.clear(),C),C.sort=(t,e="asc")=>(y.sortConfig={column:t,direction:e},k(t),C),C.getData=()=>({columns:y.columns,rows:y.rows,selected:Array.from(y.selectedRows)}),C.appendChild(w),C.appendChild(v),C.refresh(),u){const t="string"==typeof u?document.querySelector(u):u;t&&t.appendChild(C)}return C};function I(t={}){const e={id:t.id||`template-${Date.now()}`,position:{x:0,y:0,...t.position},size:{width:"auto",height:"auto",...t.size},attach:t.attach||"body",content:t.content||"Template Component",style:{display:"block",position:"relative",backgroundColor:"#f5f5f5",border:"2px solid #ddd",borderRadius:"8px",padding:"16px",margin:"8px",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",color:"#333",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"all 0.3s ease",...t.style},behavior:{clickable:t.behavior?.clickable??!0,hoverable:t.behavior?.hoverable??!0,draggable:t.behavior?.draggable??!1,...t.behavior},onClick:t.onClick||null,onHover:t.onHover||null,onMount:t.onMount||null,onDestroy:t.onDestroy||null,debug:t.debug||!1};const n=function(){let t;"string"==typeof e.attach?(t=document.querySelector(e.attach),t||"body"!==e.attach||(t=document.body)):t=e.attach,t||(console.warn(`⚠️ Point d'attachement "${e.attach}" non trouvé, utilisation de body`),t=document.body);const n=document.createElement("div");return n.id=e.id,n.className="hs-template","string"==typeof e.content?n.textContent=e.content:e.content instanceof HTMLElement?n.appendChild(e.content):Array.isArray(e.content)&&e.content.forEach(t=>{if("string"==typeof t){const e=document.createTextNode(t);n.appendChild(e)}else t instanceof HTMLElement&&n.appendChild(t)}),function(t){const n={};void 0===e.position.x&&void 0===e.position.y||(n.position="absolute",void 0!==e.position.x&&(n.left=`${e.position.x}px`),void 0!==e.position.y&&(n.top=`${e.position.y}px`));const i={};"auto"!==e.size.width&&(i.width="number"==typeof e.size.width?`${e.size.width}px`:e.size.width);"auto"!==e.size.height&&(i.height="number"==typeof e.size.height?`${e.size.height}px`:e.size.height);const o={...e.style,...n,...i};Object.assign(t.style,o)}(n),t.appendChild(n),e.debug&&console.log(`📦 Template component créé et attaché à "${e.attach}"`),n}();return function(t){e.behavior.clickable&&e.onClick&&(t.addEventListener("click",n=>{e.onClick(t,n)}),t.style.cursor="pointer"),e.behavior.hoverable&&(t.addEventListener("mouseenter",n=>{t.style.transform="translateY(-2px)",t.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)",e.onHover&&e.onHover(t,n,"enter")}),t.addEventListener("mouseleave",n=>{t.style.transform="translateY(0)",t.style.boxShadow=e.style.boxShadow||"0 2px 4px rgba(0,0,0,0.1)",e.onHover&&e.onHover(t,n,"leave")})),e.behavior.draggable&&(t.draggable=!0,t.addEventListener("dragstart",e=>{e.dataTransfer.setData("text/plain",t.id),t.style.opacity="0.7"}),t.addEventListener("dragend",()=>{t.style.opacity="1"}))}(n),e.onMount&&e.onMount(n),n.updateContent=function(t){return"string"==typeof t?this.textContent=t:t instanceof HTMLElement&&(this.innerHTML="",this.appendChild(t)),this},n.updateStyle=function(t){return Object.assign(this.style,t),this},n.destroy=function(){e.onDestroy&&e.onDestroy(this),this.parentNode&&this.parentNode.removeChild(this)},n.getConfig=function(){return{...e}},n}p("tooltip-container",{tag:"div",class:"hs-tooltip",css:{position:"absolute",backgroundColor:"#333",color:"white",padding:"8px 12px",borderRadius:"4px",fontSize:"14px",zIndex:"9999",pointerEvents:"none",opacity:"0",transition:"opacity 0.2s ease"}});const D=(t={})=>{const{text:e="Tooltip",target:n,position:i="top",css:o={},...s}=t,r=h("tooltip-container",{text:e,css:{...o},...s});return n&&(n.addEventListener("mouseenter",()=>{r.style.opacity="1",document.body.appendChild(r);const t=n.getBoundingClientRect();r.style.left=t.left+t.width/2-r.offsetWidth/2+"px",r.style.top=t.top-r.offsetHeight-8+"px"}),n.addEventListener("mouseleave",()=>{r.style.opacity="0",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},200)})),r};const R=new class{constructor(){this.units=new Map,this.connections=new Map,this.selectedUnits=new Set,this.dragState=null,this.connectionMode=!1,this.firstConnector=null,this.nextUnitId=1,this.nextConnectorId=1,this.nextConnectionId=1,this.connectorDragState={isDragging:!1,sourceConnector:null,dragLine:null},this.setupGlobalListeners()}setupGlobalListeners(){document.addEventListener("click",t=>{t.target.closest(".unit-container")||t.target.closest(".unit-connector")||this.deselectAll()})}generateUnitId(){return"unit_"+this.nextUnitId++}generateConnectorId(){return"connector_"+this.nextConnectorId++}generateConnectionId(){return"connection_"+this.nextConnectionId++}registerUnit(t){this.units.set(t.id,t)}unregisterUnit(t){this.removeAllConnectionsForUnit(t),this.units.delete(t),this.selectedUnits.delete(t)}removeAllConnectionsForUnit(t){const e=[];this.connections.forEach((n,i)=>{n.fromUnit!==t&&n.toUnit!==t||e.push(i)}),e.forEach(t=>this.removeConnection(t))}selectUnit(t){this.selectedUnits.add(t);const e=this.units.get(t);e&&e.element.classList.add("unit-selected")}deselectUnit(t){this.selectedUnits.delete(t);const e=this.units.get(t);e&&e.element.classList.remove("unit-selected")}deselectAll(){this.selectedUnits.forEach(t=>this.deselectUnit(t))}getSelectedUnits(){return Array.from(this.selectedUnits)}createConnection(t,e,n,i){const o=this.generateConnectionId(),s={id:o,fromUnit:t,fromConnector:e,toUnit:n,toConnector:i};return this.connections.set(o,s),this.renderConnection(s),o}removeConnection(t){if(this.connections.get(t)){const e=document.querySelector(`[data-connection-id="${t}"]`);e&&e.remove(),this.connections.delete(t)}}renderConnection(t){const e=this.units.get(t.fromUnit),n=this.units.get(t.toUnit);if(!e||!n)return;const i=e.element.querySelector(`[data-connector-id="${t.fromConnector}"]`),o=n.element.querySelector(`[data-connector-id="${t.toConnector}"]`);if(!i||!o)return;const s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("data-connection-id",t.id),s.classList.add("unit-connection-line"),this.updateConnectionPosition(s,i,o);let r=document.querySelector(".unit-connections-svg");r||(r=document.createElementNS("http://www.w3.org/2000/svg","svg"),r.classList.add("unit-connections-svg"),r.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 50;\n      ",document.body.appendChild(r)),r.appendChild(s)}updateConnectionPosition(t,e,n){const i=e.getBoundingClientRect(),o=n.getBoundingClientRect(),s=i.left+i.width/2,r=i.top+i.height/2,a=o.left+o.width/2,l=o.top+o.height/2;t.setAttribute("x1",s),t.setAttribute("y1",r),t.setAttribute("x2",a),t.setAttribute("y2",l),t.setAttribute("stroke","#666"),t.setAttribute("stroke-width","2")}updateAllConnections(){this.connections.forEach(t=>{const e=document.querySelector(`[data-connection-id="${t.id}"]`);if(e){const n=this.units.get(t.fromUnit),i=this.units.get(t.toUnit);if(n&&i){const o=n.element.querySelector(`[data-connector-id="${t.fromConnector}"]`),s=i.element.querySelector(`[data-connector-id="${t.toConnector}"]`);o&&s&&this.updateConnectionPosition(e,o,s)}}})}getAllConnections(){return Array.from(this.connections.values())}handleConnectorClick(t,e,n){if(this.firstConnector){const{unitId:i,connectorId:o,connectorType:s}=this.firstConnector;if((i!==t||o!==e)&&("input"===s&&"output"===n||"output"===s&&"input"===n)){let n,r,a,l;"output"===s?(n=i,r=o,a=t,l=e):(n=t,r=e,a=i,l=o);const c=Array.from(this.connections.values()).find(t=>t.fromUnit===n&&t.fromConnector===r&&t.toUnit===a&&t.toConnector===l);c?this.removeConnection(c.id):this.createConnection(n,r,a,l)}this.highlightConnector(i,o,!1),this.firstConnector=null}else this.firstConnector={unitId:t,connectorId:e,connectorType:n},this.highlightConnector(t,e,!0)}highlightConnector(t,e,n){const i=this.units.get(t);if(i){const t=i.element.querySelector(`[data-connector-id="${e}"]`);t&&(n?t.classList.add("connector-selected"):t.classList.remove("connector-selected"))}}startConnectorDrag(t,e,n,i){i.preventDefault(),i.stopPropagation(),this.connectorDragState.isDragging=!0,this.connectorDragState.sourceConnector={unitId:t,connectorId:e,connectorType:n},this.createDragLine(i),document.addEventListener("mousemove",this.handleConnectorDragMove.bind(this)),document.addEventListener("mouseup",this.handleConnectorDragEnd.bind(this))}createDragLine(t){let e=document.querySelector(".unit-connections-svg");e||(e=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.classList.add("unit-connections-svg"),e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 50;\n      ",document.body.appendChild(e));const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.classList.add("unit-drag-line"),n.setAttribute("stroke","#007bff"),n.setAttribute("stroke-width","2"),n.setAttribute("stroke-dasharray","5,5"),n.setAttribute("opacity","0.8");const i=this.getConnectorElement(this.connectorDragState.sourceConnector.unitId,this.connectorDragState.sourceConnector.connectorId);if(i){const e=i.getBoundingClientRect(),o=e.left+e.width/2,s=e.top+e.height/2;n.setAttribute("x1",o),n.setAttribute("y1",s),n.setAttribute("x2",t.clientX),n.setAttribute("y2",t.clientY)}e.appendChild(n),this.connectorDragState.dragLine=n}handleConnectorDragMove(t){if(!this.connectorDragState.isDragging||!this.connectorDragState.dragLine)return;this.connectorDragState.dragLine.setAttribute("x2",t.clientX),this.connectorDragState.dragLine.setAttribute("y2",t.clientY);const e=document.elementFromPoint(t.clientX,t.clientY);if(e&&e.classList.contains("unit-connector")){e.getAttribute("data-connector-id");const t=e.getAttribute("data-connector-type");e.closest(".unit-container").getAttribute("data-unit-id");const n=this.connectorDragState.sourceConnector.connectorType;("output"===n&&"input"===t||"input"===n&&"output"===t)&&e.classList.add("connector-drag-hover")}document.querySelectorAll(".connector-drag-hover").forEach(t=>{t.contains(e)||t.classList.remove("connector-drag-hover")})}handleConnectorDragEnd(t){if(!this.connectorDragState.isDragging)return;this.connectorDragState.dragLine&&this.connectorDragState.dragLine.remove();const e=document.elementFromPoint(t.clientX,t.clientY);if(e&&e.classList.contains("unit-connector")){const t=e.getAttribute("data-connector-id"),n=e.getAttribute("data-connector-type"),i=e.closest(".unit-container").getAttribute("data-unit-id"),o=this.connectorDragState.sourceConnector;if("output"===o.connectorType&&"input"===n||"input"===o.connectorType&&"output"===n){let e,n,s,r;"output"===o.connectorType?(e=o.unitId,n=o.connectorId,s=i,r=t):(e=i,n=t,s=o.unitId,r=o.connectorId);const a=Array.from(this.connections.values()).find(t=>t.fromUnit===e&&t.fromConnector===n&&t.toUnit===s&&t.toConnector===r);a?this.removeConnection(a.id):this.createConnection(e,n,s,r)}}document.querySelectorAll(".connector-drag-hover").forEach(t=>{t.classList.remove("connector-drag-hover")}),document.removeEventListener("mousemove",this.handleConnectorDragMove.bind(this)),document.removeEventListener("mouseup",this.handleConnectorDragEnd.bind(this)),this.connectorDragState.isDragging=!1,this.connectorDragState.sourceConnector=null,this.connectorDragState.dragLine=null}getConnectorElement(t,e){const n=this.units.get(t);return n?n.element.querySelector(`[data-connector-id="${e}"]`):null}};p("unit-container",{tag:"div",class:"unit-container",css:{position:"absolute",minWidth:"120px",minHeight:"80px",backgroundColor:"#f8f9fa",border:"2px solid #ddd",borderRadius:"8px",cursor:"move",userSelect:"none",overflow:"visible",zIndex:"100"}}),p("unit-header",{tag:"div",class:"unit-header",css:{backgroundColor:"#e9ecef",borderBottom:"1px solid #ddd",borderRadius:"6px 6px 0 0",padding:"8px 12px",fontWeight:"bold",fontSize:"14px",color:"#333",cursor:"move"}}),p("unit-name",{tag:"span",class:"unit-name",css:{display:"block",outline:"none",backgroundColor:"transparent",border:"none"}}),p("unit-body",{tag:"div",class:"unit-body",css:{padding:"8px 12px",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"}}),p("unit-icon",{tag:"img",class:"unit-icon",attrs:{draggable:"false"},css:{maxWidth:"32px",maxHeight:"32px",objectFit:"contain",pointerEvents:"none"}}),p("unit-connector",{tag:"div",class:"unit-connector",css:{zIndex:"2",position:"absolute",width:"12px",height:"12px",backgroundColor:"#007bff",borderRadius:"50%",cursor:"pointer",border:"2px solid #fff",boxShadow:"0 0 0 1px #007bff"}}),p("unit-connector-input",{tag:"div",class:"unit-connector unit-connector-input",css:{position:"absolute",width:"12px",height:"12px",borderRadius:"50%",cursor:"pointer",border:"2px solid #fff",left:"-8px",backgroundColor:"#28a745",boxShadow:"0 0 0 1px #28a745"}}),p("unit-connector-output",{tag:"div",class:"unit-connector unit-connector-output",css:{position:"absolute",width:"12px",height:"12px",borderRadius:"50%",cursor:"pointer",border:"2px solid #fff",right:"-8px",backgroundColor:"#dc3545",boxShadow:"0 0 0 1px #dc3545"}});if(!document.querySelector("#unit-styles")){const t=document.createElement("style");t.id="unit-styles",t.textContent='\n  .unit-selected {\n    border-color: #007bff !important;\n    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25) !important;\n  }\n  \n  .unit-name[contenteditable="true"] {\n    background-color: rgba(255, 255, 255, 0.9) !important;\n    border: none !important;\n    border-radius: 3px !important;\n    padding: 0 !important;\n    outline: none !important;\n    box-shadow: inset 0 0 0 1px rgba(0, 123, 255, 0.3) !important;\n  }\n  \n  .connector-selected {\n    transform: scale(1.3) !important;\n    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.4) !important;\n  }\n  \n  .unit-connector:hover {\n    transform: scale(1.2);\n  }\n  \n  .connector-drag-hover {\n    transform: scale(1.4) !important;\n    box-shadow: 0 0 0 4px rgba(40, 167, 69, 0.6) !important;\n  }\n  \n  .unit-icon.animated {\n    animation: iconPulse 0.3s ease;\n  }\n  \n  @keyframes iconPulse {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.1); }\n    100% { transform: scale(1); }\n  }\n',document.head.appendChild(t)}class A{constructor(t={}){const{id:e=R.generateUnitId(),name:n="Unit",position:i={x:100,y:100},inputs:o=[],outputs:s=[],icon:r=null,iconSrc:a=null,backgroundColor:l=null}=t;this.id=e,this.name=n,this.position=i,this.inputs=[],this.outputs=[],this.isDragging=!1,this.dragOffset={x:0,y:0},this.isEditingName=!1,this.backgroundColor=l,this.createElement(),this.setupDragging(),this.setupSelection(),this.setupNameEditing(),this.setPosition(i.x,i.y),l&&this.setBackgroundColor(l),R.registerUnit(this),document.body.appendChild(this.element),o.forEach(t=>this.addInput(t)),s.forEach(t=>this.addOutput(t)),this.adjustModuleHeight(),(r||a)&&this.setIcon(r||a)}createElement(){this.element=h("unit-container",{attrs:{"data-unit-id":this.id}}),this.header=h("unit-header"),this.nameElement=h("unit-name",{text:this.name}),this.body=h("unit-body"),this.header.appendChild(this.nameElement),this.element.appendChild(this.header),this.element.appendChild(this.body)}setupDragging(){let t,e,n,i;const o=o=>{if(!this.isDragging)return;const s=o.clientX-t,r=o.clientY-e;this.setPosition(n+s,i+r),R.updateAllConnections()},s=()=>{this.isDragging=!1,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s)};this.header.addEventListener("mousedown",r=>{this.isEditingName||(this.isDragging=!0,t=r.clientX,e=r.clientY,n=this.position.x,i=this.position.y,document.addEventListener("mousemove",o),document.addEventListener("mouseup",s),r.preventDefault())})}setupSelection(){this.element.addEventListener("click",t=>{t.stopPropagation(),t.ctrlKey||t.metaKey?R.selectedUnits.has(this.id)?R.deselectUnit(this.id):R.selectUnit(this.id):(R.deselectAll(),R.selectUnit(this.id))})}setupNameEditing(){this.nameElement.addEventListener("dblclick",t=>{t.stopPropagation(),this.startNameEditing()})}startNameEditing(){this.isEditingName=!0,this.nameElement.contentEditable=!0,this.nameElement.focus();const t=document.createRange();t.selectNodeContents(this.nameElement);const e=window.getSelection();e.removeAllRanges(),e.addRange(t);this.nameElement.addEventListener("blur",()=>{this.isEditingName=!1,this.nameElement.contentEditable=!1,this.name=this.nameElement.textContent.trim()||"Unit",this.nameElement.textContent=this.name},{once:!0}),this.nameElement.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),this.nameElement.blur())})}setPosition(t,e){this.position.x=t,this.position.y=e,this.element.style.left=`${t}px`,this.element.style.top=`${e}px`}setBackgroundColor(t){this.backgroundColor=t,this.element&&(this.element.style.backgroundColor=t)}setIcon(t){const e=this.body.querySelector(".unit-icon");if(e&&e.remove(),!t)return;const n=h("unit-icon");n.draggable=!1,t.startsWith("data:"),n.src=t,this.body.appendChild(n),this.iconElement=n}animateIcon(){this.iconElement&&(this.iconElement.classList.add("animated"),setTimeout(()=>{this.iconElement.classList.remove("animated")},300))}addInput(t={}){const{id:e=R.generateConnectorId(),name:n=`Input ${this.inputs.length+1}`,color:i="#28a745"}=t,o=h("unit-connector-input",{attrs:{"data-connector-id":e,"data-connector-type":"input",title:n}});i&&(o.style.backgroundColor=i,o.style.boxShadow=`0 0 0 1px ${i}`);const s=this.inputs.length;return o.style.top=49+20*s+"px",o.addEventListener("click",t=>{t.stopPropagation(),R.handleConnectorClick(this.id,e,"input")}),o.addEventListener("mousedown",t=>{t.stopPropagation(),R.startConnectorDrag(this.id,e,"input",t)}),this.element.appendChild(o),this.inputs.push({id:e,name:n,color:i,element:o}),this.adjustModuleHeight(),e}addOutput(t={}){const{id:e=R.generateConnectorId(),name:n=`Output ${this.outputs.length+1}`,color:i="#dc3545"}=t,o=h("unit-connector-output",{attrs:{"data-connector-id":e,"data-connector-type":"output",title:n}});i&&(o.style.backgroundColor=i,o.style.boxShadow=`0 0 0 1px ${i}`);const s=this.outputs.length;return o.style.top=49+20*s+"px",o.addEventListener("click",t=>{t.stopPropagation(),R.handleConnectorClick(this.id,e,"output")}),o.addEventListener("mousedown",t=>{t.stopPropagation(),R.startConnectorDrag(this.id,e,"output",t)}),this.element.appendChild(o),this.outputs.push({id:e,name:n,color:i,element:o}),this.adjustModuleHeight(),e}removeInput(t){const e=this.inputs.findIndex(e=>e.id===t);if(-1!==e){this.inputs[e].element.remove(),this.inputs.splice(e,1),this.repositionInputs()}}removeOutput(t){const e=this.outputs.findIndex(e=>e.id===t);if(-1!==e){this.outputs[e].element.remove(),this.outputs.splice(e,1),this.repositionOutputs()}}repositionInputs(){this.inputs.forEach((t,e)=>{t.element.style.top=49+20*e+"px"}),this.adjustModuleHeight()}repositionOutputs(){this.outputs.forEach((t,e)=>{t.element.style.top=49+20*e+"px"}),this.adjustModuleHeight()}adjustModuleHeight(){const t=Math.max(this.inputs.length,this.outputs.length);if(0===t)return this.element.style.height="auto",void(this.element.style.minHeight="60px");const e=20*Math.max(1,t),n=35+Math.max(32,e)+16+8;this.element.style.height=`${n}px`,this.element.style.minHeight=`${n}px`,console.log(`📏 Unit ${this.name}: ${t} connecteurs max → hauteur ${n}px`)}select(){R.selectUnit(this.id)}deselect(){R.deselectUnit(this.id)}rename(t){this.name=t,this.nameElement.textContent=t}destroy(){R.unregisterUnit(this.id),this.element.remove()}onClick(){this.animateIcon()}onLongClick(){this.animateIcon()}}function T(t){return new A(t)}if(u.components={Slider:m,Badge:b,Button:C,Draggable:w,List:S,Matrix:E,Menu:$,Minimal:L,Table:z,Template:I,Tooltip:D,Unit:T},"undefined"!=typeof window){window.Squirrel.Apis=e,window.Apis=e,window.$=u.$,window.Squirrel=window.Squirrel||{},window.Squirrel.$=u.$,window.Squirrel.define=u.define,window.Squirrel.batch=u.batch,window.Squirrel.observeMutations=u.observeMutations,window.Squirrel.Slider=m,window.Squirrel.Badge=b,window.Squirrel.Button=C,window.Squirrel.Draggable=w,window.Squirrel.makeDraggable=w.makeDraggable,window.Squirrel.List=S,window.Squirrel.Matrix=E,window.Squirrel.Menu=$,window.Squirrel.Minimal=L,window.Squirrel.Table=z,window.Squirrel.Template=I,window.Squirrel.Tooltip=D,window.Squirrel.Unit=T,window.Slider=window.Squirrel.Slider,window.Badge=window.Squirrel.Badge,window.Button=window.Squirrel.Button,window.Draggable=window.Squirrel.Draggable,window.List=window.Squirrel.List,window.Matrix=window.Squirrel.Matrix,window.Menu=window.Squirrel.Menu,window.Minimal=window.Squirrel.Minimal,window.Table=window.Squirrel.Table,window.Template=window.Squirrel.Template,window.Tooltip=window.Squirrel.Tooltip,window.Unit=window.Squirrel.Unit;const t=()=>{if(!document.getElementById("view")){const t=document.createElement("div");t.id="view",document.body.appendChild(t)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{window.squirrelReady=!0,window.dispatchEvent(new Event("squirrel:ready"))},0)})}t.default=u,Object.defineProperty(t,"__esModule",{value:!0})});